<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Listing Assistant</title>
    
    <!-- PWA Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fashion Assistant">
    <meta name="theme-color" content="#5D5CDE">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM1RDVDREUiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJtMTYgNiA0IDZoLTRWNnoiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8L3N2Zz4KPC9zdmc+">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-hover': '#4F4ED6',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen">
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Fashion Listing Assistant</h1>
            <p class="text-gray-600 dark:text-gray-400">Quick &amp; affordable vintage fashion listings</p>
            
            <!-- Powered by Poe -->
            <div class="mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800 max-w-md mx-auto">
                <div class="text-center">
                    <p class="text-sm text-green-800 dark:text-green-200">🤖 Powered by Poe API</p>
                    <p class="text-xs text-green-600 dark:text-green-400">Using GPT-4o-mini for affordable content generation</p>
                </div>
            </div>
        </header>

        <!-- Item Details Form -->
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Describe Your Item</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Item Type *</label>
                    <select id="item-type" required="" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">Select item type...</option>
                        
                        <!-- CLOTHING -->
                        <optgroup label="👗 Dresses">
                            <option value="Dress">Dress</option>
                            <option value="Midi Dress">Midi Dress</option>
                            <option value="Maxi Dress">Maxi Dress</option>
                            <option value="Mini Dress">Mini Dress</option>
                            <option value="Party Dress">Party Dress</option>
                            <option value="Wedding Dress">Wedding Dress</option>
                            <option value="Cocktail Dress">Cocktail Dress</option>
                        </optgroup>
                        
                        <optgroup label="👚 Tops">
                            <option value="Blouse">Blouse</option>
                            <option value="Vintage Blouse">Vintage Blouse</option>
                            <option value="Shirt">Shirt</option>
                            <option value="Button-up Shirt">Button-up Shirt</option>
                            <option value="Top">Top</option>
                            <option value="Tank Top">Tank Top</option>
                            <option value="Camisole">Camisole</option>
                            <option value="Crop Top">Crop Top</option>
                            <option value="T-shirt">T-shirt</option>
                            <option value="Polo Shirt">Polo Shirt</option>
                        </optgroup>
                        
                        <optgroup label="🧥 Outerwear">
                            <option value="Sweater">Sweater</option>
                            <option value="Vintage Sweater">Vintage Sweater</option>
                            <option value="Cardigan">Cardigan</option>
                            <option value="Hoodie">Hoodie</option>
                            <option value="Sweatshirt">Sweatshirt</option>
                            <option value="Jacket">Jacket</option>
                            <option value="Leather Jacket">Leather Jacket</option>
                            <option value="Denim Jacket">Denim Jacket</option>
                            <option value="Bomber Jacket">Bomber Jacket</option>
                            <option value="Blazer">Blazer</option>
                            <option value="Vintage Blazer">Vintage Blazer</option>
                            <option value="Coat">Coat</option>
                            <option value="Trench Coat">Trench Coat</option>
                            <option value="Puffer Jacket">Puffer Jacket</option>
                            <option value="Vest">Vest</option>
                        </optgroup>
                        
                        <optgroup label="👖 Bottoms">
                            <option value="Skirt">Skirt</option>
                            <option value="Midi Skirt">Midi Skirt</option>
                            <option value="Mini Skirt">Mini Skirt</option>
                            <option value="A-line Skirt">A-line Skirt</option>
                            <option value="Pleated Skirt">Pleated Skirt</option>
                            <option value="Pants">Pants</option>
                            <option value="Trousers">Trousers</option>
                            <option value="Wide Leg Pants">Wide Leg Pants</option>
                            <option value="High Waisted Pants">High Waisted Pants</option>
                            <option value="Jeans">Jeans</option>
                            <option value="Vintage Jeans">Vintage Jeans</option>
                            <option value="Mom Jeans">Mom Jeans</option>
                            <option value="Skinny Jeans">Skinny Jeans</option>
                            <option value="Shorts">Shorts</option>
                            <option value="Denim Shorts">Denim Shorts</option>
                            <option value="Leggings">Leggings</option>
                            <option value="Joggers">Joggers</option>
                        </optgroup>
                        
                        <optgroup label="👔 Sets &amp; Suits">
                            <option value="Suit">Suit</option>
                            <option value="Vintage Suit">Vintage Suit</option>
                            <option value="Two Piece Set">Two Piece Set</option>
                            <option value="Co-ord Set">Co-ord Set</option>
                            <option value="Matching Set">Matching Set</option>
                            <option value="Jumpsuit">Jumpsuit</option>
                            <option value="Playsuit">Playsuit</option>
                            <option value="Romper">Romper</option>
                        </optgroup>
                        
                        <!-- ACCESSORIES -->
                        <optgroup label="👜 Bags">
                            <option value="Handbag">Handbag</option>
                            <option value="Shoulder Bag">Shoulder Bag</option>
                            <option value="Crossbody Bag">Crossbody Bag</option>
                            <option value="Tote Bag">Tote Bag</option>
                            <option value="Clutch">Clutch</option>
                            <option value="Evening Bag">Evening Bag</option>
                            <option value="Backpack">Backpack</option>
                            <option value="Mini Bag">Mini Bag</option>
                            <option value="Vintage Bag">Vintage Bag</option>
                            <option value="Designer Bag">Designer Bag</option>
                            <option value="Laptop Bag">Laptop Bag</option>
                            <option value="Travel Bag">Travel Bag</option>
                            <option value="Gym Bag">Gym Bag</option>
                            <option value="Bucket Bag">Bucket Bag</option>
                            <option value="Saddle Bag">Saddle Bag</option>
                        </optgroup>
                        
                        <optgroup label="👠 Shoes">
                            <option value="Heels">Heels</option>
                            <option value="High Heels">High Heels</option>
                            <option value="Block Heels">Block Heels</option>
                            <option value="Stilettos">Stilettos</option>
                            <option value="Wedges">Wedges</option>
                            <option value="Pumps">Pumps</option>
                            <option value="Flats">Flats</option>
                            <option value="Ballet Flats">Ballet Flats</option>
                            <option value="Loafers">Loafers</option>
                            <option value="Mules">Mules</option>
                            <option value="Sandals">Sandals</option>
                            <option value="Strappy Sandals">Strappy Sandals</option>
                            <option value="Platform Sandals">Platform Sandals</option>
                            <option value="Slides">Slides</option>
                            <option value="Boots">Boots</option>
                            <option value="Ankle Boots">Ankle Boots</option>
                            <option value="Knee High Boots">Knee High Boots</option>
                            <option value="Over Knee Boots">Over Knee Boots</option>
                            <option value="Combat Boots">Combat Boots</option>
                            <option value="Chelsea Boots">Chelsea Boots</option>
                            <option value="Cowboy Boots">Cowboy Boots</option>
                            <option value="Sneakers">Sneakers</option>
                            <option value="Trainers">Trainers</option>
                            <option value="Running Shoes">Running Shoes</option>
                            <option value="Canvas Shoes">Canvas Shoes</option>
                            <option value="Vintage Shoes">Vintage Shoes</option>
                            <option value="Designer Shoes">Designer Shoes</option>
                        </optgroup>
                        
                        <optgroup label="💍 Jewelry">
                            <option value="Necklace">Necklace</option>
                            <option value="Pendant Necklace">Pendant Necklace</option>
                            <option value="Chain Necklace">Chain Necklace</option>
                            <option value="Statement Necklace">Statement Necklace</option>
                            <option value="Choker">Choker</option>
                            <option value="Earrings">Earrings</option>
                            <option value="Stud Earrings">Stud Earrings</option>
                            <option value="Hoop Earrings">Hoop Earrings</option>
                            <option value="Drop Earrings">Drop Earrings</option>
                            <option value="Statement Earrings">Statement Earrings</option>
                            <option value="Bracelet">Bracelet</option>
                            <option value="Chain Bracelet">Chain Bracelet</option>
                            <option value="Bangle">Bangle</option>
                            <option value="Ring">Ring</option>
                            <option value="Statement Ring">Statement Ring</option>
                            <option value="Vintage Jewelry">Vintage Jewelry</option>
                            <option value="Costume Jewelry">Costume Jewelry</option>
                            <option value="Fine Jewelry">Fine Jewelry</option>
                            <option value="Gold Jewelry">Gold Jewelry</option>
                            <option value="Silver Jewelry">Silver Jewelry</option>
                        </optgroup>
                        
                        <optgroup label="🎩 Hats &amp; Hair">
                            <option value="Hat">Hat</option>
                            <option value="Beanie">Beanie</option>
                            <option value="Baseball Cap">Baseball Cap</option>
                            <option value="Bucket Hat">Bucket Hat</option>
                            <option value="Beret">Beret</option>
                            <option value="Fedora">Fedora</option>
                            <option value="Sun Hat">Sun Hat</option>
                            <option value="Winter Hat">Winter Hat</option>
                            <option value="Vintage Hat">Vintage Hat</option>
                            <option value="Hair Accessories">Hair Accessories</option>
                            <option value="Hair Clips">Hair Clips</option>
                            <option value="Headband">Headband</option>
                            <option value="Scrunchies">Scrunchies</option>
                        </optgroup>
                        
                        <optgroup label="🧣 Scarves &amp; Wraps">
                            <option value="Scarf">Scarf</option>
                            <option value="Silk Scarf">Silk Scarf</option>
                            <option value="Winter Scarf">Winter Scarf</option>
                            <option value="Cashmere Scarf">Cashmere Scarf</option>
                            <option value="Vintage Scarf">Vintage Scarf</option>
                            <option value="Designer Scarf">Designer Scarf</option>
                            <option value="Shawl">Shawl</option>
                            <option value="Wrap">Wrap</option>
                            <option value="Pashmina">Pashmina</option>
                            <option value="Bandana">Bandana</option>
                        </optgroup>
                        
                        <optgroup label="👓 Eyewear">
                            <option value="Sunglasses">Sunglasses</option>
                            <option value="Vintage Sunglasses">Vintage Sunglasses</option>
                            <option value="Designer Sunglasses">Designer Sunglasses</option>
                            <option value="Cat Eye Sunglasses">Cat Eye Sunglasses</option>
                            <option value="Aviator Sunglasses">Aviator Sunglasses</option>
                            <option value="Round Sunglasses">Round Sunglasses</option>
                            <option value="Glasses">Glasses</option>
                            <option value="Reading Glasses">Reading Glasses</option>
                        </optgroup>
                        
                        <optgroup label="📱 Tech &amp; Accessories">
                            <option value="Watch">Watch</option>
                            <option value="Vintage Watch">Vintage Watch</option>
                            <option value="Designer Watch">Designer Watch</option>
                            <option value="Smart Watch">Smart Watch</option>
                            <option value="Phone Case">Phone Case</option>
                            <option value="Wallet">Wallet</option>
                            <option value="Purse">Purse</option>
                            <option value="Card Holder">Card Holder</option>
                            <option value="Key Chain">Key Chain</option>
                        </optgroup>
                        
                        <optgroup label="👔 Other Accessories">
                            <option value="Belt">Belt</option>
                            <option value="Leather Belt">Leather Belt</option>
                            <option value="Chain Belt">Chain Belt</option>
                            <option value="Designer Belt">Designer Belt</option>
                            <option value="Vintage Belt">Vintage Belt</option>
                            <option value="Gloves">Gloves</option>
                            <option value="Leather Gloves">Leather Gloves</option>
                            <option value="Winter Gloves">Winter Gloves</option>
                            <option value="Tie">Tie</option>
                            <option value="Bow Tie">Bow Tie</option>
                            <option value="Pocket Square">Pocket Square</option>
                            <option value="Cufflinks">Cufflinks</option>
                        </optgroup>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Brand</label>
                    <input type="text" id="brand" placeholder="e.g., Zara, COS, Arket, Uniqlo, Vintage, No brand" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                </div>

                <div>
                    <label id="size-label" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Size *</label>
                    <input type="text" id="size" placeholder="e.g., S, M, L, 8, 10, 12, EU38" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Era/Decade</label>
                    <select id="era" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">Select era...</option>
                        <option value="2020s">2020s</option>
                        <option value="2010s">2010s</option>
                        <option value="2000s">2000s / Y2K</option>
                        <option value="90s">90s</option>
                        <option value="80s">80s</option>
                        <option value="70s">70s</option>
                        <option value="60s">60s</option>
                        <option value="50s">50s</option>
                        <option value="40s and earlier">40s and earlier</option>
                        <option value="Unspecified Vintage">Unspecified Vintage</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Primary Material *</label>
                    <select id="material1" required="" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">Select primary material...</option>
                        <option value="Cotton">Cotton</option>
                        <option value="Wool">Wool</option>
                        <option value="Silk">Silk</option>
                        <option value="Linen">Linen</option>
                        <option value="Cashmere">Cashmere</option>
                        <option value="Leather">Leather</option>
                        <option value="Suede">Suede</option>
                        <option value="Denim">Denim</option>
                        <option value="Polyester">Polyester</option>
                        <option value="Viscose">Viscose</option>
                        <option value="Rayon">Rayon</option>
                        <option value="Nylon">Nylon</option>
                        <option value="Acrylic">Acrylic</option>
                        <option value="Elastane">Elastane</option>
                        <option value="Tencel">Tencel</option>
                        <option value="Modal">Modal</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Secondary Material</label>
                    <select id="material2" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">None / Single material</option>
                        <option value="Cotton">Cotton</option>
                        <option value="Wool">Wool</option>
                        <option value="Silk">Silk</option>
                        <option value="Linen">Linen</option>
                        <option value="Polyester">Polyester</option>
                        <option value="Viscose">Viscose</option>
                        <option value="Elastane">Elastane</option>
                        <option value="Spandex">Spandex</option>
                        <option value="Nylon">Nylon</option>
                        <option value="Acrylic">Acrylic</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Condition *</label>
                    <select id="condition" required="" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">Select condition...</option>
                        <option value="BNWT">BNWT (Brand New With Tags)</option>
                        <option value="NWOT">NWOT (New Without Tags)</option>
                        <option value="Very good">Very good</option>
                        <option value="Good">Good</option>
                        <option value="Satisfactory">Satisfactory</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Fit</label>
                    <select id="fit" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">Select fit...</option>
                        <option value="Oversized">Oversized</option>
                        <option value="Relaxed">Relaxed</option>
                        <option value="Regular fit">Regular fit</option>
                        <option value="Slim fit">Slim fit</option>
                        <option value="Tailored">Tailored</option>
                        <option value="High waisted">High waisted</option>
                        <option value="Low waisted">Low waisted</option>
                        <option value="A-line">A-line</option>
                        <option value="Straight">Straight</option>
                        <option value="Wide leg">Wide leg</option>
                        <option value="Bodycon">Bodycon</option>
                        <option value="Flowy">Flowy</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Length</label>
                    <select id="length" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">Select length...</option>
                        <option value="Cropped">Cropped</option>
                        <option value="Regular length">Regular length</option>
                        <option value="Long">Long</option>
                        <option value="Mini length">Mini length</option>
                        <option value="Above knee">Above knee</option>
                        <option value="Knee length">Knee length</option>
                        <option value="Midi length">Midi length</option>
                        <option value="Maxi length">Maxi length</option>
                        <option value="Floor length">Floor length</option>
                        <option value="Ankle length">Ankle length</option>
                        <option value="Full length">Full length</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Color * (select up to 2)</label>
                    <div id="color-grid" class="grid grid-cols-3 md:grid-cols-4 gap-2 p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 max-h-48 overflow-y-auto">
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Black" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Black</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Brown" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Brown</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Grey" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Grey</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Beige" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Beige</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Pink" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Pink</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Purple" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Purple</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Red" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Red</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Yellow" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Yellow</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Blue" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Blue</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Green" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Green</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Orange" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Orange</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="White" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">White</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Silver" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Silver</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Gold" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Gold</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Multi" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Multi</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Khaki" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Khaki</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Turquoise" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Turquoise</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Cream" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Cream</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Apricot" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Apricot</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Coral" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Coral</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Burgundy" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Burgundy</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Rose" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Rose</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Lilac" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Lilac</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Light blue" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Light blue</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Navy" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Navy</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Dark green" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Dark green</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Mustard" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Mustard</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Mint" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Mint</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                            <input type="checkbox" value="Clear" class="color-checkbox rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                            <span class="text-gray-700 dark:text-gray-300">Clear</span>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Pattern/Print</label>
                    <select id="pattern" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                        <option value="">Solid color / No pattern</option>
                        <option value="Striped">Striped</option>
                        <option value="Checked">Checked</option>
                        <option value="Plaid">Plaid</option>
                        <option value="Floral">Floral</option>
                        <option value="Polka dot">Polka dot</option>
                        <option value="Animal print">Animal print</option>
                        <option value="Geometric">Geometric</option>
                        <option value="Abstract">Abstract</option>
                        <option value="Paisley">Paisley</option>
                        <option value="Houndstooth">Houndstooth</option>
                        <option value="Textured">Textured</option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Key Features (select all that apply)</label>
                <div id="features-grid" class="grid grid-cols-2 md:grid-cols-3 gap-2 p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 max-h-48 overflow-y-auto">
                    <p class="col-span-full text-gray-500 dark:text-gray-400 text-sm italic">Select an item type to see feature options</p>
                </div>
                <div class="mt-2">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Other features (optional)</label>
                    <input type="text" id="custom-features" placeholder="Any additional features not listed above" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Measurements (if known)</label>
                <input type="text" id="measurements" placeholder="e.g., Chest 38cm, Length 60cm, Waist 32cm" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Style Aesthetic</label>
                <select id="style-aesthetic" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
                    <option value="">Select aesthetic...</option>
                    <option value="Minimalist">Minimalist</option>
                    <option value="Y2K">Y2K</option>
                    <option value="2000s">2000s</option>
                    <option value="Cottagecore">Cottagecore</option>
                    <option value="Dark Academia">Dark Academia</option>
                    <option value="Light Academia">Light Academia</option>
                    <option value="Boho">Boho</option>
                    <option value="Bohemian">Bohemian</option>
                    <option value="Vintage">Vintage</option>
                    <option value="Retro">Retro</option>
                    <option value="Grunge">Grunge</option>
                    <option value="Preppy">Preppy</option>
                    <option value="Streetwear">Streetwear</option>
                    <option value="Romantic">Romantic</option>
                    <option value="Feminine">Feminine</option>
                    <option value="Androgynous">Androgynous</option>
                    <option value="Tomboy">Tomboy</option>
                    <option value="Chic">Chic</option>
                    <option value="Parisian">Parisian</option>
                    <option value="Scandi">Scandi</option>
                    <option value="Scandinavian">Scandinavian</option>
                    <option value="Indie">Indie</option>
                    <option value="Alternative">Alternative</option>
                    <option value="Goth">Goth</option>
                    <option value="Emo">Emo</option>
                    <option value="Punk">Punk</option>
                    <option value="Rock">Rock</option>
                    <option value="Hipster">Hipster</option>
                    <option value="Artsy">Artsy</option>
                    <option value="Edgy">Edgy</option>
                    <option value="Soft Girl">Soft Girl</option>
                    <option value="VSCO Girl">VSCO Girl</option>
                    <option value="Clean Girl">Clean Girl</option>
                    <option value="That Girl">That Girl</option>
                    <option value="Old Money">Old Money</option>
                    <option value="Quiet Luxury">Quiet Luxury</option>
                    <option value="Coquette">Coquette</option>
                    <option value="Fairycore">Fairycore</option>
                    <option value="Goblincore">Goblincore</option>
                    <option value="Kidcore">Kidcore</option>
                    <option value="Kawaii">Kawaii</option>
                    <option value="Harajuku">Harajuku</option>
                    <option value="Korean Fashion">Korean Fashion</option>
                    <option value="Japanese Fashion">Japanese Fashion</option>
                    <option value="Workwear">Workwear</option>
                    <option value="Corporate">Corporate</option>
                    <option value="Business Casual">Business Casual</option>
                    <option value="Smart Casual">Smart Casual</option>
                    <option value="Casual">Casual</option>
                    <option value="Sporty">Sporty</option>
                    <option value="Athleisure">Athleisure</option>
                    <option value="Coastal">Coastal</option>
                    <option value="Grandpa">Grandpa</option>
                    <option value="Grandma">Grandma</option>
                </select>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Fit &amp; Length Notes</label>
                <input type="text" id="fit-notes" placeholder="e.g., Runs small, size up / True to size / Hits mid-thigh / Oversized as intended" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white">
            </div>



            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Best Season (select one if applicable)</label>
                <div class="grid grid-cols-2 gap-2 p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                    <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                        <input type="radio" name="season" value="Summer" class="season-radio rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                        <span class="text-gray-700 dark:text-gray-300">Summer</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm">
                        <input type="radio" name="season" value="Winter" class="season-radio rounded border-gray-300 text-primary focus:ring-primary focus:ring-2">
                        <span class="text-gray-700 dark:text-gray-300">Winter</span>
                    </label>
                </div>
            </div>



            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Flaws/Damage</label>
                <textarea id="flaws" placeholder="Describe any stains, holes, missing buttons, wear marks, etc. Be specific about location and size." rows="2" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white"></textarea>
            </div>

            <div class="flex flex-col sm:flex-row gap-3">
                <button id="fill-test-data-btn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
                    🧪 Fill Test Data
                </button>
                <button id="generate-btn" class="flex-2 bg-primary hover:bg-primary-hover text-white px-6 py-3 rounded-md font-medium transition-colors">
                    <span id="generate-text">Generate Listing</span>
                    <span id="generate-loading" class="hidden">Generating...</span>
                </button>
            </div>
        </div>

        <!-- Generated Content Section -->
        <div id="description-section" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 hidden">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Your Fashion Listing</h2>
            
            <!-- Vinted Title -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Vinted Title:</label>
                <div class="bg-white dark:bg-gray-700 rounded-md p-4 border border-gray-200 dark:border-gray-600 mb-3">
                    <div id="generated-title" class="text-gray-900 dark:text-white font-medium"></div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-3 mb-4">
                    <button id="copy-title-btn" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md font-medium transition-colors">
                        📋 Copy Title
                    </button>
                    <button id="edit-title-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md font-medium transition-colors">
                        ✏️ Edit Title
                    </button>
                </div>
            </div>

            <!-- Description -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description:</label>
                <div class="bg-white dark:bg-gray-700 rounded-md p-4 border border-gray-200 dark:border-gray-600 mb-3">
                    <div id="generated-description" class="prose dark:prose-invert max-w-none overflow-wrap-anywhere break-words whitespace-pre-wrap"></div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 mb-6">
                <button id="copy-btn" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-md font-medium transition-colors">
                    📋 Copy Description
                </button>
                <button id="edit-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-md font-medium transition-colors">
                    ✏️ Edit Description
                </button>
                <button id="new-btn" class="flex-1 bg-primary hover:bg-primary-hover text-white px-6 py-3 rounded-md font-medium transition-colors">
                    🆕 New Listing
                </button>
            </div>

            <!-- Save to Notion Section -->
            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <h3 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3">💾 Save to Your Notion Inventory</h3>
                <p class="text-blue-700 dark:text-blue-300 text-sm mb-4">Automatically save all your item details and generated content to your "New stock table" database.</p>
                
                <div class="space-y-3">
                    <button id="test-notion-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
                        🔍 Test Notion Connection &amp; Database Structure
                    </button>
                    <button id="debug-data-btn" class="w-full bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
                        🐛 Debug: Show Data Being Sent
                    </button>
                    <button id="save-notion-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
                        <span id="save-notion-text">💾 Save to Notion Database</span>
                        <span id="save-notion-loading" class="hidden">Saving to Notion...</span>
                    </button>
                    <button id="generate-curl-btn" class="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
                        📋 Generate Curl Command (Manual Backup)
                    </button>
                    <button id="copy-data-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
                        📄 Copy Formatted Data (Manual Entry)
                    </button>
                </div>
            </div>
        </div>



        <!-- Edit Modal -->
        <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Edit Description</h3>
                <textarea id="edit-text" rows="12" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white"></textarea>
                <div class="flex justify-end space-x-3 mt-4">
                    <button id="cancel-btn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancel</button>
                    <button id="save-btn" class="px-4 py-2 bg-primary text-white hover:bg-primary-hover rounded">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDescription = '';

        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setupSmartCapitalization();
        });

        function setupEventListeners() {
            document.getElementById('generate-btn').addEventListener('click', generateDescription);
            document.getElementById('copy-btn').addEventListener('click', copyDescription);
            document.getElementById('edit-btn').addEventListener('click', showEditModal);
            document.getElementById('new-btn').addEventListener('click', startNew);
            document.getElementById('cancel-btn').addEventListener('click', hideEditModal);
            document.getElementById('save-btn').addEventListener('click', saveEdit);
            
            // Title editing (copy and edit buttons are created after generation)
            document.getElementById('copy-title-btn').addEventListener('click', copyTitle);
            document.getElementById('edit-title-btn').addEventListener('click', editTitle);
            
            // Notion integration
            document.getElementById('test-notion-btn').addEventListener('click', testNotionConnection);
            document.getElementById('debug-data-btn').addEventListener('click', debugDataBeingSent);
            document.getElementById('save-notion-btn').addEventListener('click', saveToNotion);
            document.getElementById('generate-curl-btn').addEventListener('click', generateCurlCommand);
            document.getElementById('copy-data-btn').addEventListener('click', copyFormattedData);
            document.getElementById('fill-test-data-btn').addEventListener('click', fillTestData);
            
            // Dynamic fit and length options based on item type
            document.getElementById('item-type').addEventListener('change', updateFitOptions);
            document.getElementById('item-type').addEventListener('change', updateLengthOptions);
            document.getElementById('item-type').addEventListener('change', updateFeaturesPlaceholder);
            document.getElementById('item-type').addEventListener('change', updatePatternOptions);
            document.getElementById('item-type').addEventListener('change', updateMaterialOptions);
            document.getElementById('item-type').addEventListener('change', updateSizeRequirement);
            document.getElementById('item-type').addEventListener('change', updateEraOptions);
            document.getElementById('item-type').addEventListener('change', updateStyleAestheticOptions);
            document.getElementById('item-type').addEventListener('change', updateMeasurementsPlaceholder);
            document.getElementById('item-type').addEventListener('change', updateFlawsPlaceholder);
            
            // Color selection limit functionality
            setupColorSelectionLimit();
            
            // Radio button deselection functionality  
            setupRadioDeselection();
        }

        function updateFitOptions() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const fitSelect = document.getElementById('fit');
            
            // Clear current options
            fitSelect.innerHTML = '<option value="">Select fit...</option>';
            
            let options = [];
            
            if (itemType.includes('dress')) {
                options = ['Bodycon', 'A-line', 'Fit and flare', 'Shift', 'Wrap', 'Slip', 'Oversized', 'Fitted', 'Empire waist', 'Babydoll'];
            } else if (itemType.includes('skirt')) {
                options = ['A-line', 'Pencil', 'High waisted', 'Low waisted', 'Pleated', 'Wrap', 'Circle skirt', 'Straight', 'Bias cut'];
            } else if (itemType.includes('pants') || itemType.includes('trousers') || itemType.includes('jeans')) {
                options = ['High waisted', 'Low waisted', 'Wide leg', 'Straight leg', 'Slim fit', 'Skinny', 'Bootcut', 'Flare', 'Relaxed', 'Mom fit', 'Boyfriend fit'];
            } else if (itemType.includes('jacket') || itemType.includes('blazer') || itemType.includes('coat')) {
                options = ['Oversized', 'Fitted', 'Tailored', 'Relaxed', 'Double breasted', 'Single breasted', 'Boxy', 'Structured'];
            } else if (itemType.includes('top') || itemType.includes('blouse') || itemType.includes('shirt')) {
                options = ['Oversized', 'Fitted', 'Relaxed', 'Slim fit', 'Boxy', 'Flowy', 'Peplum', 'Wrap style', 'Tunic'];
            } else if (itemType.includes('sweater') || itemType.includes('cardigan')) {
                options = ['Oversized', 'Fitted', 'Relaxed', 'Chunky knit', 'Fine knit', 'Boxy', 'Cable knit'];
            } else if (itemType.includes('shorts')) {
                options = ['High waisted', 'Low waisted', 'Relaxed', 'Fitted', 'Wide leg', 'Straight', 'Bermuda'];
            } else if (itemType.includes('shoes') || itemType.includes('boots') || itemType.includes('heels') || itemType.includes('flats') || itemType.includes('sneakers')) {
                options = ['Wide fit', 'Narrow fit', 'Regular fit', 'True to size', 'Runs small', 'Runs large', 'Comfortable fit', 'Snug fit'];
            } else if (itemType.includes('bag') || itemType.includes('purse') || itemType.includes('tote') || itemType.includes('clutch')) {
                options = ['Small', 'Medium', 'Large', 'Mini', 'Oversized', 'Compact', 'Roomy', 'Structured', 'Slouchy'];
            } else if (itemType.includes('jewelry') || itemType.includes('necklace') || itemType.includes('bracelet') || itemType.includes('ring') || itemType.includes('earrings')) {
                options = ['Adjustable', 'Small', 'Medium', 'Large', 'One size', 'Delicate', 'Statement', 'Chunky', 'Fine'];
            } else if (itemType.includes('hat') || itemType.includes('beanie') || itemType.includes('cap')) {
                options = ['One size', 'Adjustable', 'Small', 'Medium', 'Large', 'Fitted', 'Stretchy'];
            } else if (itemType.includes('scarf') || itemType.includes('shawl') || itemType.includes('wrap')) {
                options = ['One size', 'Large', 'Oversized', 'Long', 'Short', 'Wide', 'Narrow'];
            } else if (itemType.includes('belt')) {
                options = ['Adjustable', 'Small', 'Medium', 'Large', 'Chain style', 'Wide', 'Narrow', 'Stretchy'];
            } else if (itemType.includes('gloves')) {
                options = ['Small', 'Medium', 'Large', 'One size', 'Fitted', 'Loose fit'];
            } else if (itemType.includes('sunglasses') || itemType.includes('glasses')) {
                options = ['Small frame', 'Medium frame', 'Large frame', 'Oversized', 'Compact', 'Wide fit', 'Narrow fit'];
            } else {
                // Default options for other accessories
                options = ['One size', 'Adjustable', 'Regular fit', 'Small', 'Medium', 'Large'];
            }
            
            // Add options to select
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                fitSelect.appendChild(optionElement);
            });
        }

        function updateLengthOptions() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const lengthSelect = document.getElementById('length');
            
            // Clear current options
            lengthSelect.innerHTML = '<option value="">Select length...</option>';
            
            let options = [];
            
            if (itemType.includes('dress')) {
                options = ['Mini length', 'Above knee', 'Knee length', 'Midi length', 'Maxi length', 'Floor length', 'Tea length', 'Asymmetrical hem'];
            } else if (itemType.includes('skirt')) {
                options = ['Mini length', 'Above knee', 'Knee length', 'Midi length', 'Maxi length', 'Floor length', 'Tea length'];
            } else if (itemType.includes('pants') || itemType.includes('trousers') || itemType.includes('jeans')) {
                options = ['Full length', 'Ankle length', '7/8 length', 'Cropped', 'Capri length', '3/4 length'];
            } else if (itemType.includes('shorts')) {
                options = ['Mini shorts', 'Short length', 'Mid-thigh', 'Bermuda length', 'Knee length'];
            } else if (itemType.includes('jacket') || itemType.includes('blazer') || itemType.includes('coat')) {
                options = ['Cropped', 'Hip length', 'Regular length', 'Long length', 'Knee length', 'Midi length', 'Maxi length'];
            } else if (itemType.includes('top') || itemType.includes('blouse') || itemType.includes('shirt')) {
                options = ['Cropped', 'Regular length', 'Hip length', 'Tunic length', 'Long length'];
            } else if (itemType.includes('sweater') || itemType.includes('cardigan')) {
                options = ['Cropped', 'Regular length', 'Hip length', 'Long length', 'Tunic length', 'Duster length'];
            } else if (itemType.includes('tank') || itemType.includes('camisole')) {
                options = ['Cropped', 'Regular length', 'Hip length', 'Tunic length'];
            } else if (itemType.includes('scarf')) {
                options = ['Short', 'Regular length', 'Long', 'Extra long', 'Infinity style'];
            } else if (itemType.includes('necklace')) {
                options = ['Choker', 'Short', 'Princess', 'Matinee', 'Opera', 'Rope length'];
            } else if (itemType.includes('bracelet')) {
                options = ['Short', 'Standard', 'Long', 'Wrap around'];
            } else if (itemType.includes('earrings')) {
                options = ['Stud', 'Short drop', 'Medium drop', 'Long drop', 'Statement length'];
            } else if (itemType.includes('boots')) {
                options = ['Ankle boots', 'Mid-calf', 'Knee high', 'Over knee', 'Thigh high'];
            } else if (itemType.includes('heels') || itemType.includes('pumps')) {
                options = ['Low heel', 'Mid heel', 'High heel', 'Very high heel'];
            } else {
                // Default options for other accessories
                options = ['Standard size', 'Compact', 'Large', 'Mini', 'Regular'];
            }
            
            // Add options to select
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                lengthSelect.appendChild(optionElement);
            });
        }

        function updateFeaturesPlaceholder() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const featuresGrid = document.getElementById('features-grid');
            
            // Clear existing checkboxes
            featuresGrid.innerHTML = '';
            
            let features = [];
            
            if (itemType.includes('dress')) {
                features = [
                    // Sleeves (comprehensive)
                    'Sleeveless', 'Short sleeves', 'Long sleeves', 'Three-quarter sleeves', 'Cap sleeves', 'Bell sleeves', 'Bishop sleeves', 'Puff sleeves', 'Flutter sleeves', 'Balloon sleeves', 'Lantern sleeves', 'Dolman sleeves', 'Raglan sleeves', 'Cold shoulder', 'Cut-out sleeves',
                    // Necklines (detailed)
                    'V-neck', 'Deep V-neck', 'Round neck', 'Scoop neck', 'High neck', 'Turtleneck', 'Mock neck', 'Off-shoulder', 'One shoulder', 'Halter neck', 'Square neck', 'Boat neck', 'Cowl neck', 'Sweetheart', 'Strapless', 'Backless', 'Keyhole front', 'Keyhole back',
                    // Closures & Fastenings
                    'Zip back', 'Zip front', 'Button front', 'Button back', 'Button down', 'Wrap style', 'Tie waist', 'Tie back', 'Tie front', 'Belt included', 'Drawstring waist', 'Smocked waist', 'Elastic waist', 'Corset back', 'Hook and eye', 'Invisible zip',
                    // Construction & Support
                    'Lined', 'Unlined', 'Partially lined', 'Built-in bra', 'Padded bra', 'Underwire', 'Shelf bra', 'Bra-friendly', 'Adjustable straps', 'Removable straps', 'Convertible straps', 'Boning', 'Internal grip strips',
                    // Fit & Silhouette
                    'A-line', 'Fit and flare', 'Bodycon', 'Shift', 'Wrap', 'Slip dress', 'Sheath', 'Empire waist', 'Drop waist', 'Babydoll', 'Tent dress', 'Trapeze', 'Mermaid', 'Trumpet', 'Princess cut', 'Bias cut',
                    // Pockets & Practical Features
                    'Side pockets', 'Hidden pockets', 'Chest pockets', 'No pockets', 'Deep pockets', 'Functional pockets', 'Fake pockets',
                    // Design Details
                    'Tiered', 'Pleated', 'Gathered', 'Ruched', 'Shirred', 'Smocked', 'Embroidered', 'Beaded', 'Sequined', 'Lace details', 'Lace trim', 'Lace overlay', 'Mesh panels', 'Sheer panels', 'Cut-out details', 'Contrast trim', 'Piping', 'Ruffles', 'Fringe',
                    // Length & Hem Details
                    'Mini length', 'Above knee', 'Knee length', 'Below knee', 'Midi length', 'Tea length', 'Maxi length', 'Floor length', 'Side slits', 'Front slit', 'Back slit', 'High-low hem', 'Asymmetrical hem', 'Curved hem', 'Stepped hem', 'Raw hem', 'Scalloped hem'
                ];
            } else if (itemType.includes('skirt')) {
                features = [
                    // Waist Styles & Rise
                    'High waisted', 'Ultra high waisted', 'Mid rise', 'Low waisted', 'Drop waist', 'Natural waist', 'Empire waist',
                    // Closures & Fastenings
                    'Side zip', 'Back zip', 'Front zip', 'Invisible zip', 'Button front', 'Button back', 'Hook and eye', 'Elastic waist', 'Pull-on style', 'Tie waist', 'Drawstring waist', 'Belt loops', 'No belt loops',
                    // Fit & Silhouette
                    'A-line', 'Pencil', 'Straight', 'Circle skirt', 'Full circle', 'Half circle', 'Flare', 'Trumpet', 'Mermaid', 'Wrap style', 'Tulip', 'Bubble', 'Peplum', 'Tier', 'Asymmetrical', 'Bias cut',
                    // Construction & Lining
                    'Lined', 'Unlined', 'Partially lined', 'Built-in shorts', 'Built-in slip', 'Stretch waistband', 'Rigid waistband', 'Facing', 'Interfaced',
                    // Pockets
                    'Side pockets', 'Back pockets', 'Hidden pockets', 'Patch pockets', 'Welt pockets', 'No pockets', 'Functional pockets', 'Fake pockets',
                    // Design Details
                    'Pleated', 'Box pleats', 'Knife pleats', 'Accordion pleats', 'Inverted pleats', 'Gathered', 'Ruched', 'Shirred', 'Smocked', 'Tiered', 'Layered', 'Ruffles', 'Fringe', 'Embroidered', 'Beaded', 'Sequined', 'Lace details', 'Mesh panels', 'Cut-out details',
                    // Length & Hem Details
                    'Mini length', 'Micro mini', 'Above knee', 'Knee length', 'Below knee', 'Midi length', 'Tea length', 'Maxi length', 'Floor length', 'Side slits', 'Front slit', 'Back slit', 'Vent', 'High-low hem', 'Asymmetrical hem', 'Curved hem', 'Raw hem', 'Rolled hem'
                ];
            } else if (itemType.includes('pants') || itemType.includes('trousers') || itemType.includes('jeans')) {
                features = [
                    // Rise & Waist
                    'High waisted', 'Ultra high waisted', 'Mid rise', 'Low waisted', 'Super low rise', 'Natural waist', 'Elastic waist', 'Stretch waist', 'Drawstring waist', 'Adjustable waist',
                    // Closures & Hardware
                    'Zip fly', 'Button fly', 'Hook and bar', 'Button closure', 'Snap closure', 'Pull-on style', 'Side zip', 'Back zip',
                    // Belt & Waistband
                    'Belt loops', 'No belt loops', 'Wide belt loops', 'D-ring details', 'Contrast waistband', 'Faced waistband', 'Elastic back', 'Adjustable tabs',
                    // Pockets (detailed)
                    'Front pockets', 'Back pockets', 'Side pockets', 'Cargo pockets', 'Flap pockets', 'Welt pockets', 'Patch pockets', 'Coin pocket', 'Watch pocket', 'Phone pocket', 'No back pockets', 'Functional pockets', 'Fake pockets', 'Deep pockets', 'Zippered pockets',
                    // Leg Styles & Fit
                    'Wide leg', 'Extra wide leg', 'Straight leg', 'Skinny', 'Super skinny', 'Slim fit', 'Tapered', 'Bootcut', 'Flare', 'Bell bottom', 'Palazzo', 'Boyfriend fit', 'Mom fit', 'Dad fit', 'Relaxed fit', 'Regular fit', 'Loose fit',
                    // Length & Hems
                    'Full length', 'Regular length', 'Cropped', 'Ankle length', 'Capri length', '7/8 length', '3/4 length', 'Knee length', 'Bermuda length', 'Cuffed', 'Turn-up cuffs', 'Raw hem', 'Frayed hem', 'Rolled hem', 'Hemmed', 'Unhemmed',
                    // Denim Specific Features
                    'Stretch denim', 'Rigid denim', 'Selvedge denim', 'Raw denim', 'Pre-washed', 'Stone washed', 'Acid washed', 'Enzyme washed', 'Distressed', 'Ripped', 'Holes', 'Whiskers', 'Fading', 'Sanding', 'Dark wash', 'Medium wash', 'Light wash', 'Black wash', 'Vintage wash',
                    // Construction Details
                    'Flat front', 'Pleated front', 'Pressed crease', 'Side seam stripe', 'Contrast stitching', 'Topstitching', 'Chain stitch', 'Reinforced knees', 'Gusset', 'Articulated knees'
                ];
            } else if (itemType.includes('jacket') || itemType.includes('blazer') || itemType.includes('coat')) {
                features = [
                    // Construction & Lining
                    'Lined', 'Unlined', 'Half lined', 'Quarter lined', 'Fully lined', 'Padded', 'Quilted lining', 'Insulated', 'Thermal lining', 'Mesh lining', 'Removable lining', 'Contrast lining', 'Windproof', 'Water resistant', 'Waterproof', 'Breathable',
                    // Closures & Fastenings
                    'Zip closure', 'Full zip', 'Half zip', 'Quarter zip', 'Two-way zip', 'Button front', 'Snap buttons', 'Press studs', 'Toggle buttons', 'Hook and eye', 'Velcro closure', 'Magnetic closure', 'Open front', 'No closure',
                    // Blazer Specific
                    'Single breasted', 'Double breasted', 'One button', 'Two button', 'Three button', 'Four button', 'Six button', 'Peaked lapels', 'Notched lapels', 'Shawl lapels', 'Wide lapels', 'Slim lapels', 'No lapels',
                    // Collar & Neckline
                    'Stand collar', 'Spread collar', 'Wing collar', 'Mandarin collar', 'Nehru collar', 'Hood', 'Removable hood', 'Adjustable hood', 'Faux fur hood', 'Fur trim', 'High neck', 'Funnel neck', 'Cowl neck',
                    // Pockets (comprehensive)
                    'Side pockets', 'Chest pockets', 'Breast pocket', 'Inner pockets', 'Interior pockets', 'Phone pocket', 'Card pockets', 'Pen pocket', 'Flap pockets', 'Welt pockets', 'Patch pockets', 'Cargo pockets', 'Kangaroo pocket', 'Zippered pockets', 'Button pockets', 'Snap pockets', 'Hidden pockets', 'No pockets',
                    // Fit & Style
                    'Oversized', 'Relaxed fit', 'Regular fit', 'Slim fit', 'Fitted', 'Tailored', 'Structured', 'Unstructured', 'Soft construction', 'Boxy', 'Cropped', 'Long length', 'Regular length', 'Duster length',
                    // Sleeves & Cuffs
                    'Long sleeves', 'Three-quarter sleeves', 'Short sleeves', 'Sleeveless', 'Set-in sleeves', 'Raglan sleeves', 'Dolman sleeves', 'Adjustable cuffs', 'Button cuffs', 'Zip cuffs', 'Elastic cuffs', 'Ribbed cuffs', 'Turn-back cuffs', 'French cuffs',
                    // Design Details
                    'Shoulder pads', 'Soft shoulders', 'Belt', 'Tie belt', 'Removable belt', 'D-ring belt', 'Buckle belt', 'Epaulettes', 'Tabs', 'Contrast panels', 'Color blocking', 'Piping', 'Topstitching', 'Decorative buttons', 'Logo hardware',
                    // Vents & Back Details
                    'Center vent', 'Side vents', 'No vent', 'Back pleat', 'Action back', 'Bi-swing back', 'Yoke', 'Princess seams'
                ];
            } else if (itemType.includes('top') || itemType.includes('blouse') || itemType.includes('shirt')) {
                features = [
                    // Sleeves (detailed)
                    'Sleeveless', 'Cap sleeves', 'Short sleeves', 'Elbow sleeves', 'Three-quarter sleeves', 'Long sleeves', 'Extended sleeves', 'Bell sleeves', 'Bishop sleeves', 'Puff sleeves', 'Balloon sleeves', 'Flutter sleeves', 'Kimono sleeves', 'Dolman sleeves', 'Raglan sleeves', 'Batwing sleeves', 'Cold shoulder', 'Cut-out sleeves', 'Rolled sleeves', 'Cuffed sleeves',
                    // Necklines (comprehensive)
                    'V-neck', 'Deep V-neck', 'Plunging V-neck', 'Round neck', 'Crew neck', 'Scoop neck', 'High neck', 'Mock neck', 'Turtleneck', 'Boat neck', 'Off-shoulder', 'One shoulder', 'Square neck', 'Sweetheart', 'Halter neck', 'Cowl neck', 'Keyhole front', 'Keyhole back', 'Backless', 'Tie neck', 'Bow neck',
                    // Collar Styles
                    'Collar', 'Spread collar', 'Point collar', 'Wing collar', 'Band collar', 'Mandarin collar', 'Peter Pan collar', 'Sailor collar', 'Bow tie collar', 'Tie collar', 'Stand collar', 'Shawl collar', 'No collar', 'Contrast collar', 'Embroidered collar',
                    // Closures & Fastenings
                    'Button front', 'Button down', 'Half button', 'Button back', 'Snap front', 'Zip front', 'Zip back', 'Pullover', 'Wrap style', 'Tie front', 'Tie back', 'Tie side', 'Lace-up front', 'Lace-up back', 'Hook and eye', 'No closure',
                    // Fit & Silhouette
                    'Fitted', 'Slim fit', 'Regular fit', 'Relaxed fit', 'Loose fit', 'Oversized', 'Boxy', 'Cropped', 'Regular length', 'Tunic length', 'Long length', 'High-low hem', 'Asymmetrical', 'Peplum', 'A-line', 'Straight cut', 'Flowy',
                    // Construction Details
                    'Lined', 'Unlined', 'Stretch fabric', 'Non-stretch', 'Sheer', 'Opaque', 'Semi-sheer', 'Double layer', 'Mesh panels', 'Lace panels', 'Contrast panels',
                    // Pockets & Practical Features
                    'Chest pocket', 'Breast pocket', 'Side pockets', 'Hidden pockets', 'Patch pockets', 'No pockets', 'Functional pockets', 'Fake pockets',
                    // Design Details & Embellishments
                    'Pleated', 'Gathered', 'Ruched', 'Shirred', 'Smocked', 'Tucked', 'Pintucks', 'Darts', 'Princess seams', 'Side slits', 'Vent hem', 'Curved hem', 'Straight hem', 'Ruffles', 'Fringe', 'Tassels', 'Embroidered', 'Beaded', 'Sequined', 'Appliqué', 'Lace trim', 'Contrast trim', 'Piping', 'Topstitching', 'French seams'
                ];
            } else if (itemType.includes('sweater') || itemType.includes('cardigan')) {
                features = [
                    // Knit Types & Construction
                    'Cable knit', 'Aran knit', 'Fisherman knit', 'Fair Isle', 'Intarsia', 'Jacquard', 'Nordic knit', 'Icelandic knit', 'Waffle knit', 'Honeycomb knit', 'Seed stitch', 'Moss stitch', 'Basket weave', 'Ribbed knit', 'Stockinette', 'Garter stitch', 'Bobble knit', 'Popcorn stitch', 'Lattice knit', 'Twist stitch',
                    // Knit Weight & Texture
                    'Chunky knit', 'Bulky knit', 'Worsted weight', 'DK weight', 'Fine knit', 'Lightweight knit', 'Medium weight', 'Heavy knit', 'Textured knit', 'Smooth knit', 'Brushed knit', 'Fuzzy knit', 'Bouclé knit', 'Marled knit', 'Slub knit',
                    // Necklines
                    'Crew neck', 'Round neck', 'V-neck', 'Deep V-neck', 'Cardigan V-neck', 'Scoop neck', 'Boat neck', 'Cowl neck', 'Turtleneck', 'Mock neck', 'Funnel neck', 'High neck', 'Split neck', 'Henley neck', 'Polo neck', 'Keyhole neck',
                    // Cardigan Specific Features
                    'Button front', 'Snap front', 'Zip front', 'Open front', 'Waterfall front', 'Drape front', 'Tie front', 'Wrap style', 'Belted', 'Long cardigan', 'Cropped cardigan', 'Boyfriend cardigan', 'Oversized cardigan',
                    // Sleeves & Fit
                    'Long sleeves', 'Three-quarter sleeves', 'Short sleeves', 'Cap sleeves', 'Sleeveless', 'Dolman sleeves', 'Raglan sleeves', 'Drop shoulder', 'Set-in sleeves', 'Balloon sleeves', 'Bishop sleeves',
                    // Overall Fit & Style
                    'Pullover', 'Oversized', 'Relaxed fit', 'Regular fit', 'Slim fit', 'Fitted', 'Cropped', 'Regular length', 'Long length', 'Tunic length', 'Duster length', 'Boxy', 'A-line', 'Straight cut',
                    // Construction Details
                    'Ribbed cuffs', 'Ribbed hem', 'Ribbed neckline', 'Raw edges', 'Rolled edges', 'Contrast cuffs', 'Contrast collar', 'Contrast trim', 'Side slits', 'Vent hem', 'High-low hem', 'Curved hem', 'Straight hem',
                    // Pockets & Features
                    'Patch pockets', 'Kangaroo pocket', 'Side pockets', 'Chest pocket', 'No pockets', 'Functional pockets', 'Hood', 'Drawstring hood', 'Toggle details', 'Button details', 'Zip details',
                    // Seasonal & Pattern Features
                    'Christmas design', 'Holiday motif', 'Snowflake pattern', 'Reindeer motif', 'Hearts pattern', 'Star pattern', 'Striped', 'Color block', 'Ombre', 'Gradient', 'Two-tone', 'Multi-color', 'Solid color'
                ];
            } else if (itemType.includes('shoes') || itemType.includes('boots') || itemType.includes('heels') || itemType.includes('flats') || itemType.includes('sneakers') || itemType.includes('sandals')) {
                features = [
                    // Heel Types & Heights
                    'Flat', 'Low heel', 'Mid heel', 'High heel', 'Very high heel', 'Stiletto', 'Block heel', 'Chunky heel', 'Platform', 'Wedge', 'Kitten heel', 'Cuban heel', 'Stacked heel', 'Wood heel', 'Clear heel', 'Cone heel', 'Flare heel',
                    // Closure & Fastenings
                    'Lace-up', 'Slip-on', 'Zip-up', 'Buckle closure', 'Velcro closure', 'Elastic closure', 'Hook and loop', 'Toggle closure', 'Ankle strap', 'T-bar strap', 'Mary Jane strap', 'Multi-strap', 'Backless', 'Slingback',
                    // Toe Styles
                    'Pointed toe', 'Round toe', 'Square toe', 'Almond toe', 'Open toe', 'Closed toe', 'Peep toe', 'Split toe', 'Wide toe box', 'Narrow toe box',
                    // Boot Specific Heights
                    'Ankle boots', 'Low boots', 'Mid-calf boots', 'Knee-high boots', 'Over-the-knee boots', 'Thigh-high boots', 'Chelsea boots', 'Combat boots', 'Hiking boots', 'Rain boots', 'Snow boots',
                    // Construction & Materials
                    'Leather upper', 'Suede upper', 'Canvas upper', 'Mesh upper', 'Synthetic upper', 'Patent leather', 'Nubuck', 'Fabric upper', 'Rubber sole', 'Leather sole', 'Synthetic sole', 'Cork sole', 'Crepe sole', 'Vibram sole',
                    // Comfort & Support Features
                    'Cushioned sole', 'Memory foam', 'Arch support', 'Padded collar', 'Padded tongue', 'Breathable lining', 'Moisture-wicking', 'Anti-slip sole', 'Grip sole', 'Flexible sole', 'Shock absorption', 'Orthotic-friendly',
                    // Design Details
                    'Perforated', 'Brogue details', 'Wingtip', 'Cap toe', 'Plain toe', 'Medallion toe', 'Laser cut', 'Cut-out design', 'Woven details', 'Braided details', 'Studded', 'Buckle details', 'Chain details', 'Tassel', 'Fringe', 'Embossed pattern',
                    // Sneaker Specific
                    'High-top', 'Low-top', 'Mid-top', 'Basketball style', 'Running style', 'Tennis style', 'Skate style', 'Retro style', 'Chunky sole', 'Minimalist design',
                    // Sandal Specific
                    'Strappy', 'Gladiator style', 'Slide style', 'Flip-flop style', 'Espadrille', 'Platform sandals', 'Flat sandals', 'Heeled sandals', 'Sports sandals', 'Dress sandals',
                    // Special Features
                    'Waterproof', 'Water-resistant', 'Non-slip', 'Steel toe', 'Composite toe', 'Safety features', 'Reflective details', 'LED lights', 'Removable insole', 'Adjustable fit'
                ];
            } else if (itemType.includes('bag') || itemType.includes('purse') || itemType.includes('clutch') || itemType.includes('tote') || itemType.includes('backpack')) {
                features = [
                    // Handle & Strap Options
                    'Top handles', 'Shoulder strap', 'Crossbody strap', 'Adjustable strap', 'Removable strap', 'Chain strap', 'Leather strap', 'Fabric strap', 'Long strap', 'Short strap', 'Padded straps', 'Convertible straps', 'Handle drop', 'No handles', 'Grab handles',
                    // Closure Types
                    'Zip closure', 'Magnetic closure', 'Snap closure', 'Drawstring closure', 'Flap closure', 'Buckle closure', 'Turn lock', 'Push lock', 'Twist lock', 'Clasp closure', 'Hook closure', 'Open top', 'Zip-around', 'Double zip', 'Security zip',
                    // Size & Capacity
                    'Mini bag', 'Small bag', 'Medium bag', 'Large bag', 'Oversized', 'Compact', 'Roomy interior', 'Spacious', 'Limited capacity', 'Fits laptop', 'Fits tablet', 'Fits phone', 'Travel size', 'Everyday size',
                    // Interior Features
                    'Lined interior', 'Unlined interior', 'Multiple compartments', 'Single compartment', 'Zip pocket', 'Slip pockets', 'Phone pocket', 'Card slots', 'Pen holders', 'Key clip', 'Interior organizer', 'Padded laptop sleeve', 'Bottle holder', 'Secure pockets',
                    // Exterior Features
                    'Front pockets', 'Back pockets', 'Side pockets', 'Zip pockets', 'Slip pockets', 'Hidden pockets', 'Security pockets', 'No exterior pockets', 'Expandable', 'Structured', 'Unstructured', 'Soft structure', 'Hard structure',
                    // Construction & Hardware
                    'Quilted', 'Smooth finish', 'Textured surface', 'Embossed pattern', 'Perforated', 'Woven construction', 'Braided details', 'Gold hardware', 'Silver hardware', 'Gunmetal hardware', 'Rose gold hardware', 'Black hardware', 'Brushed hardware', 'Polished hardware',
                    // Style & Silhouette
                    'Structured silhouette', 'Slouchy', 'Boxy shape', 'Curved shape', 'Rectangular', 'Square', 'Round', 'Oval', 'Triangular', 'Geometric', 'Asymmetrical', 'Classic shape', 'Modern design', 'Vintage inspired',
                    // Backpack Specific
                    'Laptop compartment', 'Multiple zippers', 'Chest strap', 'Waist belt', 'Hydration compatible', 'School bag', 'Travel backpack', 'Hiking backpack', 'Urban backpack', 'Rolling backpack',
                    // Tote Specific
                    'Open top tote', 'Zip top tote', 'Snap closure tote', 'Canvas tote', 'Leather tote', 'Reversible', 'Foldable', 'Beach bag', 'Shopping bag', 'Work tote',
                    // Evening/Clutch Specific
                    'Envelope style', 'Box clutch', 'Fold-over clutch', 'Wristlet', 'Chain purse', 'Beaded', 'Sequined', 'Satin finish', 'Metallic finish', 'Crystal details',
                    // Special Features
                    'Water-resistant', 'Lightweight', 'Heavy-duty', 'Eco-friendly', 'Vegan leather', 'Sustainable materials', 'Handmade', 'Machine washable', 'Stain-resistant', 'RFID blocking'
                ];
            } else if (itemType.includes('jewelry') || itemType.includes('necklace') || itemType.includes('bracelet') || itemType.includes('ring') || itemType.includes('earrings')) {
                features = [
                    // Metal Types & Finishes
                    'Gold', 'Rose gold', 'White gold', 'Yellow gold', 'Sterling silver', 'Silver plated', 'Gold plated', 'Gold filled', 'Vermeil', 'Stainless steel', 'Titanium', 'Platinum', 'Brass', 'Bronze', 'Copper', 'Pewter', 'Alloy',
                    // Metal Finishes
                    'Polished finish', 'Matte finish', 'Brushed finish', 'Satin finish', 'Hammered finish', 'Textured finish', 'Oxidized finish', 'Antique finish', 'Vintage finish', 'High polish', 'Mirror finish',
                    // Chain Types (Necklaces/Bracelets)
                    'Cable chain', 'Curb chain', 'Figaro chain', 'Rope chain', 'Box chain', 'Snake chain', 'Wheat chain', 'Byzantine chain', 'Herringbone chain', 'Singapore chain', 'Anchor chain', 'Trace chain', 'Belcher chain', 'Paperclip chain', 'Link chain',
                    // Clasp Types
                    'Lobster clasp', 'Spring ring clasp', 'Toggle clasp', 'Magnetic clasp', 'Box clasp', 'Hook clasp', 'S-hook clasp', 'Barrel clasp', 'Fold-over clasp', 'Push clasp', 'Screw clasp', 'Bayonet clasp',
                    // Stone Settings & Types
                    'Prong setting', 'Bezel setting', 'Channel setting', 'Pavé setting', 'Tension setting', 'Flush setting', 'Claw setting', 'Gypsy setting', 'Invisible setting', 'Cluster setting', 'Halo setting', 'Three stone', 'Five stone', 'Solitaire',
                    // Gemstones & Materials
                    'Diamond', 'Cubic zirconia', 'Crystal', 'Rhinestone', 'Pearl', 'Freshwater pearl', 'Cultured pearl', 'Natural pearl', 'Birthstone', 'Semi-precious stone', 'Precious stone', 'Glass bead', 'Ceramic', 'Wood', 'Resin', 'Enamel',
                    // Necklace Specific
                    'Choker length', 'Princess length', 'Matinee length', 'Opera length', 'Rope length', 'Pendant necklace', 'Chain necklace', 'Statement necklace', 'Layering necklace', 'Collar necklace', 'Bib necklace', 'Lariat necklace', 'Rivière necklace',
                    // Earring Specific
                    'Stud earrings', 'Drop earrings', 'Dangle earrings', 'Hoop earrings', 'Huggie earrings', 'Chandelier earrings', 'Statement earrings', 'Climber earrings', 'Cuff earrings', 'Threader earrings', 'Post back', 'French hook', 'Lever back', 'Clip-on', 'Screw back',
                    // Bracelet Specific
                    'Charm bracelet', 'Tennis bracelet', 'Cuff bracelet', 'Bangle bracelet', 'Chain bracelet', 'Link bracelet', 'Stretch bracelet', 'Wrap bracelet', 'Friendship bracelet', 'Sliding clasp', 'Adjustable size',
                    // Ring Specific
                    'Solitaire ring', 'Band ring', 'Statement ring', 'Cocktail ring', 'Eternity ring', 'Three stone ring', 'Cluster ring', 'Stackable ring', 'Midi ring', 'Pinky ring', 'Adjustable ring', 'Open band', 'Closed band',
                    // Design Styles
                    'Vintage style', 'Art deco', 'Victorian', 'Edwardian', 'Modern', 'Contemporary', 'Minimalist', 'Bohemian', 'Geometric', 'Floral motif', 'Animal motif', 'Abstract design', 'Religious symbol', 'Initial jewelry', 'Personalized',
                    // Special Features
                    'Adjustable length', 'Convertible design', 'Reversible', 'Interchangeable', 'Stackable', 'Layerable', 'Hypoallergenic', 'Nickel-free', 'Tarnish resistant', 'Water resistant', 'Handmade', 'Vintage piece', 'One of a kind', 'Limited edition'
                ];
            } else if (itemType.includes('hat') || itemType.includes('cap') || itemType.includes('beanie')) {
                features = [
                    // Hat Styles & Construction
                    'Fitted cap', 'Adjustable cap', 'Snapback', 'Trucker hat', 'Dad hat', 'Baseball cap', 'Sports cap', 'Military cap', 'Newsboy cap', 'Cabbie hat', 'Bucket hat', 'Sun hat', 'Wide brim', 'Narrow brim', 'No brim', 'Visor only',
                    // Closure & Fit
                    'Adjustable strap', 'Velcro closure', 'Snap closure', 'Buckle closure', 'Elastic band', 'Drawstring', 'One size fits all', 'Structured crown', 'Unstructured crown', 'Soft crown', 'Pre-curved brim', 'Flat brim',
                    // Brim & Visor Features
                    'Curved visor', 'Flat visor', 'Flexible brim', 'Rigid brim', 'Wire brim', 'Reinforced brim', 'Bendable brim', 'Sun protection', 'UV protection', 'UPF rating', 'Reflective underside',
                    // Beanie & Winter Hat Features
                    'Cuffed beanie', 'Slouchy beanie', 'Fitted beanie', 'Oversized beanie', 'Ribbed knit', 'Cable knit', 'Chunky knit', 'Fine knit', 'Pom pom', 'No pom pom', 'Fold-up cuff', 'Turn-up edge', 'Earflaps', 'Chin strap',
                    // Materials & Lining
                    'Cotton crown', 'Wool blend', 'Acrylic knit', 'Fleece lined', 'Mesh panels', 'Breathable fabric', 'Moisture-wicking', 'Quick-dry', 'Water-resistant', 'Windproof', 'Thermal lining', 'Soft lining', 'Unlined',
                    // Design & Decoration
                    'Embroidered logo', 'Printed design', 'Patch logo', 'Metal eyelets', 'Ventilation holes', 'Contrast stitching', 'Decorative buttons', 'Badge details', 'Pin attachments', 'Removable pins', 'Plain design', 'Graphic design',
                    // Seasonal Features
                    'Winter hat', 'Summer hat', 'All-season', 'Insulated', 'Lightweight', 'Heavy-duty', 'Packable', 'Crushable', 'Travel-friendly', 'Foldable',
                    // Special Features
                    'Sweatband', 'Moisture management', 'Odor-resistant', 'Machine washable', 'Hand wash only', 'Stain-resistant', 'Fade-resistant', 'Shrink-resistant', 'Size guide included', 'Care instructions'
                ];
            } else if (itemType.includes('scarf') || itemType.includes('shawl') || itemType.includes('wrap')) {
                features = [
                    // Size & Dimensions
                    'Long scarf', 'Short scarf', 'Square scarf', 'Rectangular scarf', 'Triangle scarf', 'Oversized', 'Compact size', 'Travel size', 'Blanket scarf', 'Infinity scarf', 'Loop scarf', 'Circle scarf',
                    // Fabric Weight & Texture
                    'Lightweight', 'Medium weight', 'Heavy weight', 'Sheer fabric', 'Opaque fabric', 'Semi-sheer', 'Smooth texture', 'Textured surface', 'Soft feel', 'Structured feel', 'Flowing fabric', 'Stiff fabric',
                    // Edges & Finishing
                    'Fringed edges', 'Raw edges', 'Hemmed edges', 'Rolled hem', 'Serged edges', 'Hand-finished edges', 'Tasseled ends', 'Knotted fringe', 'Beaded fringe', 'Contrast edging', 'Scalloped edges',
                    // Construction Details
                    'Hand-rolled hem', 'Machine hem', 'Double-sided', 'Reversible', 'Single layer', 'Double layer', 'Lined', 'Unlined', 'Woven fabric', 'Knitted fabric', 'Crocheted', 'Embroidered details',
                    // Styling Options
                    'Versatile styling', 'Head scarf', 'Neck scarf', 'Shoulder wrap', 'Belt alternative', 'Hair accessory', 'Bag accessory', 'Multiple wearing styles', 'Easy to style', 'Statement piece',
                    // Seasonal Suitability
                    'Summer scarf', 'Winter scarf', 'Spring scarf', 'Fall scarf', 'All-season', 'Beach cover-up', 'Evening wrap', 'Travel scarf', 'Formal occasions', 'Casual wear',
                    // Special Features
                    'Sun protection', 'UV protection', 'Windproof', 'Moisture-wicking', 'Quick-dry', 'Wrinkle-resistant', 'Packable', 'Travel-friendly', 'Machine washable', 'Hand wash only', 'Dry clean only',
                    // Design Elements
                    'Border design', 'All-over pattern', 'Central motif', 'Corner details', 'Gradient colors', 'Ombre effect', 'Color-blocked', 'Solid color', 'Subtle pattern', 'Bold pattern', 'Geometric design', 'Floral design',
                    // Cultural & Designer Elements
                    'Designer inspired', 'Vintage style', 'Traditional pattern', 'Cultural motif', 'Artistic design', 'Hand-painted', 'Block print', 'Screen print', 'Digital print', 'Handmade', 'Artisan made'
                ];
            } else if (itemType.includes('belt')) {
                features = [
                    // Belt Width & Size
                    'Wide belt', 'Medium width', 'Narrow belt', 'Skinny belt', 'Extra wide', 'Statement width', 'Adjustable length', 'Multiple holes', 'Size range', 'One size',
                    // Buckle Types & Hardware
                    'Metal buckle', 'Plastic buckle', 'Wooden buckle', 'Fabric buckle', 'Logo buckle', 'Designer buckle', 'Plain buckle', 'Decorative buckle', 'Removable buckle', 'Interchangeable buckle', 'No buckle', 'D-ring closure', 'Snap closure',
                    // Buckle Styles
                    'Prong buckle', 'Pin buckle', 'Plate buckle', 'Frame buckle', 'Ring buckle', 'Slide buckle', 'Magnetic buckle', 'Quick-release buckle', 'Auto-lock buckle', 'Roller buckle',
                    // Construction & Materials
                    'Genuine leather', 'Faux leather', 'Bonded leather', 'Full grain leather', 'Top grain leather', 'Suede finish', 'Patent finish', 'Matte finish', 'Glossy finish', 'Textured leather', 'Smooth leather', 'Embossed pattern',
                    // Hardware Finishes
                    'Gold hardware', 'Silver hardware', 'Gunmetal hardware', 'Rose gold hardware', 'Black hardware', 'Brass hardware', 'Copper hardware', 'Chrome hardware', 'Brushed finish', 'Polished finish', 'Matte finish', 'Antique finish',
                    // Design Details
                    'Studded belt', 'Braided belt', 'Woven belt', 'Chain belt', 'Rope belt', 'Cord belt', 'Mesh belt', 'Link belt', 'Perforated belt', 'Quilted belt', 'Smooth belt', 'Textured belt',
                    // Closure & Adjustment
                    'Traditional holes', 'No holes', 'Ratchet system', 'Elastic stretch', 'Adjustable sizing', 'Cut-to-fit', 'Reversible', 'Double-sided', 'One-sided design',
                    // Style Categories
                    'Dress belt', 'Casual belt', 'Work belt', 'Evening belt', 'Statement belt', 'Classic style', 'Modern design', 'Vintage inspired', 'Minimalist', 'Decorative', 'Functional',
                    // Special Features
                    'Water-resistant', 'Scratch-resistant', 'Fade-resistant', 'Stretch material', 'Rigid construction', 'Flexible', 'Lightweight', 'Heavy-duty', 'Machine washable', 'Hand wash only', 'Easy care'
                ];
            } else if (itemType.includes('watch')) {
                features = [
                    // Movement Types
                    'Quartz movement', 'Automatic movement', 'Mechanical movement', 'Solar powered', 'Kinetic movement', 'Digital movement', 'Analog display', 'Digital display', 'Analog-digital combo',
                    // Case Materials & Finishes
                    'Stainless steel case', 'Gold case', 'Rose gold case', 'Silver case', 'Titanium case', 'Ceramic case', 'Plastic case', 'Aluminum case', 'Polished case', 'Brushed case', 'Matte case',
                    // Band/Strap Types
                    'Metal bracelet', 'Leather strap', 'Rubber strap', 'Silicone strap', 'Fabric strap', 'NATO strap', 'Mesh bracelet', 'Chain bracelet', 'Link bracelet', 'Adjustable strap', 'Quick-release strap', 'Interchangeable strap',
                    // Water Resistance
                    'Water resistant', 'Waterproof', 'Swim-proof', 'Dive watch', '30m water resistance', '50m water resistance', '100m water resistance', '200m water resistance', 'Not water resistant',
                    // Display Features
                    'Date display', 'Day-date display', 'Chronograph', 'Stopwatch', 'Timer', 'Alarm', 'Backlight', 'Luminous hands', 'Luminous markers', 'LED display', 'LCD display',
                    // Size & Fit
                    'Small case', 'Medium case', 'Large case', 'Oversized', 'Thin profile', 'Thick case', 'Adjustable band', 'Links removable', 'Fits small wrist', 'Fits large wrist',
                    // Special Functions
                    'Smart features', 'Fitness tracking', 'Heart rate monitor', 'GPS', 'Bluetooth', 'Notifications', 'Touch screen', 'Voice control', 'App connectivity',
                    // Design Style
                    'Dress watch', 'Sports watch', 'Casual watch', 'Luxury watch', 'Fashion watch', 'Vintage style', 'Modern design', 'Classic design', 'Minimalist', 'Statement piece',
                    // Crystal & Protection
                    'Mineral crystal', 'Sapphire crystal', 'Hardlex crystal', 'Scratch resistant', 'Shatter resistant', 'Anti-reflective coating',
                    // Condition & Accessories
                    'Original box', 'Original papers', 'Manual included', 'Warranty card', 'Extra links', 'New battery', 'Recently serviced', 'Working condition', 'Needs battery'
                ];
            } else {
                // Default comprehensive features for other items
                features = [
                    'Adjustable', 'One size', 'Small', 'Medium', 'Large', 'Compact', 'Oversized',
                    'Lightweight', 'Heavy-duty', 'Durable', 'Flexible', 'Rigid', 'Soft', 'Structured',
                    'Water-resistant', 'Windproof', 'Breathable', 'Quick-dry', 'Moisture-wicking',
                    'Machine washable', 'Hand wash only', 'Dry clean only', 'Easy care', 'Low maintenance',
                    'Vintage style', 'Modern design', 'Classic', 'Contemporary', 'Minimalist', 'Statement piece',
                    'Handmade', 'Artisan made', 'Designer', 'Limited edition', 'Unique', 'Rare find',
                    'Functional', 'Decorative', 'Practical', 'Stylish', 'Versatile', 'Multi-purpose',
                    'Gift-worthy', 'Special occasion', 'Everyday use', 'Travel-friendly', 'Packable'
                ];
            }
            
            if (features.length === 0) {
                featuresGrid.innerHTML = '<p class="col-span-full text-gray-500 dark:text-gray-400 text-sm italic">Select an item type to see feature options</p>';
                return;
            }
            
            // Create checkboxes for each feature
            features.forEach(feature => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded text-sm';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = feature;
                checkbox.className = 'rounded border-gray-300 text-primary focus:ring-primary focus:ring-2';
                
                const span = document.createElement('span');
                span.textContent = feature;
                span.className = 'text-gray-700 dark:text-gray-300';
                
                label.appendChild(checkbox);
                label.appendChild(span);
                featuresGrid.appendChild(label);
            });
        }

        async function generateDescription() {
            // Validate required fields
            const itemType = document.getElementById('item-type').value;
            const size = document.getElementById('size').value;
            const material1 = document.getElementById('material1').value;
            const condition = document.getElementById('condition').value;
            const selectedColors = getSelectedColors();

            // Check if size is required (not required for accessories)
            const isAccessory = isAccessoryItem(itemType);
            const sizeRequired = !isAccessory;

            if (!itemType || (sizeRequired && !size) || !material1 || !condition || !selectedColors) {
                const missingFields = [];
                if (!itemType) missingFields.push('Item Type');
                if (sizeRequired && !size) missingFields.push('Size');
                if (!material1) missingFields.push('Primary Material');
                if (!condition) missingFields.push('Condition');
                if (!selectedColors) missingFields.push('Color');
                
                showAlert(`Please fill in the required fields: ${missingFields.join(', ')}`);
                return;
            }

            const generateBtn = document.getElementById('generate-btn');
            const generateText = document.getElementById('generate-text');
            const generateLoading = document.getElementById('generate-loading');
            
            generateBtn.disabled = true;
            generateText.classList.add('hidden');
            generateLoading.classList.remove('hidden');

            try {
                // Collect all form data
                const brand = document.getElementById('brand').value;
                const era = document.getElementById('era').value;
                const color = getSelectedColors();
                const pattern = document.getElementById('pattern').value;
                const fit = document.getElementById('fit').value;
                const length = document.getElementById('length').value;
                const measurements = document.getElementById('measurements').value;
                const flaws = document.getElementById('flaws').value;
                const material2 = document.getElementById('material2').value;
                const customFeatures = document.getElementById('custom-features').value;
                const styleAesthetic = document.getElementById('style-aesthetic').value;
                const fitNotes = document.getElementById('fit-notes').value;

                // Collect selected features from checkboxes
                const selectedFeatures = [];
                const checkboxes = document.querySelectorAll('#features-grid input[type="checkbox"]:checked');
                checkboxes.forEach(checkbox => {
                    selectedFeatures.push(checkbox.value);
                });
                
                // Combine selected features with custom features
                let allFeatures = selectedFeatures.join(', ');
                if (customFeatures) {
                    allFeatures += allFeatures ? `, ${customFeatures}` : customFeatures;
                }

                // Collect selected season (radio button)
                const selectedSeason = document.querySelector('input[name="season"]:checked');
                const season = selectedSeason ? selectedSeason.value : '';

                // Build material string
                let materialString = material1;
                if (material2) {
                    materialString += `/${material2}`;
                }

                // Determine if we should show era
                const showEra = era && era !== 'Unspecified Vintage';

                // Generate hashtags using our smart system
                const generatedHashtags = generateSmartHashtags({
                    itemType, brand, color, pattern, material1, era, styleAesthetic, 
                    fit, season
                });

                // Fix condition display for BNWT/NWOT
                let displayCondition = condition;
                if (condition === 'BNWT') {
                    displayCondition = 'Brand new with tags';
                } else if (condition === 'NWOT') {
                    displayCondition = 'New without tags';
                }

                // Smart capitalization function for all text inputs
                function smartCapitalize(text) {
                    if (!text || text.trim() === '') return '';
                    return text.charAt(0).toUpperCase() + text.slice(1);
                }

                // Auto-capitalize ALL text inputs
                const capitalizedBrand = brand ? smartCapitalize(brand) : 'Unbranded';
                const capitalizedFitNotes = fitNotes ? smartCapitalize(fitNotes) : '';
                const capitalizedMeasurements = measurements ? smartCapitalize(measurements) : '';
                const capitalizedFlaws = flaws ? smartCapitalize(flaws) : '';
                const capitalizedCustomFeatures = customFeatures ? smartCapitalize(customFeatures) : '';
                const capitalizedSize = size ? smartCapitalize(size) : '';
                const capitalizedStyleAesthetic = styleAesthetic ? smartCapitalize(styleAesthetic) : '';

                // Check if this is an accessory (no washing/steaming needed)
                const isAccessory = isAccessoryItem(itemType);
                
                // Create structured listing format prompt
                let prompt = `Generate ONLY the listing content. No intro phrases, no "Here's your listing", no "Feel free to modify", no explanations. Start directly with the first line:

Brand: ${capitalizedBrand}`;

                // Only include size if it's provided
                if (size && size.trim()) {
                    prompt += `
Size: ${size}`;
                }

                prompt += `
Material: ${materialString}
Colour: ${color}${pattern ? `
Pattern: ${pattern}` : ''}${showEra ? `
Era: ${era}` : ''}${fit ? `
Fit: ${fit}` : ''}${length ? `
Length: ${length}` : ''}${allFeatures ? `
Features: ${allFeatures}` : ''}${season ? `
Season: ${season}` : ''}${measurements ? `
Measurements: ${measurements}` : ''}
Condition: ${displayCondition}
${flaws ? `
Please note: ${flaws}` : ''}

${isAccessory ? 'Ships within 2 working days.' : 'Washed and steamed, ships within 2 working days.'}

${generatedHashtags}`;

                // Call Poe API
                const response = await callPoeAPI(prompt);
                displayDescription(response);
                resetButton();

            } catch (error) {
                console.error('Generation error:', error);
                showAlert('Generation failed. Please try again.');
                resetButton();
            }
        }

        function resetButton() {
            const generateBtn = document.getElementById('generate-btn');
            const generateText = document.getElementById('generate-text');
            const generateLoading = document.getElementById('generate-loading');
            
            generateBtn.disabled = false;
            generateText.classList.remove('hidden');
            generateLoading.classList.add('hidden');
        }

        function displayDescription(description) {
            // CRITICAL: Set global variable AND log for debugging
            currentDescription = description;
            console.log('✅ DESCRIPTION SET SUCCESSFULLY:', {
                'Length': description.length,
                'Contains Brand': description.includes('Brand:'),
                'Contains hashtags': description.includes('#'),
                'Preview': description.substring(0, 200) + '...'
            });
            
            document.getElementById('generated-description').innerHTML = marked.parse(description);
            document.getElementById('description-section').classList.remove('hidden');
            
            // Automatically generate title after description is ready
            generateTitle();
            
            document.getElementById('description-section').scrollIntoView({ behavior: 'smooth' });
        }

        async function copyDescription() {
            try {
                const element = document.getElementById('generated-description');
                const text = element.textContent || element.innerText;
                await navigator.clipboard.writeText(text);
                
                const btn = document.getElementById('copy-btn');
                const original = btn.textContent;
                btn.textContent = '✅ Copied!';
                setTimeout(() => btn.textContent = original, 2000);
            } catch (error) {
                showAlert('Copy failed. Please copy manually.');
            }
        }

        function showEditModal() {
            document.getElementById('edit-text').value = currentDescription;
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        function hideEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
        }

        function saveEdit() {
            currentDescription = document.getElementById('edit-text').value;
            displayDescription(currentDescription);
            hideEditModal();
        }

        function startNew() {
            document.querySelectorAll('input, select, textarea').forEach(el => el.value = '');
            document.getElementById('description-section').classList.add('hidden');
            currentDescription = '';
            
            // Clear the title text
            document.getElementById('generated-title').textContent = '';
            
            // Clear any checked checkboxes and radio buttons
            document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
            document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);
            
            // Reset features grid
            updateFeaturesPlaceholder();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ============ POE API INTEGRATION ============

        function isPoeAPIAvailable() {
            return typeof window !== 'undefined' && 
                   typeof window.Poe !== 'undefined' && 
                   typeof window.Poe.sendUserMessage === 'function' &&
                   typeof window.Poe.registerHandler === 'function';
        }

        async function callPoeAPI(prompt) {
            // Check if Poe API is available
            if (!isPoeAPIAvailable()) {
                console.log('Poe API not available - using demo mode for testing outside Poe');
                return generateDemoContent(prompt);
            }

            return new Promise((resolve, reject) => {
                console.log('Using Poe API to generate content...');
                
                // Register handler for the response
                window.Poe.registerHandler("listing-generator", (result) => {
                    const msg = result.responses[0];
                    console.log('Poe API Response status:', msg.status);
                    
                    if (msg.status === "complete") {
                        console.log('Poe API response received successfully');
                        resolve(msg.content.trim());
                    } else if (msg.status === "error") {
                        console.error('Poe API error:', msg.statusText);
                        reject(new Error(msg.statusText || 'Poe API error'));
                    }
                    // For "incomplete" status, we just wait for more content
                });

                // Send the prompt to GPT-4o-mini (much cheaper)
                window.Poe.sendUserMessage(`@GPT-4o-mini ${prompt}`, {
                    handler: "listing-generator",
                    stream: false,
                    openChat: false
                }).catch(error => {
                    console.error('Failed to send message to Poe:', error);
                    reject(new Error('Failed to communicate with Poe API'));
                });
            });
        }

        // Demo content generator for testing outside Poe
        async function generateDemoContent(prompt) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Parse the prompt to extract key information
            const promptLines = prompt.split('\n');
            let brand = 'Demo Brand';
            let size = 'M';
            let material = 'Cotton';
            let color = 'Black';
            let itemType = 'Top';
            let condition = 'Very good';
            let era = '';
            let fit = '';
            let length = '';
            let features = '';
            let season = '';
            let flaws = '';
            let pattern = '';
            let measurements = '';
            
            promptLines.forEach(line => {
                if (line.includes('Brand:')) brand = line.split('Brand:')[1].trim();
                if (line.includes('Size:')) size = line.split('Size:')[1].trim();
                if (line.includes('Material:')) material = line.split('Material:')[1].trim();
                if (line.includes('Colour:')) color = line.split('Colour:')[1].trim();
                if (line.includes('Condition:')) condition = line.split('Condition:')[1].trim();
                if (line.includes('Era:')) era = line.split('Era:')[1].trim();
                if (line.includes('Fit:')) fit = line.split('Fit:')[1].trim();
                if (line.includes('Length:')) length = line.split('Length:')[1].trim();
                if (line.includes('Features:')) features = line.split('Features:')[1].trim();
                if (line.includes('Season:')) season = line.split('Season:')[1].trim();
                if (line.includes('Please note:')) flaws = line.split('Please note:')[1].trim();
                if (line.includes('Pattern:')) pattern = line.split('Pattern:')[1].trim();
                if (line.includes('Measurements:')) measurements = line.split('Measurements:')[1].trim();
            });
            
            // Fix condition display
            let displayCondition = condition;
            if (condition === 'BNWT') {
                displayCondition = 'Brand new with tags';
            } else if (condition === 'NWOT') {
                displayCondition = 'New without tags';
            }
            
            // Generate a realistic Vinted listing format
            let demoContent = `Brand: ${brand}
Size: ${size}
Material: ${material}
Colour: ${color}`;

            if (pattern) demoContent += `\nPattern: ${pattern}`;
            if (era) demoContent += `\nEra: ${era}`;
            if (fit) demoContent += `\nFit: ${fit}`;
            if (length) demoContent += `\nLength: ${length}`;
            if (features) demoContent += `\nFeatures: ${features}`;
            if (season) demoContent += `\nSeason: ${season}`;
            if (measurements) demoContent += `\nMeasurements: ${measurements}`;
            
            demoContent += `\nCondition: ${displayCondition}`;
            
            if (flaws) demoContent += `\n\nPlease note: ${flaws}`;
            
            demoContent += `\n\nWashed and steamed, ships within 2 working days.`;
            
            // Generate more relevant hashtags
            const hashtagData = {
                itemType: itemType || 'Top',
                brand: brand,
                color: color,
                pattern: pattern,
                material1: material,
                era: era,
                fit: fit
            };
            
            const relevantHashtags = generateSmartHashtags(hashtagData);
            demoContent += `\n\n${relevantHashtags}`;
            
            return demoContent;
        }

        // ============ TITLE GENERATION FUNCTIONS ============

        async function generateTitle() {
            // Validate required fields
            const itemType = document.getElementById('item-type').value;
            const size = document.getElementById('size').value;
            const material1 = document.getElementById('material1').value;
            const condition = document.getElementById('condition').value;
            const color = getSelectedColors();

            // Check if size is required (not required for accessories)
            const isAccessory = isAccessoryItem(itemType);
            const sizeRequired = !isAccessory;

            if (!itemType || (sizeRequired && !size) || !material1 || !condition || !color) {
                return; // Silently fail if called automatically and fields aren't filled
            }

            try {
                // Collect key form data for title
                const brand = document.getElementById('brand').value;
                const era = document.getElementById('era').value;
                const pattern = document.getElementById('pattern').value;
                const fit = document.getElementById('fit').value;
                const length = document.getElementById('length').value;
                const styleAesthetic = document.getElementById('style-aesthetic').value;

                // Generate title using demo mode logic if Poe API not available
                if (!isPoeAPIAvailable()) {
                    const demoTitle = generateDemoTitle({
                        itemType, brand, size, color, era, fit, length, pattern, styleAesthetic, condition
                    });
                    displayTitle(demoTitle);
                    return;
                }

                // Build comprehensive prompt for title generation
                let titlePrompt = `Generate a concise, searchable Vinted title (40-60 characters) for this item. Include key search terms buyers use.

Item: ${itemType}`;

                if (brand && brand.toLowerCase() !== 'unbranded' && brand.toLowerCase() !== 'no brand') {
                    titlePrompt += `\nBrand: ${brand}`;
                }

                titlePrompt += `\nSize: ${size}`;
                titlePrompt += `\nColor: ${color}`;

                if (pattern) {
                    titlePrompt += `\nPattern: ${pattern}`;
                }

                if (era && era !== 'Unspecified Vintage' && era !== '2020s') {
                    titlePrompt += `\nEra: ${era}`;
                }

                if (fit) {
                    titlePrompt += `\nFit: ${fit}`;
                }

                if (length) {
                    titlePrompt += `\nLength: ${length}`;
                }

                if (styleAesthetic) {
                    titlePrompt += `\nStyle: ${styleAesthetic}`;
                }

                titlePrompt += `\n\nCreate a title that:
- Starts with brand (if known/popular) or era (if vintage)  
- Includes item type and key descriptors
- Uses Vinted buyer search terms
- Is 40-60 characters max
- Avoids unnecessary words

Examples:
"Zara Black Midi Dress Size M Elegant"
"90s Vintage Mom Jeans High Waisted Size 10"
"COS Oversized Wool Coat Size L Minimalist"

Generate ONLY the title, no explanation.`;

                // Call Poe API for title generation
                const titleResponse = await callPoeAPI(titlePrompt);
                displayTitle(titleResponse);

            } catch (error) {
                console.error('Title generation error:', error);
                showAlert('Title generation failed. Please try again.');
            }
        }

        // Demo title generator for testing outside Poe
        function generateDemoTitle(data) {
            const { itemType, brand, size, color, era, fit, length, pattern, styleAesthetic, condition } = data;
            
            let titleParts = [];
            
            // Start with brand or era
            if (brand && brand.toLowerCase() !== 'unbranded' && brand.toLowerCase() !== 'no brand') {
                titleParts.push(brand);
            } else if (era && era !== 'Unspecified Vintage' && era !== '2020s') {
                titleParts.push(era);
            }
            
            // Add color if not basic
            if (color && !['Black', 'White', 'Grey'].includes(color)) {
                titleParts.push(color);
            }
            
            // Add pattern if specified
            if (pattern) {
                titleParts.push(pattern);
            }
            
            // Add item type
            titleParts.push(itemType);
            
            // Add fit or aesthetic if specified and space allows
            if (fit && titleParts.join(' ').length < 40) {
                titleParts.push(fit);
            } else if (styleAesthetic && titleParts.join(' ').length < 40) {
                titleParts.push(styleAesthetic);
            }
            
            // Always add size
            titleParts.push(`Size ${size}`);
            
            // Limit to reasonable length
            let title = titleParts.join(' ');
            if (title.length > 60) {
                // Remove less important parts
                titleParts = titleParts.slice(0, -2); // Remove last two parts
                titleParts.push(`Size ${size}`); // Keep size
                title = titleParts.join(' ');
            }
            
            return title;
        }

        function resetTitleButton() {
            const generateBtn = document.getElementById('generate-title-btn');
            const generateText = document.getElementById('generate-title-text');
            const generateLoading = document.getElementById('generate-title-loading');
            
            generateBtn.disabled = false;
            generateText.classList.remove('hidden');
            generateLoading.classList.add('hidden');
        }

        function displayTitle(title) {
            // Clean up the title (remove quotes, extra spaces, etc.)
            const cleanTitle = title.replace(/['"]/g, '').trim();
            
            document.getElementById('generated-title').textContent = cleanTitle;
        }

        async function copyTitle() {
            try {
                const titleText = document.getElementById('generated-title').textContent;
                await navigator.clipboard.writeText(titleText);
                
                const btn = document.getElementById('copy-title-btn');
                const original = btn.textContent;
                btn.textContent = '✅ Copied!';
                setTimeout(() => btn.textContent = original, 2000);
            } catch (error) {
                showAlert('Copy failed. Please copy manually.');
            }
        }

        function editTitle() {
            const titleDiv = document.getElementById('generated-title');
            const currentTitle = titleDiv.textContent;
            
            // Create input field for editing
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentTitle;
            input.className = 'w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:text-white';
            input.maxLength = 80;
            
            // Replace title with input
            titleDiv.innerHTML = '';
            titleDiv.appendChild(input);
            input.focus();
            input.select();
            
            // Handle save on Enter or blur
            function saveTitle() {
                const newTitle = input.value.trim();
                titleDiv.textContent = newTitle || currentTitle;
            }
            
            input.addEventListener('blur', saveTitle);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                }
            });
        }

        // ============ NOTION INTEGRATION FUNCTIONS ============

        async function testNotionConnection() {
            // 🔧 UPDATE THESE WITH YOUR ACTUAL VALUES:
            const databaseId = 'YOUR_DATABASE_ID_HERE'; // 32 characters, no dashes
            const apiToken = 'secret_YOUR_INTEGRATION_TOKEN_HERE'; // Must start with secret_

            const testBtn = document.getElementById('test-notion-btn');
            const originalText = testBtn.textContent;
            testBtn.textContent = '🔍 Testing connection...';
            testBtn.disabled = true;

            window.Poe.registerHandler("notion-structure-checker", (result) => {
                const msg = result.responses[0];
                console.log('Database Structure Response:', msg);
                
                if (msg.status === "complete") {
                    // Show the database structure in a detailed modal
                    showDatabaseStructureModal(msg.content);
                } else if (msg.status === "error") {
                    showAlert(`Connection Error: ${msg.statusText || 'Unknown error'}`);
                }
                
                testBtn.textContent = originalText;
                testBtn.disabled = false;
            });

            const structurePrompt = `@Claude-Sonnet-4 IMPORTANT: I need you to make a real HTTP GET request to check my Notion database structure.

DATABASE ID: ${databaseId}
API TOKEN: ${apiToken}

Execute this curl command:

curl -X GET "https://api.notion.com/v1/databases/${databaseId}" \\
  -H "Authorization: Bearer ${apiToken}" \\
  -H "Notion-Version: 2022-06-28"

I need to see:
1. ✅ Connection success/failure
2. 📋 ALL property names (exact spelling, including spaces and capitalization)
3. 🔧 Property types (title, rich_text, select, multi_select, etc.)
4. 📝 For select properties: show available options
5. ⚠️ Any property that's required vs optional

Format your response clearly so I can copy the exact field names for my app.

This is crucial for debugging - I need the EXACT database schema to fix the integration.`;

            try {
                await window.Poe.sendUserMessage(structurePrompt, {
                    handler: "notion-structure-checker",
                    stream: false,
                    openChat: false
                });
            } catch (error) {
                showAlert('Failed to test Notion connection.');
                testBtn.textContent = originalText;
                testBtn.disabled = false;
            }
        }

        function showDatabaseStructureModal(content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">🔍 Notion Database Structure</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Here's your database structure. Look for the EXACT field names to use:</p>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-4 overflow-x-auto">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${content}</pre>
                    </div>
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-md mb-4">
                        <h4 class="text-blue-800 dark:text-blue-200 font-medium mb-2">🔧 Next Steps:</h4>
                        <ol class="text-blue-700 dark:text-blue-300 text-sm list-decimal list-inside space-y-1">
                            <li>Copy the EXACT field names (including spaces and capitalization)</li>
                            <li>Note which fields are "title", "rich_text", "select", etc.</li>
                            <li>Use "Simple Test Save" to test one field at a time</li>
                            <li>Check if "Item Type" and "Description" fields exist</li>
                        </ol>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button id="copy-structure-btn" class="px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded">📋 Copy Structure</button>
                        <button id="simple-test-btn" class="px-4 py-2 bg-green-500 text-white hover:bg-green-600 rounded">🧪 Simple Test Save</button>
                        <button class="px-4 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded" onclick="this.closest('.fixed').remove()">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Add copy functionality
            modal.querySelector('#copy-structure-btn').addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(content);
                    const btn = modal.querySelector('#copy-structure-btn');
                    const original = btn.textContent;
                    btn.textContent = '✅ Copied!';
                    setTimeout(() => btn.textContent = original, 2000);
                } catch (error) {
                    showAlert('Copy failed. Please copy manually from the text box.');
                }
            });

            // Add simple test functionality
            modal.querySelector('#simple-test-btn').addEventListener('click', () => {
                modal.remove();
                performSimpleTestSave();
            });
        }

        async function performSimpleTestSave() {
            const databaseId = '232a1f71-892c-808a-9013-cb1f0901e834';
            const apiToken = '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';

            window.Poe.registerHandler("simple-test-saver", (result) => {
                const msg = result.responses[0];
                console.log('Simple Test Response:', msg);
                
                if (msg.status === "complete") {
                    if (msg.content.includes('error') || msg.content.includes('failed')) {
                        showAlert(`❌ Test Failed: ${msg.content.substring(0, 500)}...`);
                    } else {
                        showAlert(`✅ Test Success: ${msg.content.substring(0, 500)}...`);
                    }
                } else if (msg.status === "error") {
                    showAlert(`❌ Test Error: ${msg.statusText || 'Unknown error'}`);
                }
            });

            // Try the most basic possible save with common field names
            const simpleTestPrompt = `@Claude-Sonnet-4 Make a simple test POST request to add a basic item to my Notion database.

DATABASE ID: ${databaseId}
API TOKEN: ${apiToken}

Execute this curl command with MINIMAL data to test:

curl -X POST "https://api.notion.com/v1/pages" \\
  -H "Authorization: Bearer ${apiToken}" \\
  -H "Content-Type: application/json" \\
  -H "Notion-Version: 2022-06-28" \\
  -d '{
    "parent": { "database_id": "${databaseId}" },
    "properties": {
      "Item": {
        "title": [{ "text": { "content": "TEST ITEM - Simple Save" } }]
      },
      "Brand": {
        "rich_text": [{ "text": { "content": "Test Brand" } }]
      },
      "Size": {
        "rich_text": [{ "text": { "content": "Test Size" } }]
      }
    }
  }'

This minimal test will show:
1. ✅ If the basic connection and authentication works
2. 🔧 Which field names are correct vs incorrect
3. ⚠️ Any field type mismatches
4. 📝 The exact error messages if it fails

Show me the complete response so I can see what works and what doesn't.`;

            try {
                await window.Poe.sendUserMessage(simpleTestPrompt, {
                    handler: "simple-test-saver",
                    stream: false,
                    openChat: false
                });
            } catch (error) {
                showAlert('Failed to perform simple test save.');
            }
        }

        async function saveToNotion() {
            // Simple approach - just get what we need and send it
            const generatedTitle = document.getElementById('generated-title').textContent;
            const descriptionElement = document.getElementById('generated-description');
            
            if (!generatedTitle || !descriptionElement || !currentDescription) {
                showAlert('Please generate the listing first, then try saving to Notion.');
                return;
            }

            // Use the generated description directly
            const actualDescription = currentDescription.trim();
            const actualTitle = generatedTitle.trim();

            // Get basic form data
            const formData = collectAllFormData();
            
            // CRITICAL: Escape the description for JSON - this was missing!
            const escapedTitle = actualTitle.replace(/"/g, '\\"').replace(/\n/g, ' ').replace(/\r/g, '');
            const escapedDescription = actualDescription.replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '');
            const escapedBrand = (formData.brand || 'Unbranded').replace(/"/g, '\\"').replace(/\n/g, ' ');
            const escapedSize = (formData.size || 'One size').replace(/"/g, '\\"').replace(/\n/g, ' ');
            const itemTypeFromDOM = document.getElementById('item-type').value;
            const escapedItemType = itemTypeFromDOM.replace(/"/g, '\\"').replace(/\n/g, ' ');

            const saveBtn = document.getElementById('save-notion-btn');
            const saveText = document.getElementById('save-notion-text');
            const saveLoading = document.getElementById('save-notion-loading');
            
            saveBtn.disabled = true;
            saveText.classList.add('hidden');
            saveLoading.classList.remove('hidden');

            try {
                const formData = collectAllFormData();

                window.Poe.registerHandler("notion-saver-fixed", (result) => {
                    const msg = result.responses[0];
                    console.log('Notion Response:', msg.content);
                    
                    if (msg.status === "complete") {
                        if (msg.content.includes('error') || msg.content.includes('failed') || msg.content.includes('400') || msg.content.includes('invalid')) {
                            showAlert('❌ Save failed: ' + msg.content.substring(0, 300));
                        } else {
                            showSuccessAlert('✅ Successfully saved to Notion database!');
                        }
                    } else if (msg.status === "error") {
                        showAlert(`❌ Error: ${msg.statusText || 'API error'}`);
                    }
                    resetNotionButton();
                });

                // Clean description - keep most formatting but remove problematic characters
                let cleanDescription = actualDescription
                    .replace(/```[\s\S]*?```/g, '') // Remove code blocks
                    .replace(/\*\*/g, '') // Remove bold markdown
                    .replace(/#{1,6}\s/g, '') // Remove headers
                    .trim();
                
                // Limit length for Notion
                if (cleanDescription.length > 1900) {
                    cleanDescription = cleanDescription.substring(0, 1900) + '...';
                }

                // Escape for JSON - be extra careful with quotes and newlines
                const escapedTitle = generatedTitle.replace(/"/g, '\\"').replace(/\n/g, ' ').replace(/\r/g, '');
                const escapedDescription = cleanDescription.replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '');
                const escapedBrand = (formData.brand || 'Unbranded').replace(/"/g, '\\"').replace(/\n/g, ' ');
                const escapedSize = (formData.size || 'One size').replace(/"/g, '\\"').replace(/\n/g, ' ');
                const escapedItemType = itemTypeFromDOM.replace(/"/g, '\\"').replace(/\n/g, ' ');

                console.log('🎯 FINAL DATA TO SEND:', {
                    title: escapedTitle,
                    itemType: escapedItemType,
                    brand: escapedBrand,
                    size: escapedSize,
                    descriptionLength: escapedDescription.length,
                    descriptionPreview: escapedDescription.substring(0, 300) + '...'
                });

                // CRITICAL: Ensure actualDescription is NOT empty before sending
                if (!actualDescription || actualDescription.trim() === '') {
                    showAlert('❌ CRITICAL ERROR: Description is empty! Cannot save to Notion.\n\nGenerate the listing first, then try saving again.');
                    resetNotionButton();
                    return;
                }

                // CRITICAL: Ensure actualDescription is the full content, not truncated
                if (actualDescription.length < 50) {
                    showAlert(`⚠️ WARNING: Description seems too short (${actualDescription.length} chars).\n\nExpected: Full listing with Brand, Size, Material, etc.\nActual: "${actualDescription.substring(0, 100)}..."\n\nRegenerate the listing and try again.`);
                    resetNotionButton();
                    return;
                }

                console.log('🚀 SENDING TO NOTION:', {
                    descriptionLength: escapedDescription.length,
                    descriptionPreview: escapedDescription.substring(0, 200) + '...',
                    itemType: escapedItemType,
                    title: escapedTitle.substring(0, 50) + '...'
                });

                // PAYLOAD 1: Using EXACT database schema field types
                const payload1 = `{
  "parent": { "database_id": "232a1f71-892c-808a-9013-cb1f0901e834" },
  "properties": {
    "Item": { "title": [{ "text": { "content": "${escapedTitle}" } }] },
    "Item type": { "select": { "name": "${escapedItemType}" } },
    "Brand": { "rich_text": [{ "text": { "content": "${escapedBrand}" } }] },
    "Size": { "multi_select": [{ "name": "${escapedSize}" }] },
    "Material": { "multi_select": [{ "name": "${formData.material1}" }${formData.material2 ? ', { "name": "' + formData.material2 + '" }' : ''}] },
    "Colour": { "multi_select": [${formData.color.split(', ').map(color => `{ "name": "${color.trim()}" }`).join(', ')}] },
    "Condition": { "select": { "name": "${getConditionMapping(formData.condition)}" } },
    "Description": { "rich_text": [{ "text": { "content": "${escapedDescription}" } }] }
  }
}`;

                // PAYLOAD 2: Alternative field names in case database uses different naming
                const payload2 = `{
  "parent": { "database_id": "232a1f71-892c-808a-9013-cb1f0901e834" },
  "properties": {
    "Item": { "title": [{ "text": { "content": "${escapedTitle}" } }] },
    "Type": { "select": { "name": "${escapedItemType}" } },
    "Description": { "rich_text": [{ "text": { "content": "${escapedDescription}" } }] },
    "Brand": { "rich_text": [{ "text": { "content": "${escapedBrand}" } }] }
  }
}`;

                // PAYLOAD 3: Minimal payload to test basic connectivity
                const payload3 = `{
  "parent": { "database_id": "232a1f71-892c-808a-9013-cb1f0901e834" },
  "properties": {
    "Item": { "title": [{ "text": { "content": "${escapedTitle}" } }] },
    "Description": { "rich_text": [{ "text": { "content": "${escapedDescription}" } }] }
  }
}`;

                console.log('🚀 PAYLOAD 1 (Item Type as select):', payload1);

                const notionPrompt = `@Claude-Sonnet-4 Execute these Notion API requests in order until one succeeds. The Item Type should go in the "Item Type" field and the Description MUST be included:

ATTEMPT 1 (Item Type as select field):
curl -X POST "https://api.notion.com/v1/pages" \\
  -H "Authorization: Bearer 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" \\
  -H "Content-Type: application/json" \\
  -H "Notion-Version: 2022-06-28" \\
  -d '${payload1}'

ATTEMPT 2 (Item Type as rich text):
curl -X POST "https://api.notion.com/v1/pages" \\
  -H "Authorization: Bearer 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" \\
  -H "Content-Type: application/json" \\
  -H "Notion-Version: 2022-06-28" \\
  -d '${payload2}'

ATTEMPT 3 (Alternative field names):
curl -X POST "https://api.notion.com/v1/pages" \\
  -H "Authorization: Bearer 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" \\
  -H "Content-Type: application/json" \\
  -H "Notion-Version: 2022-06-28" \\
  -d '${payload3}'

CRITICAL: Verify the Description field contains the full listing content (${escapedDescription.length} characters).

Return exactly which attempt worked and confirm the description was saved.`;

                await window.Poe.sendUserMessage(notionPrompt, {
                    handler: "notion-saver-fixed",
                    stream: false,
                    openChat: false
                });

            } catch (error) {
                console.error('Save error:', error);
                showAlert('❌ Failed to save to Notion: ' + error.message);
                resetNotionButton();
            }
        }

        // Smart capitalization function for all text inputs
        function smartCapitalize(text) {
            if (!text || text.trim() === '') return '';
            // Trim the text first, then capitalize
            const trimmed = text.trim();
            return trimmed.charAt(0).toUpperCase() + trimmed.slice(1);
        }

        // Apply smart capitalization to all text inputs on blur
        function setupSmartCapitalization() {
            const textInputs = [
                'brand', 'size', 'measurements', 'flaws', 'custom-features', 'fit-notes'
            ];
            
            textInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('blur', function() {
                        if (this.value.trim()) {
                            this.value = smartCapitalize(this.value);
                        }
                    });
                }
            });
        }

        function collectAllFormData() {
            // Get all selected features
            const selectedFeatures = [];
            const checkboxes = document.querySelectorAll('#features-grid input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedFeatures.push(checkbox.value);
            });

            // Get season
            const selectedSeason = document.querySelector('input[name="season"]:checked');
            const season = selectedSeason ? selectedSeason.value : '';

            // ROBUST data collection with null safety
            const data = {
                itemType: document.getElementById('item-type')?.value?.trim() || '',
                brand: smartCapitalize(document.getElementById('brand')?.value || ''),
                size: smartCapitalize(document.getElementById('size')?.value || ''),
                era: document.getElementById('era')?.value?.trim() || '',
                material1: document.getElementById('material1')?.value?.trim() || '',
                material2: document.getElementById('material2')?.value?.trim() || '',
                condition: document.getElementById('condition')?.value?.trim() || '',
                fit: document.getElementById('fit')?.value?.trim() || '',
                length: document.getElementById('length')?.value?.trim() || '',
                color: getSelectedColors() || '',
                pattern: document.getElementById('pattern')?.value?.trim() || '',
                measurements: smartCapitalize(document.getElementById('measurements')?.value || ''),
                flaws: smartCapitalize(document.getElementById('flaws')?.value || ''),
                customFeatures: smartCapitalize(document.getElementById('custom-features')?.value || ''),
                styleAesthetic: smartCapitalize(document.getElementById('style-aesthetic')?.value || ''),
                fitNotes: smartCapitalize(document.getElementById('fit-notes')?.value || ''),
                features: selectedFeatures.join(', '),
                season: season
            };
            
            // Log the data for debugging
            console.log('🔍 COLLECTED FORM DATA:', data);
            
            return data;
        }

        function resetNotionButton() {
            const saveBtn = document.getElementById('save-notion-btn');
            const saveText = document.getElementById('save-notion-text');
            const saveLoading = document.getElementById('save-notion-loading');
            
            saveBtn.disabled = false;
            saveText.classList.remove('hidden');
            saveLoading.classList.add('hidden');
        }

        function showSuccessAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <div class="text-center">
                        <div class="text-4xl mb-4">✅</div>
                        <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                        <button class="px-6 py-2 bg-green-500 text-white hover:bg-green-600 rounded" onclick="this.closest('.fixed').remove()">Awesome!</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-primary-hover rounded" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ============ DEBUG DATA FUNCTION ============

        async function debugDataBeingSent() {
            // Validate that we have title and description generated
            const generatedTitle = document.getElementById('generated-title').textContent;
            const descriptionSectionVisible = !document.getElementById('description-section').classList.contains('hidden');
            
            if (!currentDescription || !generatedTitle || !descriptionSectionVisible) {
                showAlert('Please generate the listing first before debugging data.');
                return;
            }

            // Collect all form data exactly like saveToNotion does
            const formData = collectAllFormData();
            
            // Collect selected features
            const selectedFeatures = [];
            const checkboxes = document.querySelectorAll('#features-grid input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedFeatures.push(checkbox.value);
            });

            // Get season
            const selectedSeason = document.querySelector('input[name="season"]:checked');
            const season = selectedSeason ? selectedSeason.value : '';

            // Map item type to category (same logic as saveToNotion)
            const itemTypeMapping = {
                'dress': 'Dresses', 'midi dress': 'Dresses', 'maxi dress': 'Dresses',
                'skirt': 'Skirts', 'midi skirt': 'Skirts', 'mini skirt': 'Skirts',
                'jeans': 'Jeans', 'vintage jeans': 'Jeans', 'mom jeans': 'Jeans',
                'trousers': 'Trousers', 'pants': 'Trousers',
                'shorts': 'Shorts', 'denim shorts': 'Shorts',
                'blazer': 'Blazers', 'vintage blazer': 'Blazers',
                'shirt': 'Shirts and Blouses', 'blouse': 'Shirts and Blouses',
                'top': 'Tops', 'tank top': 'Tops', 'crop top': 'Tops',
                'sweater': 'Knitwear', 'cardigan': 'Knitwear',
                'jacket': 'Coats and Jackets', 'coat': 'Coats and Jackets',
                'heels': 'Shoes', 'boots': 'Shoes', 'sneakers': 'Shoes'
            };

            const conditionMapping = {
                'BNWT': 'Brand new with tags', 'NWOT': 'New without tags', 
                'Very good': 'Very good', 'Good': 'Good', 'Satisfactory': 'Satisfactory'
            };

            const mappedCategory = itemTypeMapping[formData.itemType.toLowerCase()] || 'Tops';
            const mappedCondition = conditionMapping[formData.condition] || 'Good';

            // Build the exact same JSON object as saveToNotion
            const debugData = {
                "Generated Title": generatedTitle,
                "Form Data Collected": {
                    "Item Type": formData.itemType,
                    "Brand": formData.brand || 'Unbranded',
                    "Size": formData.size,
                    "Era": formData.era,
                    "Material 1": formData.material1,
                    "Material 2": formData.material2,
                    "Condition": formData.condition,
                    "Fit": formData.fit,
                    "Length": formData.length,
                    "Color": formData.color,
                    "Pattern": formData.pattern,
                    "Measurements": formData.measurements,
                    "Flaws": formData.flaws,
                    "Custom Features": formData.customFeatures,
                    "Style Aesthetic": formData.styleAesthetic,
                    "Fit Notes": formData.fitNotes,
                    "Selected Features": selectedFeatures,
                    "Season": season
                },
                "Mapped Values": {
                    "Mapped Category": mappedCategory,
                    "Mapped Condition": mappedCondition
                },
                "Description Length": currentDescription.length,
                "Cleaned Description Sample": cleanDescriptionForNotion(currentDescription).substring(0, 200) + "..."
            };

            // Show debug data in a modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">🐛 Debug: Data Being Sent to Notion</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">This shows exactly what data would be sent to your Notion database:</p>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-4 overflow-x-auto">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${JSON.stringify(debugData, null, 2)}</pre>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-md mb-4">
                        <h4 class="text-yellow-800 dark:text-yellow-200 font-medium mb-2">🔍 What to check:</h4>
                        <ul class="text-yellow-700 dark:text-yellow-300 text-sm list-disc list-inside space-y-1">
                            <li>Are the "Item Type" and "Description" fields showing data?</li>
                            <li>Do the mapped values make sense for your database?</li>
                            <li>Check if field names match your Notion database exactly</li>
                            <li>Description should be under 2000 characters</li>
                        </ul>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button id="copy-debug-btn" class="px-4 py-2 bg-orange-500 text-white hover:bg-orange-600 rounded">📋 Copy Debug Data</button>
                        <button class="px-4 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded" onclick="this.closest('.fixed').remove()">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Add copy functionality
            modal.querySelector('#copy-debug-btn').addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(JSON.stringify(debugData, null, 2));
                    const btn = modal.querySelector('#copy-debug-btn');
                    const original = btn.textContent;
                    btn.textContent = '✅ Copied!';
                    setTimeout(() => btn.textContent = original, 2000);
                } catch (error) {
                    showAlert('Copy failed. Please copy manually from the text box.');
                }
            });
        }

        // ============ BACKUP METHODS FOR NOTION ============

        async function generateCurlCommand() {
            // Validate that we have title and description generated
            const generatedTitle = document.getElementById('generated-title').textContent;
            const descriptionSectionVisible = !document.getElementById('description-section').classList.contains('hidden');
            
            if (!currentDescription || !generatedTitle || !descriptionSectionVisible) {
                showAlert('Please generate the listing first before creating the curl command.');
                return;
            }

            // CRITICAL: Ensure we have the actual description content
            let actualDescription = '';
            
            // Method 1: Use global variable (preferred)
            if (currentDescription && currentDescription.trim()) {
                actualDescription = currentDescription.trim();
                console.log('✅ Using global currentDescription for curl command');
                console.log('🔍 GLOBAL DESCRIPTION DETAILS:', {
                    'Type': typeof currentDescription,
                    'Length': currentDescription.length,
                    'First 200 chars': currentDescription.substring(0, 200),
                    'Contains Brand': currentDescription.includes('Brand:'),
                    'Contains hashtags': currentDescription.includes('#')
                });
            }
            // Method 2: DOM extraction fallback
            else {
                const descriptionElement = document.getElementById('generated-description');
                if (descriptionElement) {
                    actualDescription = descriptionElement.textContent || descriptionElement.innerText || '';
                    actualDescription = actualDescription.trim();
                    console.log('⚠️ Using DOM extraction for curl command');
                    console.log('🔍 DOM DESCRIPTION DETAILS:', {
                        'Element exists': !!descriptionElement,
                        'textContent length': (descriptionElement.textContent || '').length,
                        'innerText length': (descriptionElement.innerText || '').length,
                        'Final length': actualDescription.length,
                        'First 200 chars': actualDescription.substring(0, 200)
                    });
                }
            }
            // Method 3: Reconstruct as last resort
            if (!actualDescription) {
                actualDescription = reconstructDescriptionFromForm();
                console.log('🔧 Using reconstructed description for curl command');
                console.log('🔍 RECONSTRUCTED DESCRIPTION:', {
                    'Length': actualDescription.length,
                    'First 200 chars': actualDescription.substring(0, 200)
                });
            }

            // Final validation - NEVER send empty description
            if (!actualDescription || actualDescription.length < 20) {
                console.log('❌ VALIDATION FAILED:', {
                    'actualDescription exists': !!actualDescription,
                    'actualDescription length': actualDescription ? actualDescription.length : 0,
                    'actualDescription preview': actualDescription ? actualDescription.substring(0, 100) : 'NULL/UNDEFINED'
                });
                showAlert(`❌ ERROR: Description is empty or too short (${actualDescription ? actualDescription.length : 0} chars)!\n\nGenerate the listing first, then try creating the curl command.`);
                return;
            }

            console.log('✅ DESCRIPTION VALIDATION PASSED:', {
                'Length': actualDescription.length,
                'Preview': actualDescription.substring(0, 200) + '...',
                'Contains brand info': actualDescription.includes('Brand:'),
                'Contains hashtags': actualDescription.includes('#')
            });

            // Collect all form data
            const formData = collectAllFormData();
            
            // CRITICAL: ULTRA-SAFE DESCRIPTION PROCESSING
            console.log('🔍 STARTING DESCRIPTION PROCESSING:', {
                'Type': typeof actualDescription,
                'Length': actualDescription.length,
                'First 200 chars': actualDescription.substring(0, 200),
                'Contains Brand:': actualDescription.includes('Brand:'),
                'Contains hashtags': actualDescription.includes('#'),
                'Contains code blocks': actualDescription.includes('```'),
                'Contains newlines': actualDescription.includes('\n')
            });

            // THOROUGH CODE BLOCK CLEANING - Remove all markdown formatting
            let cleanedDescription = actualDescription;
            
            try {
                // 1. Remove code block markers at start/end (the main issue!)
                if (cleanedDescription.startsWith('```')) {
                    cleanedDescription = cleanedDescription.replace(/^```\n?/, '');
                    console.log('🧹 Removed opening code block marker');
                }
                if (cleanedDescription.endsWith('```') || cleanedDescription.endsWith('\n```')) {
                    cleanedDescription = cleanedDescription.replace(/\n?```$/, '');
                    console.log('🧹 Removed closing code block marker');
                }
                
                // 2. Remove any remaining code blocks with content
                if (cleanedDescription.includes('```')) {
                    const beforeLength = cleanedDescription.length;
                    cleanedDescription = cleanedDescription.replace(/```[\s\S]*?```/g, '');
                    console.log(`🧹 Removed internal code blocks: ${beforeLength} → ${cleanedDescription.length}`);
                }
                
                // 3. Remove standalone code block markers
                cleanedDescription = cleanedDescription.replace(/```/g, '');
                
                // 4. Remove ONLY bold markdown (**text**) - but preserve single asterisks
                if (cleanedDescription.includes('**')) {
                    const beforeLength = cleanedDescription.length;
                    cleanedDescription = cleanedDescription.replace(/\*\*([^*]+)\*\*/g, '$1'); // Replace **text** with text
                    console.log(`🧹 Removed bold markdown: ${beforeLength} → ${cleanedDescription.length}`);
                }
                
                // 5. SKIP header removal entirely - too risky for hashtags
                console.log('⏭️ SKIPPING header removal to preserve hashtags');
                
                // 6. Clean up excess whitespace but preserve structure
                cleanedDescription = cleanedDescription
                    .replace(/\n{3,}/g, '\n\n') // Max 2 consecutive newlines
                    .trim();
                
                console.log('✅ THOROUGH CLEANING COMPLETE:', {
                    'Length': cleanedDescription.length,
                    'First 200 chars': cleanedDescription.substring(0, 200),
                    'Still contains Brand:': cleanedDescription.includes('Brand:'),
                    'Still contains hashtags': cleanedDescription.includes('#'),
                    'Code blocks removed': !cleanedDescription.includes('```')
                });
                
            } catch (cleaningError) {
                console.error('❌ Cleaning error, reverting to original:', cleaningError);
                cleanedDescription = actualDescription;
            }
            
            // CRITICAL: Validate we still have content
            if (!cleanedDescription || cleanedDescription.length < 10) {
                console.log('🚨 CLEANING FAILED - REVERTING TO ORIGINAL');
                console.log('Failed content:', cleanedDescription);
                cleanedDescription = actualDescription;
            }
            
            // Length limiting for Notion (max ~2000 chars)
            if (cleanedDescription.length > 1900) {
                cleanedDescription = cleanedDescription.substring(0, 1900) + '...';
                console.log('✂️ Truncated to 1900 chars for Notion limits');
            }
            
            // NOTION-SAFE escaping (preserve actual newlines for rich text)
            function escapeForJSON(str) {
                if (!str || typeof str !== 'string') {
                    console.error('❌ Invalid input to escapeForJSON:', typeof str, str);
                    return actualDescription || ''; // Fallback to original
                }
                
                try {
                    return str
                        .replace(/\\/g, '\\\\')  // Escape backslashes first
                        .replace(/"/g, '\\"')    // Escape quotes  
                        // DON'T escape newlines - Notion rich text handles them properly
                        .replace(/\r/g, '');     // Remove carriage returns but keep newlines
                } catch (escapeError) {
                    console.error('❌ JSON escaping failed:', escapeError);
                    return str; // Return unescaped rather than nothing
                }
            }

            const escapedDescription = escapeForJSON(cleanedDescription);
            
            console.log('🔐 FINAL PROCESSING RESULT:', {
                'Original length': actualDescription.length,
                'Cleaned length': cleanedDescription.length,
                'Escaped length': escapedDescription.length,
                'Content preserved': escapedDescription.includes('Brand:'),
                'Hashtags preserved': escapedDescription.includes('#'),
                'First 200 chars': escapedDescription.substring(0, 200)
            });
            const escapedTitle = escapeForJSON(generatedTitle);
            const escapedBrand = escapeForJSON(formData.brand || 'Unbranded');
            const escapedSize = escapeForJSON(formData.size || 'One size');
            
            console.log('🎯 ESCAPED DESCRIPTION LENGTH:', escapedDescription.length);

            // Map item type to category
            const itemTypeMapping = {
                'dress': 'Dresses', 'midi dress': 'Dresses', 'maxi dress': 'Dresses',
                'skirt': 'Skirts', 'midi skirt': 'Skirts', 'mini skirt': 'Skirts',
                'jeans': 'Jeans', 'vintage jeans': 'Jeans', 'mom jeans': 'Jeans',
                'trousers': 'Trousers', 'pants': 'Trousers',
                'shorts': 'Shorts', 'denim shorts': 'Shorts',
                'blazer': 'Blazers', 'vintage blazer': 'Blazers',
                'shirt': 'Shirts and Blouses', 'blouse': 'Shirts and Blouses',
                'top': 'Tops', 'tank top': 'Tops', 'crop top': 'Tops',
                'sweater': 'Knitwear', 'cardigan': 'Knitwear',
                'jacket': 'Coats and Jackets', 'coat': 'Coats and Jackets',
                'heels': 'Shoes', 'boots': 'Shoes', 'sneakers': 'Shoes'
            };

            const conditionMapping = {
                'BNWT': 'Brand new with tags', 'NWOT': 'New without tags', 
                'Very good': 'Very good', 'Good': 'Good', 'Satisfactory': 'Satisfactory'
            };

            const mappedCategory = itemTypeMapping[formData.itemType.toLowerCase()] || 'Tops';
            const mappedCondition = conditionMapping[formData.condition] || 'Good';

            // Collect selected features
            const selectedFeatures = [];
            const checkboxes = document.querySelectorAll('#features-grid input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedFeatures.push(checkbox.value);
            });

            // Get season
            const selectedSeason = document.querySelector('input[name="season"]:checked');
            const season = selectedSeason ? selectedSeason.value : '';

            // CRITICAL: Use EXACT database schema - Size as multi_select, not rich_text
            const propertiesObj = {
                "Item": {
                    "title": [{ "text": { "content": escapedTitle } }]
                },
                "Item type": {
                    "select": { "name": formData.itemType }
                },
                "Brand": {
                    "rich_text": [{ "text": { "content": escapedBrand } }]
                },
                "Size": {
                    "multi_select": [{ "name": escapedSize }]
                },
                "Material": {
                    "multi_select": formData.material2 ? 
                        [{ "name": formData.material1 }, { "name": formData.material2 }] : 
                        [{ "name": formData.material1 }]
                },
                "Colour": {
                    "multi_select": formData.color.split(', ').map(color => ({ "name": color.trim() }))
                },
                "Condition": {
                    "select": { "name": getConditionMapping(formData.condition) }
                },
                "Description": {
                    "rich_text": [{ "text": { "content": escapedDescription } }]
                }
            };

            // Add optional fields ONLY if they have actual values
            if (formData.era && formData.era.trim()) {
                propertiesObj["Era"] = { "select": { "name": formData.era } };
            }

            if (formData.fit && formData.fit.trim()) {
                propertiesObj["Fit"] = { "select": { "name": formData.fit } };
            }

            if (formData.length && formData.length.trim()) {
                propertiesObj["Length"] = { "select": { "name": formData.length } };
            }

            if (formData.pattern && formData.pattern.trim()) {
                propertiesObj["Pattern/print"] = { "select": { "name": formData.pattern } };
            }

            if (season && season.trim()) {
                propertiesObj["Season"] = { "select": { "name": season } };
            }

            if (formData.measurements && formData.measurements.trim()) {
                propertiesObj["Measurements"] = { "rich_text": [{ "text": { "content": formData.measurements } }] };
            }

            if (selectedFeatures.length > 0) {
                propertiesObj["Features"] = { "multi_select": selectedFeatures.map(feature => ({ "name": feature })) };
            }

            if (formData.customFeatures && formData.customFeatures.trim()) {
                propertiesObj["Other features"] = { "rich_text": [{ "text": { "content": formData.customFeatures } }] };
            }



            if (formData.fitNotes && formData.fitNotes.trim()) {
                propertiesObj["Fit and length notes"] = { "rich_text": [{ "text": { "content": formData.fitNotes } }] };
            }

            // CRITICAL: Verify the description is actually included
            console.log('🔍 CURL COMMAND DESCRIPTION CHECK:', {
                'Original description length': actualDescription.length,
                'Cleaned description length': cleanedDescription.length, 
                'Escaped description length': escapedDescription.length,
                'Description in properties object': !!propertiesObj.Description.rich_text[0].text.content,
                'Properties object description length': propertiesObj.Description.rich_text[0].text.content.length,
                'Description preview': propertiesObj.Description.rich_text[0].text.content.substring(0, 100) + '...'
            });

            // CRITICAL: Verify the description is actually included
            console.log('🔍 CURL COMMAND DESCRIPTION CHECK:', {
                'Original description length': actualDescription.length,
                'Cleaned description length': cleanedDescription.length, 
                'Escaped description length': escapedDescription.length,
                'Description in properties object': !!propertiesObj.Description.rich_text[0].text.content,
                'Properties object description length': propertiesObj.Description.rich_text[0].text.content.length,
                'Description preview': propertiesObj.Description.rich_text[0].text.content.substring(0, 100) + '...'
            });

            // Create properly formatted curl command
            const curlCommand = `curl -X POST "https://api.notion.com/v1/pages" \\
  -H "Authorization: Bearer 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" \\
  -H "Content-Type: application/json" \\
  -H "Notion-Version: 2022-06-28" \\
  -d '${JSON.stringify({
    "parent": { "database_id": "232a1f71-892c-808a-9013-cb1f0901e834" },
    "properties": propertiesObj
  }, null, 2).replace(/'/g, "\\'")}'`;
            
            // CRITICAL: Log the final curl command to verify description is included
            console.log('🚀 FINAL CURL COMMAND VERIFICATION:');
            console.log('Command length:', curlCommand.length);
            console.log('Contains Description field:', curlCommand.includes('"Description"'));
            console.log('Description content in command:', curlCommand.includes('Brand:') || curlCommand.includes('#'));
            if (curlCommand.includes('"Description"')) {
                const descMatch = curlCommand.match(/"Description":\s*{\s*"rich_text":\s*\[\s*{\s*"text":\s*{\s*"content":\s*"([^"]*)/);
                if (descMatch) {
                    console.log('Description preview in curl:', descMatch[1].substring(0, 100) + '...');
                }
            }
            
            // CRITICAL: Log the final curl command to verify description is included
            console.log('🚀 FINAL CURL COMMAND VERIFICATION:');
            console.log('Command length:', curlCommand.length);
            console.log('Contains Description field:', curlCommand.includes('"Description"'));
            console.log('Description content in command:', curlCommand.includes('Brand:') || curlCommand.includes('#'));
            if (curlCommand.includes('"Description"')) {
                const descMatch = curlCommand.match(/"Description":\s*{\s*"rich_text":\s*\[\s*{\s*"text":\s*{\s*"content":\s*"([^"]*)/);
                if (descMatch) {
                    console.log('Description preview in curl:', descMatch[1].substring(0, 100) + '...');
                }
            }

            // Show the curl command in a modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">📋 Manual Curl Command</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Copy this command and run it in your Terminal to add the item to Notion:</p>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-4 overflow-x-auto">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap break-all">${curlCommand}</pre>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button id="copy-curl-btn" class="px-4 py-2 bg-green-500 text-white hover:bg-green-600 rounded">📋 Copy Command</button>
                        <button class="px-4 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded" onclick="this.closest('.fixed').remove()">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Add copy functionality
            modal.querySelector('#copy-curl-btn').addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(curlCommand);
                    const btn = modal.querySelector('#copy-curl-btn');
                    const original = btn.textContent;
                    btn.textContent = '✅ Copied!';
                    setTimeout(() => btn.textContent = original, 2000);
                } catch (error) {
                    showAlert('Copy failed. Please copy manually from the text box.');
                }
            });
        }

        async function copyFormattedData() {
            // Validate that we have title and description generated
            const generatedTitle = document.getElementById('generated-title').textContent;
            const descriptionSectionVisible = !document.getElementById('description-section').classList.contains('hidden');
            
            if (!currentDescription || !generatedTitle || !descriptionSectionVisible) {
                showAlert('Please generate the listing first before copying data.');
                return;
            }

            // Collect all form data
            const formData = collectAllFormData();
            
            // Collect selected features
            const selectedFeatures = [];
            const checkboxes = document.querySelectorAll('#features-grid input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedFeatures.push(checkbox.value);
            });

            // Create formatted data for manual entry
            const formattedData = `ITEM DETAILS FOR NOTION DATABASE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 Item (Title): ${generatedTitle}

🏷️ Brand: ${formData.brand || 'Unbranded'}
📏 Size: ${formData.size}
📂 Category: ${getCategoryMapping(formData.itemType)}
🎨 Colour: ${formData.color}
🧵 Material: ${formData.material1}
⭐ Condition: ${getConditionMapping(formData.condition)}

📄 Description:
${currentDescription}

⚠️ Flaws: ${formData.flaws || 'None noted'}

${formData.measurements ? '📐 Measurements: ' + formData.measurements : ''}
${formData.fit ? '👔 Fit: ' + formData.fit : ''}
${formData.length ? '📏 Length: ' + formData.length : ''}
${selectedFeatures.length ? '✨ Features: ' + selectedFeatures.join(', ') : ''}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 Copy this data and manually enter it into your Notion database.
   Make sure to match the field names exactly as they appear above.`;

            // Show the formatted data in a modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">📄 Formatted Data for Manual Entry</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Copy this data and manually enter it into your Notion database:</p>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md mb-4 overflow-x-auto">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${formattedData}</pre>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button id="copy-data-btn-modal" class="px-4 py-2 bg-purple-500 text-white hover:bg-purple-600 rounded">📋 Copy Data</button>
                        <button class="px-4 py-2 bg-gray-500 text-white hover:bg-gray-600 rounded" onclick="this.closest('.fixed').remove()">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Add copy functionality
            modal.querySelector('#copy-data-btn-modal').addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(formattedData);
                    const btn = modal.querySelector('#copy-data-btn-modal');
                    const original = btn.textContent;
                    btn.textContent = '✅ Copied!';
                    setTimeout(() => btn.textContent = original, 2000);
                } catch (error) {
                    showAlert('Copy failed. Please copy manually from the text box.');
                }
            });
        }

        function getCategoryMapping(itemType) {
            const mapping = {
                'dress': 'Dresses', 'midi dress': 'Dresses', 'maxi dress': 'Dresses',
                'skirt': 'Skirts', 'midi skirt': 'Skirts', 'mini skirt': 'Skirts',
                'jeans': 'Jeans', 'vintage jeans': 'Jeans', 'mom jeans': 'Jeans',
                'trousers': 'Trousers', 'pants': 'Trousers',
                'shorts': 'Shorts', 'denim shorts': 'Shorts',
                'blazer': 'Blazers', 'vintage blazer': 'Blazers',
                'shirt': 'Shirts and Blouses', 'blouse': 'Shirts and Blouses',
                'top': 'Tops', 'tank top': 'Tops', 'crop top': 'Tops',
                'sweater': 'Knitwear', 'cardigan': 'Knitwear',
                'jacket': 'Coats and Jackets', 'coat': 'Coats and Jackets',
                'heels': 'Shoes', 'boots': 'Shoes', 'sneakers': 'Shoes'
            };
            return mapping[itemType.toLowerCase()] || 'Tops';
        }

        function getConditionMapping(condition) {
            const mapping = {
                'BNWT': 'Brand new with tags', 
                'NWOT': 'Brand new without tags',  // Match database option exactly
                'Very good': 'Very good', 
                'Good': 'Good', 
                'Satisfactory': 'Satisfactory'
            };
            return mapping[condition] || 'Good';
        }

        // ============ COLOR SELECTION LIMIT FUNCTIONALITY ============

        function setupColorSelectionLimit() {
            const colorCheckboxes = document.querySelectorAll('.color-checkbox');
            const maxColors = 2;

            colorCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const checkedColors = document.querySelectorAll('.color-checkbox:checked');
                    
                    if (checkedColors.length > maxColors) {
                        // Uncheck the current checkbox if limit exceeded
                        this.checked = false;
                        showAlert(`You can select up to ${maxColors} colors only.`);
                        return;
                    }

                    // Update validation for required colors
                    updateColorValidation();
                });
            });
        }

        function updateColorValidation() {
            const checkedColors = document.querySelectorAll('.color-checkbox:checked');
            const generateBtn = document.getElementById('generate-btn');
            
            // Update the form data collection to use selected colors
            if (checkedColors.length === 0) {
                // No colors selected - should show validation error
            } else {
                // At least one color selected - valid
            }
        }

        function getSelectedColors() {
            const checkedColors = document.querySelectorAll('.color-checkbox:checked');
            const colors = [];
            checkedColors.forEach(checkbox => {
                colors.push(checkbox.value);
            });
            return colors.join(', ');
        }

        // ============ VINTED-OPTIMIZED HASHTAG SYSTEM ============

        const VINTED_HASHTAG_DATABASE = {
            // ITEM TYPES - What buyers search for on Vinted (High Priority)
            itemTypes: {
                'dress': ['#Dress', '#VintageDress', '#MidiDress', '#PartyDress', '#SummerDress'],
                'midi dress': ['#MidiDress', '#Dress', '#VintageDress', '#WorkDress', '#ElegantDress'],
                'maxi dress': ['#MaxiDress', '#LongDress', '#VintageDress', '#SummerDress', '#FlowingDress'],
                'jeans': ['#Jeans', '#MomJeans', '#VintageJeans', '#HighWaisted', '#StraightLeg'],
                'vintage jeans': ['#VintageJeans', '#MomJeans', '#HighWaisted', '#RetroJeans', '#90sJeans'],
                'mom jeans': ['#MomJeans', '#HighWaisted', '#VintageJeans', '#90sStyle', '#RelaxedJeans'],
                'trousers': ['#Trousers', '#HighWaisted', '#WideLeg', '#WorkTrousers', '#SmartCasual'],
                'pants': ['#Pants', '#HighWaisted', '#WideLeg', '#CasualPants', '#VintagePants'],
                'blazer': ['#Blazer', '#VintageBlazer', '#WorkWear', '#TailoredBlazer', '#StructuredBlazer'],
                'vintage blazer': ['#VintageBlazer', '#Blazer', '#PowerSuit', '#RetroStyle', '#WorkWear'],
                'shirt': ['#Shirt', '#ButtonUp', '#VintageShirt', '#OversizedShirt', '#CasualShirt'],
                'blouse': ['#Blouse', '#VintageBlouse', '#SilkBlouse', '#WorkBlouse', '#ElegantTop'],
                'top': ['#Top', '#VintageTop', '#CasualTop', '#BasicTee', '#CropTop'],
                'tank top': ['#TankTop', '#Camisole', '#SummerTop', '#BasicTank', '#VintageTop'],
                'sweater': ['#Sweater', '#VintageSweater', '#KnitSweater', '#OversizedSweater', '#CozyKnit'],
                'cardigan': ['#Cardigan', '#VintageCardigan', '#KnitCardigan', '#LayeringPiece', '#CozyCardigan'],
                'jacket': ['#Jacket', '#VintageJacket', '#LeatherJacket', '#DenimJacket', '#BomberJacket'],
                'leather jacket': ['#LeatherJacket', '#MotorJacket', '#RockJacket', '#VintageLeather', '#BikerJacket'],
                'denim jacket': ['#DenimJacket', '#JeansJacket', '#VintageDenim', '#ClassicDenim', '#CasualJacket'],
                'skirt': ['#Skirt', '#MidiSkirt', '#MiniSkirt', '#VintageSkirt', '#ALineSkirt'],
                'midi skirt': ['#MidiSkirt', '#ALineSkirt', '#VintageSkirt', '#ElegantSkirt', '#WorkSkirt'],
                'mini skirt': ['#MiniSkirt', '#ShortSkirt', '#VintageSkirt', '#PartySkirt', '#ALineSkirt'],
                'coat': ['#Coat', '#VintageCoat', '#WoolCoat', '#TrenchCoat', '#WinterCoat']
            },

            // BRANDS - Brands Vinted users actively search for (High Priority)
            brands: {
                'zara': ['#Zara', '#ZaraWoman', '#ZaraBasics'],
                'h&m': ['#HM', '#HandM', '#HMConscious'],
                'cos': ['#COS', '#COSWoman', '#MinimalistBrand'],
                'arket': ['#Arket', '#SustainableBrand'],
                'uniqlo': ['#Uniqlo', '#UniqloU', '#JapaneseBrand'],
                'mango': ['#Mango', '#MangoWoman'],
                'massimo dutti': ['#MassimoDutti', '#LuxuryBasics'],
                '& other stories': ['#AndOtherStories', '#OtherStories'],
                'monki': ['#Monki', '#MonkiStyle'],
                'weekday': ['#Weekday', '#WeekdayBrand'],
                'vintage': ['#Vintage', '#VintageStyle', '#TrueVintage'],
                'polo ralph lauren': ['#PoloRalphLauren', '#RalphLauren', '#PrepStyle'],
                'tommy hilfiger': ['#TommyHilfiger', '#TommyClassic'],
                'calvin klein': ['#CalvinKlein', '#CKJeans'],
                'levi\'s': ['#Levis', '#LevisVintage', '#501s'],
                'nike': ['#Nike', '#NikeVintage'],
                'adidas': ['#Adidas', '#AdidasVintage'],
                'asos': ['#ASOS', '#ASOSDesign'],
                'topshop': ['#Topshop', '#TopshopVintage'],
                'urban outfitters': ['#UrbanOutfitters', '#UOExclusive'],
                'brandy melville': ['#BrandyMelville', '#OneSize']
            },

            // COLORS - Colors buyers filter by on Vinted (Medium Priority)
            colors: {
                'black': ['#Black', '#AllBlack'],
                'white': ['#White', '#OffWhite'],
                'blue': ['#Blue', '#Navy'],
                'navy': ['#Navy', '#DarkBlue'],
                'red': ['#Red', '#BurgundiRed'],
                'green': ['#Green', '#ForestGreen'],
                'brown': ['#Brown', '#Tan'],
                'beige': ['#Beige', '#Cream'],
                'grey': ['#Grey', '#Gray'],
                'pink': ['#Pink', '#Blush'],
                'purple': ['#Purple', '#Lavender'],
                'yellow': ['#Yellow', '#Mustard'],
                'orange': ['#Orange', '#Rust']
            },

            // MATERIALS - What Vinted buyers care about (Medium Priority)
            materials: {
                'cotton': ['#Cotton', '#100Cotton', '#OrganicCotton'],
                'silk': ['#Silk', '#RealSilk', '#SilkBlend'],
                'wool': ['#Wool', '#PureWool', '#MerinoWool'],
                'linen': ['#Linen', '#PureLinen'],
                'denim': ['#Denim', '#100Cotton'],
                'leather': ['#Leather', '#RealLeather', '#GenuineLeather'],
                'cashmere': ['#Cashmere', '#PureCashmere'],
                'polyester': ['#Polyester'],
                'viscose': ['#Viscose', '#Rayon']
            },

            // ERAS - Vintage decades buyers search for (High Priority for vintage)
            eras: {
                '90s': ['#90s', '#90sVintage', '#90sStyle'],
                '80s': ['#80s', '#80sVintage', '#PowerDressing'],
                '70s': ['#70s', '#70sVintage', '#BohoStyle'],
                '60s': ['#60s', '#60sVintage', '#ModStyle'],
                '2000s': ['#Y2K', '#2000s', '#Y2KStyle'],
                '2000s / y2k': ['#Y2K', '#2000sStyle', '#NoughtsStyle']
            },

            // AESTHETICS - Style trends on Vinted (High Priority)
            aesthetics: {
                'y2k': ['#Y2K', '#2000sStyle', '#Y2KFashion'],
                'dark academia': ['#DarkAcademia', '#Academia'],
                'cottagecore': ['#Cottagecore', '#CottageStyle'],
                'minimalist': ['#Minimalist', '#MinimalStyle'],
                'grunge': ['#Grunge', '#GrungeStyle', '#90sGrunge'],
                'preppy': ['#Preppy', '#PrepStyle'],
                'boho': ['#Boho', '#BohoStyle'],
                'vintage': ['#Vintage', '#VintageStyle'],
                'streetwear': ['#Streetwear', '#StreetStyle'],
                'old money': ['#OldMoney', '#QuietLuxury'],
                'scandi': ['#Scandinavian', '#Nordic'],
                'romantic': ['#Romantic', '#Feminine'],
                'coquette': ['#Coquette', '#Girly'],
                'clean girl': ['#CleanGirl', '#EffortlessStyle']
            },

            // OCCASIONS - How buyers plan to wear items (Medium Priority)
            occasions: {
                'work/office': ['#WorkWear', '#Professional'],
                'casual/everyday': ['#Casual', '#Everyday'],
                'evening/party': ['#PartyWear', '#GoingOut'],
                'weekend': ['#Weekend', '#Relaxed'],
                'university/school': ['#Student', '#Campus'],
                'date night': ['#DateNight', '#Evening']
            },

            // FITS - Popular fit searches on Vinted (Medium Priority)
            fits: {
                'oversized': ['#Oversized', '#BaggyFit'],
                'high waisted': ['#HighWaisted', '#HighWaist'],
                'cropped': ['#Cropped', '#CropTop'],
                'wide leg': ['#WideLeg', '#FlowingFit'],
                'straight leg': ['#StraightLeg', '#ClassicFit'],
                'slim fit': ['#SlimFit', '#Fitted'],
                'bodycon': ['#Bodycon', '#TightFit'],
                'a-line': ['#ALine', '#FlatteringFit'],
                'tailored': ['#Tailored', '#Structured']
            },

            // SEASONS - Seasonal searches (Low Priority)
            seasons: {
                'summer': ['#Summer', '#SummerWear'],
                'winter': ['#Winter', '#WinterWear']
            },

            // VINTED COMMUNITY TRENDS - Popular on the platform (Medium Priority)
            vintedTrends: [
                '#VintedFind', '#SecondHand', '#PreLoved', '#SustainableCloset', 
                '#SlowFashion', '#VintageFinds', '#ThriftFind', '#RareFind',
                '#OneOfAKind', '#QualityPiece', '#InvestmentPiece', '#TimelessStyle',
                '#UpcycledFashion', '#EcoFriendly', '#ConsciousFashion', '#StatementPiece'
            ]
        };

        function generateSmartHashtags(data) {
            const selectedTags = new Set();
            const maxHashtags = 10;
            
            // Priority scoring system
            const priorityWeights = {
                itemType: 3,    // Most important - what the item is
                brand: 2.5,     // Very important for brand searches
                era: 2.5,       // High for vintage items
                aesthetic: 2,   // Important for style tribes
                color: 1.5,     // Medium importance
                material: 1.5,  // Medium importance  
                fit: 1,         // Lower priority
                occasion: 1,    // Lower priority
                season: 0.5,    // Lowest priority
                trending: 1.5   // Medium importance for discoverability
            };

            // 1. Always include primary item type (highest priority)
            const itemTypeLower = data.itemType.toLowerCase();
            if (VINTED_HASHTAG_DATABASE.itemTypes[itemTypeLower]) {
                const itemTags = VINTED_HASHTAG_DATABASE.itemTypes[itemTypeLower].slice(0, 2);
                itemTags.forEach(tag => selectedTags.add(tag));
            }

            // 2. Add brand if available (high priority)
            if (data.brand) {
                const brandLower = data.brand.toLowerCase();
                if (VINTED_HASHTAG_DATABASE.brands[brandLower]) {
                    selectedTags.add(VINTED_HASHTAG_DATABASE.brands[brandLower][0]);
                }
            }

            // 3. Add era/decade (high priority for vintage)
            if (data.era && data.era !== 'Unspecified Vintage') {
                const eraLower = data.era.toLowerCase();
                if (VINTED_HASHTAG_DATABASE.eras[eraLower]) {
                    selectedTags.add(VINTED_HASHTAG_DATABASE.eras[eraLower][0]);
                }
            }

            // 4. Add aesthetic/style (high priority)
            if (data.styleAesthetic) {
                const aestheticLower = data.styleAesthetic.toLowerCase();
                if (VINTED_HASHTAG_DATABASE.aesthetics[aestheticLower]) {
                    selectedTags.add(VINTED_HASHTAG_DATABASE.aesthetics[aestheticLower][0]);
                }
            }

            // 5. Add color (medium priority)
            if (data.color) {
                const colorLower = data.color.toLowerCase();
                if (VINTED_HASHTAG_DATABASE.colors[colorLower]) {
                    selectedTags.add(VINTED_HASHTAG_DATABASE.colors[colorLower][0]);
                }
            }

            // 6. Add primary material (medium priority)
            if (data.material1) {
                const materialLower = data.material1.toLowerCase();
                if (VINTED_HASHTAG_DATABASE.materials[materialLower]) {
                    selectedTags.add(VINTED_HASHTAG_DATABASE.materials[materialLower][0]);
                }
            }

            // 7. Add fit style (lower priority)
            if (data.fit) {
                const fitLower = data.fit.toLowerCase();
                if (VINTED_HASHTAG_DATABASE.fits[fitLower]) {
                    selectedTags.add(VINTED_HASHTAG_DATABASE.fits[fitLower][0]);
                }
            }

            // 8. Add season if relevant (lower priority)
            if (data.season) {
                const seasonLower = data.season.toLowerCase();
                if (VINTED_HASHTAG_DATABASE.seasons[seasonLower]) {
                    selectedTags.add(VINTED_HASHTAG_DATABASE.seasons[seasonLower][0]);
                }
            }

            // 9. Fill remaining slots with Vinted community trends
            const remainingSlots = maxHashtags - selectedTags.size;
            if (remainingSlots > 0) {
                const trendingTags = VINTED_HASHTAG_DATABASE.vintedTrends.slice(0, remainingSlots);
                trendingTags.forEach(tag => selectedTags.add(tag));
            }

            // Convert to array and ensure exactly 10 hashtags
            const finalTags = Array.from(selectedTags).slice(0, maxHashtags);
            
            // Add fallback tags if we don't have enough
            while (finalTags.length < maxHashtags) {
                const fallbackTags = ['#VintageStyle', '#ThriftFind', '#SustainableFashion', '#ClassicStyle', '#TimelessPiece'];
                for (const tag of fallbackTags) {
                    if (!finalTags.includes(tag) && finalTags.length < maxHashtags) {
                        finalTags.push(tag);
                    }
                }
                break; // Prevent infinite loop
            }

            return finalTags.join(' ');
        }

        // ============ DESCRIPTION CLEANING FOR NOTION ============
        
        function reconstructDescriptionFromForm() {
            console.log('🔧 Attempting to reconstruct description from form data...');
            
            try {
                const formData = collectAllFormData();
                
                // Build a basic description using form data
                let reconstructed = `Brand: ${formData.brand || 'Unbranded'}
Size: ${formData.size || 'One size'}
Material: ${formData.material1}${formData.material2 ? `/${formData.material2}` : ''}
Colour: ${formData.color}`;

                if (formData.pattern) reconstructed += `\nPattern: ${formData.pattern}`;
                if (formData.era && formData.era !== 'Unspecified Vintage') reconstructed += `\nEra: ${formData.era}`;
                if (formData.fit) reconstructed += `\nFit: ${formData.fit}`;
                if (formData.length) reconstructed += `\nLength: ${formData.length}`;
                if (formData.features) reconstructed += `\nFeatures: ${formData.features}`;
                if (formData.season) reconstructed += `\nSeason: ${formData.season}`;
                if (formData.measurements) reconstructed += `\nMeasurements: ${formData.measurements}`;
                
                reconstructed += `\nCondition: ${formData.condition}`;
                
                if (formData.flaws) reconstructed += `\n\nPlease note: ${formData.flaws}`;
                
                const isAccessory = isAccessoryItem(formData.itemType);
                reconstructed += isAccessory ? 
                    '\n\nShips within 2 working days.' : 
                    '\n\nWashed and steamed, ships within 2 working days.';
                
                // Add basic hashtags
                const basicHashtags = generateSmartHashtags(formData);
                reconstructed += `\n\n${basicHashtags}`;
                
                console.log('✅ Successfully reconstructed description from form data');
                return reconstructed;
                
            } catch (error) {
                console.error('❌ Failed to reconstruct description:', error);
                return '';
            }
        }

        function cleanDescriptionForNotion(description) {
            if (!description) return '';
            
            // Keep the description mostly intact, only remove problematic elements
            let cleaned = description
                .replace(/```[\s\S]*?```/g, '') // Remove code blocks with content
                .replace(/```/g, '') // Remove standalone code block markers
                .replace(/\*\*/g, '') // Remove bold markdown
                .replace(/#{1,6}\s/g, '') // Remove heading markers
                .trim();
            
            // Keep newlines and basic formatting, just ensure it's not too long
            // Notion rich text field can handle up to 2000 characters
            if (cleaned.length > 1950) {
                cleaned = cleaned.substring(0, 1950) + '...';
            }
            
            return cleaned;
        }

        // ============ PATTERN OPTIONS UPDATE ============
        
        function updatePatternOptions() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const patternSelect = document.getElementById('pattern');
            
            // Clear current options
            patternSelect.innerHTML = '<option value="">Solid color / No pattern</option>';
            
            let patterns = [];
            
            if (itemType.includes('dress') || itemType.includes('skirt')) {
                patterns = [
                    // Floral varieties
                    'Floral', 'Ditsy floral', 'Large floral', 'Small floral', 'Vintage floral', 'Rose print', 'Cherry print', 'Sunflower print', 'Daisy print', 'Botanical print', 'Tropical floral', 'English garden', 'Liberty print',
                    // Dots & spots
                    'Polka dot', 'Large polka dot', 'Small polka dot', 'Micro dot', 'Scattered dots',
                    // Stripes & lines
                    'Striped', 'Vertical stripes', 'Horizontal stripes', 'Diagonal stripes', 'Pinstripe', 'Candy stripes', 'Multi-stripe', 'Breton stripes',
                    // Checks & plaids
                    'Checked', 'Gingham', 'Vichy', 'Buffalo check', 'Plaid', 'Tartan', 'Madras', 'Glen check', 'Windowpane check',
                    // Geometric & abstract
                    'Geometric', 'Abstract', 'Art deco', 'Memphis print', 'Chevron', 'Zigzag', 'Diamond print', 'Triangle print', 'Circle print', 'Square print',
                    // Animal & nature
                    'Animal print', 'Leopard print', 'Zebra print', 'Snake print', 'Tiger print', 'Cow print', 'Butterfly print', 'Bird print',
                    // Vintage & retro
                    'Paisley', 'Vintage print', 'Retro print', '70s print', '80s print', '90s print', 'Y2K print', 'Psychedelic', 'Op art',
                    // Textural & special
                    'Tie dye', 'Ombre', 'Gradient', 'Marble print', 'Watercolor', 'Brushstroke', 'Splatter print', 'Galaxy print', 'Holographic',
                    // Cultural & themed
                    'Ethnic print', 'Tribal print', 'Ikat', 'Batik', 'Mandala', 'Moroccan print', 'Indian print', 'African print',
                    // Novelty & fun
                    'Heart print', 'Star print', 'Moon print', 'Cloud print', 'Rainbow print', 'Food print', 'Fruit print', 'Ice cream print'
                ];
            } else if (itemType.includes('blouse') || itemType.includes('shirt') || itemType.includes('top')) {
                patterns = [
                    // Professional patterns
                    'Striped', 'Pinstripe', 'Checked', 'Gingham', 'Windowpane', 'Glen check', 'Houndstooth',
                    // Floral (more conservative)
                    'Floral', 'Small floral', 'Ditsy floral', 'Vintage floral', 'Liberty print', 'Botanical print',
                    // Dots
                    'Polka dot', 'Small polka dot', 'Micro dot',
                    // Geometric
                    'Geometric', 'Abstract', 'Art deco', 'Diamond print', 'Triangle print',
                    // Vintage & retro
                    'Paisley', 'Vintage print', 'Retro print', '70s print', '80s print', '90s print',
                    // Animal prints
                    'Animal print', 'Leopard print', 'Snake print', 'Zebra print',
                    // Textural
                    'Tie dye', 'Ombre', 'Gradient', 'Marble print', 'Watercolor',
                    // Novelty
                    'Heart print', 'Star print', 'Lip print', 'Eye print', 'Cherry print'
                ];
            } else if (itemType.includes('sweater') || itemType.includes('cardigan') || itemType.includes('jumper')) {
                patterns = [
                    // Knit-specific patterns
                    'Cable knit', 'Aran knit', 'Fisherman knit', 'Waffle knit', 'Seed stitch', 'Moss stitch', 'Ribbed knit', 'Honeycomb knit',
                    // Traditional knit patterns
                    'Fair Isle', 'Nordic', 'Scandinavian', 'Icelandic', 'Christmas knit', 'Snowflake', 'Reindeer', 'Hearts', 'Trees',
                    // Color work
                    'Intarsia', 'Jacquard', 'Color block', 'Two-tone', 'Ombre', 'Gradient',
                    // Geometric knits
                    'Argyle', 'Diamond', 'Chevron', 'Zigzag', 'Geometric', 'Abstract',
                    // Textural
                    'Textured', 'Bobble knit', 'Popcorn stitch', 'Basket weave', 'Lattice', 'Twist stitch',
                    // Stripes in knit
                    'Striped', 'Multi-stripe', 'Breton stripe', 'Rugby stripe', 'Gradient stripe',
                    // Animal motifs
                    'Animal motif', 'Cat motif', 'Dog motif', 'Sheep motif', 'Bird motif',
                    // Novelty knits
                    'Logo knit', 'Varsity style', 'University style', 'Vintage logo'
                ];
            } else if (itemType.includes('pants') || itemType.includes('trousers') || itemType.includes('jeans')) {
                patterns = [
                    // Professional patterns
                    'Pinstripe', 'Thin stripe', 'Chalk stripe', 'Herringbone', 'Tweed', 'Glen plaid', 'Prince of Wales', 'Houndstooth', 'Windowpane',
                    // Checks
                    'Checked', 'Small check', 'Large check', 'Buffalo check', 'Tattersall',
                    // Plaids
                    'Plaid', 'Tartan', 'Madras', 'Flannel plaid',
                    // Casual patterns
                    'Corduroy', 'Ribbed', 'Textured weave', 'Slub weave',
                    // Denim specific
                    'Acid wash', 'Stone wash', 'Distressed', 'Bleached', 'Tie dye denim', 'Patchwork denim',
                    // Print pants
                    'Floral', 'Tropical print', 'Animal print', 'Leopard print', 'Snake print',
                    // Geometric
                    'Geometric', 'Abstract', 'Chevron', 'Diamond print',
                    // Vintage inspired
                    'Paisley', 'Vintage print', '70s print', 'Psychedelic'
                ];
            } else if (itemType.includes('jacket') || itemType.includes('blazer') || itemType.includes('coat')) {
                patterns = [
                    // Classic patterns
                    'Tweed', 'Herringbone', 'Houndstooth', 'Glen plaid', 'Prince of Wales', 'Windowpane', 'Tattersall',
                    // Checks & plaids
                    'Checked', 'Buffalo check', 'Plaid', 'Tartan', 'Madras',
                    // Stripes
                    'Pinstripe', 'Chalk stripe', 'Striped', 'Multi-stripe',
                    // Textural
                    'Quilted', 'Diamond quilted', 'Channel quilted', 'Puffer pattern', 'Corduroy', 'Velvet', 'Boucle',
                    // Animal textures
                    'Faux fur', 'Sherpa', 'Teddy bear', 'Fleece',
                    // Leather textures
                    'Crocodile embossed', 'Snake embossed', 'Pebbled leather', 'Smooth leather', 'Suede',
                    // Modern patterns
                    'Color block', 'Two-tone', 'Contrast panel', 'Geometric', 'Abstract',
                    // Vintage inspired
                    'Vintage print', 'Retro pattern', 'Art deco', 'Paisley'
                ];
            } else if (itemType.includes('scarf') || itemType.includes('shawl') || itemType.includes('wrap')) {
                patterns = [
                    // Classic scarf patterns
                    'Paisley', 'Floral', 'Rose print', 'Botanical', 'Liberty print', 'English garden',
                    // Geometric
                    'Geometric', 'Abstract', 'Art deco', 'Memphis print', 'Chevron', 'Diamond', 'Circle print', 'Square print',
                    // Stripes & checks
                    'Striped', 'Multi-stripe', 'Checked', 'Plaid', 'Tartan', 'Gingham',
                    // Animal prints
                    'Animal print', 'Leopard print', 'Zebra print', 'Snake print', 'Tiger print', 'Cheetah print',
                    // Dots
                    'Polka dot', 'Large polka dot', 'Small polka dot', 'Scattered dots',
                    // Cultural patterns
                    'Tribal', 'Ethnic', 'Ikat', 'Batik', 'Mandala', 'Moroccan', 'Indian print', 'African print', 'Turkish print',
                    // Designer inspired
                    'Logo print', 'Monogram', 'Chain print', 'Horseshoe print', 'Anchor print', 'Nautical',
                    // Nature themes
                    'Butterfly', 'Bird print', 'Feather print', 'Shell print', 'Sea life', 'Tropical',
                    // Vintage & retro
                    'Vintage print', 'Retro print', '70s print', '80s print', 'Psychedelic', 'Op art',
                    // Novelty
                    'Constellation', 'Galaxy', 'Moon phases', 'Zodiac', 'Travel print', 'Map print'
                ];
            } else if (itemType.includes('bag') || itemType.includes('purse') || itemType.includes('clutch') || itemType.includes('tote') || itemType.includes('backpack')) {
                patterns = [
                    // Luxury textures
                    'Quilted', 'Diamond quilted', 'Channel quilted', 'Chevron quilted',
                    // Leather textures
                    'Crocodile', 'Alligator', 'Snake', 'Lizard', 'Python', 'Ostrich', 'Pebbled leather', 'Saffiano', 'Patent leather',
                    // Woven & braided
                    'Woven', 'Braided', 'Basket weave', 'Raffia', 'Straw', 'Rattan',
                    // Designer patterns
                    'Monogram', 'Logo print', 'Logo all-over', 'Signature print', 'Canvas print',
                    // Animal prints
                    'Leopard print', 'Zebra print', 'Cow print', 'Tiger print', 'Cheetah print',
                    // Geometric
                    'Geometric', 'Abstract', 'Diamond pattern', 'Triangle print', 'Hexagon',
                    // Textural
                    'Studded', 'Embossed', 'Debossed', 'Perforated', 'Laser cut', 'Cut-out design',
                    // Metallic & shiny
                    'Metallic', 'Holographic', 'Iridescent', 'Sequined', 'Beaded', 'Crystal embellished',
                    // Fabric patterns
                    'Floral', 'Paisley', 'Striped', 'Checked', 'Plaid', 'Polka dot',
                    // Special finishes
                    'Matte finish', 'Glossy finish', 'Distressed', 'Vintage finish', 'Crackled'
                ];
            } else if (itemType.includes('shoes') || itemType.includes('boots') || itemType.includes('heels') || itemType.includes('flats') || itemType.includes('sneakers') || itemType.includes('sandals')) {
                patterns = [
                    // Leather textures
                    'Patent leather', 'Matte leather', 'Pebbled leather', 'Smooth leather', 'Distressed leather', 'Vintage leather',
                    // Exotic textures
                    'Crocodile', 'Snake', 'Python', 'Lizard', 'Ostrich', 'Stingray',
                    // Suede varieties
                    'Suede', 'Nubuck', 'Velvet', 'Brushed suede',
                    // Woven & textural
                    'Woven', 'Braided', 'Canvas', 'Mesh', 'Knit', 'Crochet', 'Macrame',
                    // Metallic & shiny
                    'Metallic', 'Gold', 'Silver', 'Rose gold', 'Bronze', 'Holographic', 'Iridescent', 'Mirror',
                    // Embellishments
                    'Studded', 'Spiked', 'Rhinestone', 'Crystal', 'Beaded', 'Embroidered', 'Sequined', 'Glitter',
                    // Cut-out designs
                    'Perforated', 'Laser cut', 'Cut-out', 'Caged', 'Strappy', 'Lattice',
                    // Animal prints
                    'Leopard print', 'Zebra print', 'Snake print', 'Tiger print', 'Cow print', 'Cheetah print',
                    // Patterns on fabric shoes
                    'Floral', 'Polka dot', 'Striped', 'Checked', 'Plaid', 'Geometric', 'Abstract',
                    // Special finishes
                    'Quilted', 'Padded', 'Textured sole', 'Platform', 'Chunky sole', 'Cleated sole'
                ];
            } else if (itemType.includes('jewelry') || itemType.includes('necklace') || itemType.includes('bracelet') || itemType.includes('ring') || itemType.includes('earrings')) {
                patterns = [
                    // Metal finishes
                    'Polished', 'Matte', 'Brushed', 'Hammered', 'Textured', 'Oxidized', 'Antique finish', 'Vintage finish',
                    // Chain types
                    'Cable chain', 'Curb chain', 'Rope chain', 'Box chain', 'Snake chain', 'Figaro chain', 'Wheat chain', 'Byzantine chain',
                    // Patterns & designs
                    'Twisted', 'Braided', 'Woven', 'Mesh', 'Filigree', 'Engraved', 'Etched', 'Carved',
                    // Gemstone settings
                    'Pavé', 'Channel set', 'Prong set', 'Bezel set', 'Tension set', 'Cluster', 'Halo',
                    // Stone arrangements
                    'Single stone', 'Three stone', 'Five stone', 'Graduated', 'Scattered', 'Linear',
                    // Decorative elements
                    'Floral motif', 'Geometric', 'Abstract', 'Art deco', 'Victorian', 'Edwardian', 'Modern',
                    // Special techniques
                    'Hand-forged', 'Cast', 'Stamped', 'Wire-wrapped', 'Soldered', 'Riveted',
                    // Cultural styles
                    'Celtic knot', 'Infinity', 'Cross', 'Heart', 'Star', 'Moon', 'Sun', 'Tree of life'
                ];
            } else if (itemType.includes('hat') || itemType.includes('cap') || itemType.includes('beanie')) {
                patterns = [
                    // Knit patterns
                    'Cable knit', 'Ribbed', 'Chunky knit', 'Fine knit', 'Waffle knit', 'Seed stitch',
                    // Woven patterns
                    'Tweed', 'Herringbone', 'Plaid', 'Checked', 'Striped', 'Gingham',
                    // Prints
                    'Logo print', 'Floral', 'Animal print', 'Geometric', 'Abstract', 'Vintage print',
                    // Textural
                    'Felt', 'Wool felt', 'Fur trim', 'Faux fur', 'Fleece lined', 'Sherpa lined',
                    // Straw & natural
                    'Straw weave', 'Raffia', 'Paper straw', 'Natural fiber', 'Wicker',
                    // Embellishments
                    'Embroidered', 'Beaded', 'Sequined', 'Studded', 'Pin details',
                    // Special features
                    'Mesh panels', 'Perforated', 'Quilted', 'Padded', 'Contrast stitching'
                ];
            } else if (itemType.includes('belt')) {
                patterns = [
                    // Leather textures
                    'Smooth leather', 'Pebbled leather', 'Patent leather', 'Suede', 'Distressed leather',
                    // Exotic textures
                    'Crocodile', 'Snake', 'Lizard', 'Ostrich',
                    // Woven & braided
                    'Braided', 'Woven', 'Plaited', 'Rope', 'Cord',
                    // Metal types
                    'Chain', 'Link chain', 'Mesh', 'Studded', 'Spiked', 'Grommeted',
                    // Patterns
                    'Logo print', 'Monogram', 'Geometric', 'Abstract', 'Vintage print',
                    // Finishes
                    'Matte', 'Glossy', 'Metallic', 'Antique', 'Vintage finish',
                    // Special features
                    'Perforated', 'Laser cut', 'Embossed', 'Debossed', 'Quilted'
                ];
            } else {
                // Default comprehensive patterns for other items
                patterns = [
                    'Striped', 'Checked', 'Plaid', 'Floral', 'Polka dot', 'Geometric', 'Abstract', 
                    'Animal print', 'Paisley', 'Textured', 'Embossed', 'Vintage print', 'Retro print',
                    'Tie dye', 'Ombre', 'Gradient', 'Color block', 'Two-tone', 'Metallic',
                    'Quilted', 'Cable knit', 'Fair Isle', 'Houndstooth', 'Herringbone', 'Tweed'
                ];
            }
            
            // Add pattern options to select
            patterns.forEach(pattern => {
                const optionElement = document.createElement('option');
                optionElement.value = pattern;
                optionElement.textContent = pattern;
                patternSelect.appendChild(optionElement);
            });
        }

        // ============ MATERIAL OPTIONS UPDATE ============
        
        function updateMaterialOptions() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const material1Select = document.getElementById('material1');
            const material2Select = document.getElementById('material2');
            
            // Clear current options but keep the default ones for material1
            material1Select.innerHTML = '<option value="">Select primary material...</option>';
            material2Select.innerHTML = '<option value="">None / Single material</option>';
            
            let materials = [];
            
            if (itemType.includes('shoes') || itemType.includes('boots') || itemType.includes('heels') || itemType.includes('flats') || itemType.includes('sneakers') || itemType.includes('sandals')) {
                materials = [
                    'Leather', 'Faux leather', 'Suede', 'Patent leather', 'Canvas', 'Rubber', 
                    'Synthetic', 'Mesh', 'Fabric', 'Velvet', 'Satin', 'Cork', 'Wood', 
                    'Plastic', 'PVC', 'Neoprene', 'Denim', 'Tweed'
                ];
            } else if (itemType.includes('bag') || itemType.includes('purse') || itemType.includes('clutch') || itemType.includes('tote') || itemType.includes('backpack')) {
                materials = [
                    'Leather', 'Faux leather', 'Canvas', 'Nylon', 'Polyester', 'Suede', 
                    'Patent leather', 'PVC', 'Vinyl', 'Denim', 'Velvet', 'Satin', 
                    'Straw', 'Raffia', 'Wicker', 'Cork', 'Rubber', 'Mesh'
                ];
            } else if (itemType.includes('jewelry') || itemType.includes('necklace') || itemType.includes('bracelet') || itemType.includes('ring') || itemType.includes('earrings')) {
                materials = [
                    'Gold', 'Silver', 'Rose gold', 'Sterling silver', 'Gold plated', 'Silver plated', 
                    'Stainless steel', 'Brass', 'Bronze', 'Copper', 'Titanium', 'Platinum', 
                    'Alloy', 'Pewter', 'Resin', 'Plastic', 'Wood', 'Glass', 'Crystal', 
                    'Pearl', 'Stone', 'Enamel', 'Leather', 'Fabric', 'Cord'
                ];
            } else if (itemType.includes('belt')) {
                materials = [
                    'Leather', 'Faux leather', 'Canvas', 'Fabric', 'Chain', 'Metal', 
                    'Rope', 'Cord', 'Elastic', 'PVC', 'Suede', 'Patent leather'
                ];
            } else if (itemType.includes('hat') || itemType.includes('cap') || itemType.includes('beanie')) {
                materials = [
                    'Cotton', 'Wool', 'Acrylic', 'Polyester', 'Felt', 'Straw', 'Canvas', 
                    'Denim', 'Leather', 'Suede', 'Fleece', 'Knit', 'Mesh', 'Nylon'
                ];
            } else if (itemType.includes('scarf') || itemType.includes('shawl') || itemType.includes('wrap')) {
                materials = [
                    'Silk', 'Cashmere', 'Wool', 'Cotton', 'Modal', 'Viscose', 'Polyester', 
                    'Acrylic', 'Linen', 'Pashmina', 'Alpaca', 'Mohair', 'Chiffon', 'Satin'
                ];
            } else if (itemType.includes('gloves')) {
                materials = [
                    'Leather', 'Wool', 'Cashmere', 'Cotton', 'Acrylic', 'Fleece', 
                    'Suede', 'Synthetic', 'Nylon', 'Polyester'
                ];
            } else if (itemType.includes('sunglasses') || itemType.includes('glasses')) {
                materials = [
                    'Plastic', 'Metal', 'Acetate', 'Titanium', 'Stainless steel', 
                    'Aluminum', 'Wood', 'Horn', 'Carbon fiber'
                ];
            } else if (itemType.includes('watch')) {
                materials = [
                    'Stainless steel', 'Gold', 'Silver', 'Rose gold', 'Titanium', 
                    'Ceramic', 'Leather', 'Rubber', 'Fabric', 'Metal', 'Plastic'
                ];
            } else {
                // Default materials for clothing
                materials = [
                    'Cotton', 'Wool', 'Silk', 'Linen', 'Cashmere', 'Leather', 'Suede', 
                    'Denim', 'Polyester', 'Viscose', 'Rayon', 'Nylon', 'Acrylic', 
                    'Elastane', 'Tencel', 'Modal', 'Bamboo', 'Hemp'
                ];
            }
            
            // Add material options to both selects
            materials.forEach(material => {
                // Primary material
                const option1 = document.createElement('option');
                option1.value = material;
                option1.textContent = material;
                material1Select.appendChild(option1);
                
                // Secondary material (skip if it's a jewelry/accessory item with single materials)
                if (!itemType.includes('jewelry') && !itemType.includes('watch') && !itemType.includes('sunglasses')) {
                    const option2 = document.createElement('option');
                    option2.value = material;
                    option2.textContent = material;
                    material2Select.appendChild(option2);
                }
            });
        }

        // ============ ACCESSORY DETECTION & SIZE REQUIREMENT ============
        
        function isAccessoryItem(itemType) {
            const itemTypeLower = itemType.toLowerCase();
            const accessories = [
                'bag', 'purse', 'handbag', 'clutch', 'tote', 'backpack', 'crossbody', 'shoulder bag',
                'necklace', 'bracelet', 'ring', 'earrings', 'jewelry', 'chain', 'pendant',
                'hat', 'cap', 'beanie', 'beret', 'fedora', 'bucket hat',
                'scarf', 'shawl', 'wrap', 'pashmina', 'bandana',
                'sunglasses', 'glasses', 'reading glasses',
                'watch', 'smart watch', 'vintage watch',
                'belt', 'chain belt', 'leather belt',
                'gloves', 'winter gloves', 'leather gloves',
                'phone case', 'wallet', 'card holder', 'key chain',
                'tie', 'bow tie', 'pocket square', 'cufflinks',
                'hair accessories', 'hair clips', 'headband', 'scrunchies'
            ];
            
            return accessories.some(accessory => itemTypeLower.includes(accessory));
        }

        function updateSizeRequirement() {
            const itemType = document.getElementById('item-type').value;
            const sizeLabel = document.getElementById('size-label');
            const sizeInput = document.getElementById('size');
            
            const isAccessory = isAccessoryItem(itemType);
            
            if (isAccessory) {
                // Size is optional for accessories
                sizeLabel.textContent = 'Size (optional for accessories)';
                sizeInput.removeAttribute('required');
                sizeInput.placeholder = 'e.g., One size, Adjustable, S/M/L (if applicable)';
            } else {
                // Size is required for clothing
                sizeLabel.textContent = 'Size *';
                sizeInput.setAttribute('required', 'required');
                sizeInput.placeholder = 'e.g., S, M, L, 8, 10, 12, EU38';
            }
        }

        // ============ ERA OPTIONS UPDATE ============
        
        function updateEraOptions() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const eraSelect = document.getElementById('era');
            
            // Clear current options
            eraSelect.innerHTML = '<option value="">Select era...</option>';
            
            let eras = [];
            
            if (itemType.includes('vintage') || itemType.includes('retro')) {
                // Prioritize vintage eras for vintage items
                eras = ['2020s', '2010s', '2000s / Y2K', '90s', '80s', '70s', '60s', '50s', '40s and earlier', 'Unspecified Vintage'];
            } else if (itemType.includes('jean') || itemType.includes('denim')) {
                // Denim has strong era associations
                eras = ['2020s', '2010s', '2000s / Y2K', '90s', '80s', '70s', '60s', 'Unspecified Vintage'];
            } else if (itemType.includes('blazer') || itemType.includes('suit') || itemType.includes('jacket')) {
                // Formal wear with vintage appeal
                eras = ['2020s', '2010s', '2000s / Y2K', '90s', '80s', '70s', '60s', '50s', 'Unspecified Vintage'];
            } else {
                // Standard eras for all items
                eras = ['2020s', '2010s', '2000s / Y2K', '90s', '80s', '70s', '60s', '50s', '40s and earlier', 'Unspecified Vintage'];
            }
            
            // Add era options to select
            eras.forEach(era => {
                const optionElement = document.createElement('option');
                optionElement.value = era;
                optionElement.textContent = era;
                eraSelect.appendChild(optionElement);
            });
        }

        // ============ STYLE AESTHETIC OPTIONS UPDATE ============
        
        function updateStyleAestheticOptions() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const styleSelect = document.getElementById('style-aesthetic');
            
            // Clear current options
            styleSelect.innerHTML = '<option value="">Select aesthetic...</option>';
            
            let aesthetics = [];
            
            if (itemType.includes('dress') || itemType.includes('skirt')) {
                aesthetics = [
                    'Cottagecore', 'Dark Academia', 'Light Academia', 'Romantic', 'Feminine', 
                    'Coquette', 'Y2K', 'Vintage', 'Minimalist', 'Boho', 'Preppy', 
                    'Clean Girl', 'That Girl', 'Old Money', 'Quiet Luxury'
                ];
            } else if (itemType.includes('jean') || itemType.includes('pants') || itemType.includes('trousers')) {
                aesthetics = [
                    'Y2K', 'Grunge', 'Streetwear', 'Minimalist', 'Vintage', 'Preppy',
                    'Dark Academia', 'Indie', 'Alternative', 'Clean Girl', 'Old Money'
                ];
            } else if (itemType.includes('blazer') || itemType.includes('shirt') || itemType.includes('blouse')) {
                aesthetics = [
                    'Dark Academia', 'Light Academia', 'Preppy', 'Minimalist', 'Old Money',
                    'Quiet Luxury', 'Workwear', 'Corporate', 'Business Casual', 'Smart Casual'
                ];
            } else if (itemType.includes('sweater') || itemType.includes('cardigan')) {
                aesthetics = [
                    'Dark Academia', 'Light Academia', 'Cottagecore', 'Grandpa', 'Grandma',
                    'Vintage', 'Minimalist', 'Cozy', 'Preppy', 'Old Money'
                ];
            } else if (itemType.includes('top') || itemType.includes('tank') || itemType.includes('t-shirt')) {
                aesthetics = [
                    'Y2K', 'Grunge', 'Streetwear', 'Indie', 'Alternative', 'Clean Girl',
                    'Soft Girl', 'VSCO Girl', 'Minimalist', 'Casual'
                ];
            } else if (itemType.includes('jacket') || itemType.includes('coat')) {
                aesthetics = [
                    'Grunge', 'Rock', 'Punk', 'Streetwear', 'Vintage', 'Minimalist',
                    'Dark Academia', 'Old Money', 'Edgy'
                ];
            } else if (itemType.includes('jewelry') || itemType.includes('necklace') || itemType.includes('earrings') || itemType.includes('bracelet') || itemType.includes('ring')) {
                aesthetics = [
                    'Y2K', 'Coquette', 'Vintage', 'Minimalist', 'Boho', 'Grunge',
                    'Clean Girl', 'That Girl', 'Fairycore', 'Dark Academia'
                ];
            } else if (itemType.includes('bag') || itemType.includes('purse') || itemType.includes('clutch')) {
                aesthetics = [
                    'Y2K', 'Vintage', 'Minimalist', 'Old Money', 'Quiet Luxury',
                    'Preppy', 'Boho', 'Clean Girl', 'That Girl'
                ];
            } else {
                // All aesthetics for other items
                aesthetics = [
                    'Minimalist', 'Y2K', '2000s', 'Cottagecore', 'Dark Academia', 'Light Academia',
                    'Boho', 'Bohemian', 'Vintage', 'Retro', 'Grunge', 'Preppy', 'Streetwear',
                    'Romantic', 'Feminine', 'Androgynous', 'Tomboy', 'Chic', 'Parisian',
                    'Scandi', 'Scandinavian', 'Indie', 'Alternative', 'Goth', 'Emo', 'Punk',
                    'Rock', 'Hipster', 'Artsy', 'Edgy', 'Soft Girl', 'VSCO Girl', 'Clean Girl',
                    'That Girl', 'Old Money', 'Quiet Luxury', 'Coquette', 'Fairycore',
                    'Goblincore', 'Kidcore', 'Kawaii', 'Harajuku', 'Korean Fashion',
                    'Japanese Fashion', 'Workwear', 'Corporate', 'Business Casual',
                    'Smart Casual', 'Casual', 'Sporty', 'Athleisure', 'Coastal', 'Grandpa', 'Grandma'
                ];
            }
            
            // Add aesthetic options to select
            aesthetics.forEach(aesthetic => {
                const optionElement = document.createElement('option');
                optionElement.value = aesthetic;
                optionElement.textContent = aesthetic;
                styleSelect.appendChild(optionElement);
            });
        }

        // ============ MEASUREMENTS PLACEHOLDER UPDATE ============
        
        function updateMeasurementsPlaceholder() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const measurementsInput = document.getElementById('measurements');
            
            let placeholder = '';
            
            if (itemType.includes('dress')) {
                placeholder = 'e.g., Bust 38cm, Waist 32cm, Length 90cm, Shoulder 36cm';
            } else if (itemType.includes('top') || itemType.includes('blouse') || itemType.includes('shirt') || itemType.includes('sweater') || itemType.includes('cardigan')) {
                placeholder = 'e.g., Chest 40cm, Length 60cm, Shoulder 38cm, Sleeve 58cm';
            } else if (itemType.includes('pants') || itemType.includes('trousers') || itemType.includes('jeans')) {
                placeholder = 'e.g., Waist 32cm, Inseam 76cm, Rise 28cm, Leg opening 16cm';
            } else if (itemType.includes('skirt')) {
                placeholder = 'e.g., Waist 30cm, Hip 40cm, Length 50cm';
            } else if (itemType.includes('jacket') || itemType.includes('blazer') || itemType.includes('coat')) {
                placeholder = 'e.g., Chest 42cm, Length 65cm, Shoulder 40cm, Sleeve 60cm';
            } else if (itemType.includes('shorts')) {
                placeholder = 'e.g., Waist 30cm, Inseam 12cm, Rise 25cm';
            } else if (itemType.includes('shoes') || itemType.includes('boots') || itemType.includes('heels')) {
                placeholder = 'e.g., Length 25cm, Width 9cm, Heel height 8cm';
            } else if (itemType.includes('bag') || itemType.includes('purse') || itemType.includes('clutch') || itemType.includes('tote')) {
                placeholder = 'e.g., Width 30cm, Height 25cm, Depth 12cm, Strap drop 50cm';
            } else if (itemType.includes('necklace')) {
                placeholder = 'e.g., Length 45cm, Pendant 3cm x 2cm';
            } else if (itemType.includes('bracelet')) {
                placeholder = 'e.g., Length 18cm, Width 1.5cm';
            } else if (itemType.includes('ring')) {
                placeholder = 'e.g., UK size N, US size 7, Inner diameter 17mm';
            } else if (itemType.includes('earrings')) {
                placeholder = 'e.g., Length 4cm, Width 2cm';
            } else if (itemType.includes('scarf') || itemType.includes('shawl')) {
                placeholder = 'e.g., Length 180cm, Width 70cm';
            } else if (itemType.includes('belt')) {
                placeholder = 'e.g., Length 110cm, Width 3cm, Fits waist 75-95cm';
            } else if (itemType.includes('hat') || itemType.includes('cap') || itemType.includes('beanie')) {
                placeholder = 'e.g., Circumference 58cm, Brim width 7cm';
            } else {
                // Default placeholder
                placeholder = 'e.g., Chest 38cm, Length 60cm, Waist 32cm';
            }
            
            measurementsInput.placeholder = placeholder;
        }

        // ============ FLAWS PLACEHOLDER UPDATE ============
        
        function updateFlawsPlaceholder() {
            const itemType = document.getElementById('item-type').value.toLowerCase();
            const flawsInput = document.getElementById('flaws');
            
            let placeholder = '';
            
            if (itemType.includes('jean') || itemType.includes('denim')) {
                placeholder = 'e.g., Minor fading on knees, small hole on back pocket, hem slightly frayed';
            } else if (itemType.includes('sweater') || itemType.includes('cardigan') || itemType.includes('knit')) {
                placeholder = 'e.g., Small pull on left sleeve, minor pilling under arms, one button loose';
            } else if (itemType.includes('shoes') || itemType.includes('boots') || itemType.includes('heels')) {
                placeholder = 'e.g., Scuff on toe, heel slightly worn, insole shows wear, sole has minor scratches';
            } else if (itemType.includes('bag') || itemType.includes('purse') || itemType.includes('clutch')) {
                placeholder = 'e.g., Small stain on lining, corner slightly worn, zipper pull missing, handle shows wear';
            } else if (itemType.includes('leather') || itemType.includes('suede')) {
                placeholder = 'e.g., Minor scuff on front, leather slightly cracked, color faded in spots';
            } else if (itemType.includes('silk') || itemType.includes('satin')) {
                placeholder = 'e.g., Tiny snag near hem, small water mark on back, lining slightly loose';
            } else if (itemType.includes('dress') || itemType.includes('skirt')) {
                placeholder = 'e.g., Small stain on skirt, missing button, hem needs adjusting, zipper sticks slightly';
            } else if (itemType.includes('shirt') || itemType.includes('blouse') || itemType.includes('top')) {
                placeholder = 'e.g., Small stain on collar, button loose, tiny hole near seam, slight discoloration';
            } else if (itemType.includes('jacket') || itemType.includes('blazer') || itemType.includes('coat')) {
                placeholder = 'e.g., Missing button, small tear in lining, pocket slightly loose, cuff shows wear';
            } else if (itemType.includes('jewelry') || itemType.includes('necklace') || itemType.includes('bracelet') || itemType.includes('earrings')) {
                placeholder = 'e.g., Clasp slightly loose, minor tarnishing, stone has tiny chip, chain shows wear';
            } else if (itemType.includes('vintage')) {
                placeholder = 'e.g., Age-appropriate wear, vintage patina, small repair on seam, label faded';
            } else {
                // Default placeholder
                placeholder = 'Describe any stains, holes, missing buttons, wear marks, etc. Be specific about location and size.';
            }
            
            flawsInput.placeholder = placeholder;
        }

        // ============ RADIO BUTTON DESELECTION FUNCTIONALITY ============
        
        function setupRadioDeselection() {
            const seasonRadios = document.querySelectorAll('.season-radio');
            
            seasonRadios.forEach(radio => {
                let previousValue = null;
                
                radio.addEventListener('click', function() {
                    // If this radio was already selected, deselect it
                    if (this.value === previousValue) {
                        this.checked = false;
                        previousValue = null;
                    } else {
                        previousValue = this.value;
                    }
                });
                
                // Track when radio becomes checked via other means (like clicking another radio)
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        // Update previousValue for all radios in this group
                        seasonRadios.forEach(r => {
                            r.previousValue = r.checked ? r.value : null;
                        });
                    }
                });
            });
        }

        // ============ BUILD DESCRIPTION FROM FORM DATA ============
        
        function buildDescriptionFromFormData(formData) {
            // Build description using EXACT same logic as AI generation
            let description = `Brand: ${formData.brand || 'Unbranded'}`;

            // Only include size if it's provided
            if (formData.size && formData.size.trim()) {
                description += `\nSize: ${formData.size}`;
            }

            // Build material string
            let materialString = formData.material1;
            if (formData.material2) {
                materialString += `/${formData.material2}`;
            }

            description += `\nMaterial: ${materialString}`;
            description += `\nColour: ${formData.color}`;

            if (formData.pattern) description += `\nPattern: ${formData.pattern}`;
            
            // Only show era if it's specified and not default
            if (formData.era && formData.era !== 'Unspecified Vintage') {
                description += `\nEra: ${formData.era}`;
            }

            if (formData.fit) description += `\nFit: ${formData.fit}`;
            if (formData.length) description += `\nLength: ${formData.length}`;
            
            // Combine selected features with custom features
            let allFeatures = formData.features;
            if (formData.customFeatures) {
                allFeatures += allFeatures ? `, ${formData.customFeatures}` : formData.customFeatures;
            }
            if (allFeatures) description += `\nFeatures: ${allFeatures}`;
            
            if (formData.season) description += `\nSeason: ${formData.season}`;
            if (formData.measurements) description += `\nMeasurements: ${formData.measurements}`;

            // Fix condition display for BNWT/NWOT
            let displayCondition = formData.condition;
            if (formData.condition === 'BNWT') {
                displayCondition = 'Brand new with tags';
            } else if (formData.condition === 'NWOT') {
                displayCondition = 'New without tags';
            }

            description += `\nCondition: ${displayCondition}`;

            if (formData.flaws) description += `\n\nPlease note: ${formData.flaws}`;

            // Check if this is an accessory (no washing/steaming needed)
            const isAccessory = isAccessoryItem(formData.itemType);
            description += isAccessory ? 
                '\n\nShips within 2 working days.' : 
                '\n\nWashed and steamed, ships within 2 working days.';

            // Generate hashtags using our smart system
            const generatedHashtags = generateSmartHashtags(formData);
            description += `\n\n${generatedHashtags}`;

            return description;
        }

        function buildTitleFromFormData(formData) {
            let titleParts = [];
            
            // Start with brand or era
            if (formData.brand && formData.brand.toLowerCase() !== 'unbranded' && formData.brand.toLowerCase() !== 'no brand') {
                titleParts.push(formData.brand);
            } else if (formData.era && formData.era !== 'Unspecified Vintage' && formData.era !== '2020s') {
                titleParts.push(formData.era);
            }
            
            // Add color if not basic
            if (formData.color && !['Black', 'White', 'Grey'].includes(formData.color)) {
                titleParts.push(formData.color);
            }
            
            // Add pattern if specified
            if (formData.pattern) {
                titleParts.push(formData.pattern);
            }
            
            // Add item type
            titleParts.push(formData.itemType);
            
            // Add fit or aesthetic if specified and space allows
            if (formData.fit && titleParts.join(' ').length < 40) {
                titleParts.push(formData.fit);
            } else if (formData.styleAesthetic && titleParts.join(' ').length < 40) {
                titleParts.push(formData.styleAesthetic);
            }
            
            // Always add size (if provided)
            if (formData.size) {
                titleParts.push(`Size ${formData.size}`);
            }
            
            // Limit to reasonable length
            let title = titleParts.join(' ');
            if (title.length > 60) {
                // Remove less important parts
                titleParts = titleParts.slice(0, -2); // Remove last two parts
                if (formData.size) titleParts.push(`Size ${formData.size}`); // Keep size if available
                title = titleParts.join(' ');
            }
            
            return title;
        }

        // ============ TEST CURL COMMAND FUNCTION ============
        
        async function testCurlCommandGeneration() {
            console.log('🧪 TESTING CURL COMMAND GENERATION');
            console.log('=====================================');
            
            // Simulate having generated content
            const testTitle = "Zara Black Midi Dress Size M Elegant";
            const testDescription = `Brand: Zara
Size: M
Material: Polyester/Elastane
Colour: Black
Pattern: Solid color
Fit: Bodycon
Length: Midi length
Features: Side zip, Lined, V-neck
Season: Summer
Condition: Very good

Washed and steamed, ships within 2 working days.

#Dress #Zara #Black #Bodycon #MidiDress #VintedFind #SustainableFashion #TimelessStyle #StatementPiece #SecondHand`;

            // Set up test data in DOM
            document.getElementById('generated-title').textContent = testTitle;
            document.getElementById('generated-description').textContent = testDescription;
            document.getElementById('description-section').classList.remove('hidden');
            
            // Set global variable
            currentDescription = testDescription;
            
            // Fill some form data
            document.getElementById('item-type').value = 'Dress';
            document.getElementById('brand').value = 'Zara';
            document.getElementById('size').value = 'M';
            document.getElementById('material1').value = 'Polyester';
            document.getElementById('condition').value = 'Very good';
            
            // Select a color
            const blackCheckbox = document.querySelector('.color-checkbox[value="Black"]');
            if (blackCheckbox) blackCheckbox.checked = true;
            
            console.log('✅ Test data setup complete');
            console.log('📝 Test title:', testTitle);
            console.log('📄 Test description length:', testDescription.length);
            console.log('🔍 Global currentDescription set:', !!currentDescription);
            
            // Now test the extraction logic
            console.log('\n🔍 TESTING DESCRIPTION EXTRACTION:');
            console.log('=====================================');
            
            let actualDescription = '';
            
            // Method 1: Global variable test
            if (currentDescription && currentDescription.trim()) {
                actualDescription = currentDescription.trim();
                console.log('✅ Method 1 (Global variable): SUCCESS');
                console.log('   Length:', actualDescription.length);
                console.log('   Preview:', actualDescription.substring(0, 100) + '...');
            } else {
                console.log('❌ Method 1 (Global variable): FAILED');
            }
            
            // Method 2: DOM extraction test
            const descriptionElement = document.getElementById('generated-description');
            if (descriptionElement) {
                const domDescription = descriptionElement.textContent || descriptionElement.innerText || '';
                console.log('✅ Method 2 (DOM extraction): Available');
                console.log('   Length:', domDescription.trim().length);
                console.log('   Preview:', domDescription.substring(0, 100) + '...');
            } else {
                console.log('❌ Method 2 (DOM extraction): Element not found');
            }
            
            // Test JSON escaping
            console.log('\n🔧 TESTING JSON ESCAPING:');
            console.log('=====================================');
            
            function escapeForJSON(str) {
                return str
                    .replace(/\\/g, '\\\\')
                    .replace(/"/g, '\\"')
                    .replace(/\n/g, '\\n')
                    .replace(/\r/g, '\\r')
                    .replace(/\t/g, '\\t');
            }
            
            const originalText = 'Test with "quotes" and \n newlines and \t tabs';
            const escapedText = escapeForJSON(originalText);
            console.log('Original:', originalText);
            console.log('Escaped:', escapedText);
            
            const escapedDescription = escapeForJSON(actualDescription);
            console.log('✅ Description escaped for JSON');
            console.log('   Original length:', actualDescription.length);
            console.log('   Escaped length:', escapedDescription.length);
            
            // Test validation
            console.log('\n✅ TESTING VALIDATION:');
            console.log('=====================================');
            
            const validationChecks = {
                'Has description': !!actualDescription,
                'Description length > 20': actualDescription.length > 20,
                'Has title': !!testTitle,
                'Has item type': !!document.getElementById('item-type').value,
                'Contains brand info': actualDescription.includes('Brand:'),
                'Contains hashtags': actualDescription.includes('#'),
                'Contains size info': actualDescription.includes('Size:')
            };
            
            Object.entries(validationChecks).forEach(([check, passed]) => {
                console.log(`${passed ? '✅' : '❌'} ${check}: ${passed}`);
            });
            
            // Test curl command structure
            console.log('\n🚀 TESTING CURL COMMAND STRUCTURE:');
            console.log('=====================================');
            
            const propertiesObj = {
                "Item": {
                    "title": [{ "text": { "content": escapeForJSON(testTitle) } }]
                },
                "Item type": {
                    "select": { "name": "Dress" }
                },
                "Brand": {
                    "rich_text": [{ "text": { "content": "Zara" } }]
                },
                "Size": {
                    "rich_text": [{ "text": { "content": "M" } }]
                },
                "Description": {
                    "rich_text": [{ "text": { "content": escapedDescription } }]
                }
            };
            
            const payload = {
                "parent": { "database_id": "232a1f71-892c-808a-9013-cb1f0901e834" },
                "properties": propertiesObj
            };
            
            console.log('✅ Payload structure created');
            console.log('📊 Payload summary:');
            console.log('   - Title length:', propertiesObj.Item.title[0].text.content.length);
            console.log('   - Description length:', propertiesObj.Description.rich_text[0].text.content.length);
            console.log('   - Item type:', propertiesObj["Item type"].select.name);
            console.log('   - Brand:', propertiesObj.Brand.rich_text[0].text.content);
            console.log('   - Size:', propertiesObj.Size.rich_text[0].text.content);
            
            // Validate JSON structure
            try {
                const jsonString = JSON.stringify(payload, null, 2);
                const parsed = JSON.parse(jsonString);
                console.log('✅ JSON is valid and can be parsed');
                console.log('📏 JSON payload size:', jsonString.length, 'characters');
                
                // Check for potential issues
                const issues = [];
                if (jsonString.includes('""')) issues.push('Contains empty strings');
                if (jsonString.includes('null')) issues.push('Contains null values');
                if (jsonString.includes('undefined')) issues.push('Contains undefined values');
                
                if (issues.length === 0) {
                    console.log('✅ No JSON issues detected');
                } else {
                    console.log('⚠️ Potential JSON issues:', issues);
                }
                
            } catch (error) {
                console.log('❌ JSON validation failed:', error.message);
            }
            
            console.log('\n🎯 TEST SUMMARY:');
            console.log('=====================================');
            console.log('✅ Description extraction: Working');
            console.log('✅ JSON escaping: Working');
            console.log('✅ Validation logic: Working');
            console.log('✅ Curl structure: Working');
            console.log('📝 Ready for actual curl command generation');
            
            showAlert('🧪 Curl command test completed!\n\nCheck the browser console (F12) for detailed test results.\n\nAll validation checks passed - the function should now work correctly.');
        }
        
        // ============ FILL TEST DATA FUNCTION ============
        
        async function fillTestData() {
            console.log('🧪 Starting step-by-step test data filling...');
            
            // Show progress to user
            const btn = document.getElementById('fill-test-data-btn');
            const originalText = btn.textContent;
            btn.textContent = '⏳ Filling data...';
            btn.disabled = true;
            
            // Random data pools for comprehensive testing
            const testData = {
                itemTypes: [
                    'Dress', 'Midi Dress', 'Maxi Dress', 'Mini Dress', 'Party Dress',
                    'Blouse', 'Vintage Blouse', 'Shirt', 'Button-up Shirt', 'Top', 'Tank Top', 'Crop Top',
                    'Sweater', 'Vintage Sweater', 'Cardigan', 'Hoodie', 'Sweatshirt',
                    'Jeans', 'Vintage Jeans', 'Mom Jeans', 'Skinny Jeans', 'Trousers', 'Wide Leg Pants',
                    'Skirt', 'Midi Skirt', 'Mini Skirt', 'A-line Skirt', 'Pleated Skirt',
                    'Jacket', 'Leather Jacket', 'Denim Jacket', 'Bomber Jacket', 'Blazer', 'Vintage Blazer',
                    'Coat', 'Trench Coat', 'Heels', 'Boots', 'Sneakers', 'Flats', 'Sandals',
                    'Handbag', 'Shoulder Bag', 'Crossbody Bag', 'Tote Bag', 'Clutch', 'Backpack',
                    'Necklace', 'Bracelet', 'Ring', 'Earrings', 'Scarf', 'Belt', 'Hat', 'Sunglasses'
                ],
                brands: [
                    'Zara', 'H&M', 'COS', 'Arket', 'Uniqlo', 'Mango', '& Other Stories', 'Monki', 'Weekday',
                    'ASOS', 'Topshop', 'Urban Outfitters', 'Brandy Melville', 'American Apparel',
                    'Vintage', 'No brand', 'Unbranded', 'Levi\'s', 'Nike', 'Adidas', 'Calvin Klein',
                    'Tommy Hilfiger', 'Polo Ralph Lauren', 'Massimo Dutti', 'Sandro', 'Ganni'
                ],
                sizes: [
                    'XS', 'S', 'M', 'L', 'XL', 'XXL', '6', '8', '10', '12', '14', '16', '18',
                    'EU34', 'EU36', 'EU38', 'EU40', 'EU42', 'EU44', 'US2', 'US4', 'US6', 'US8', 'US10',
                    'One size', 'Adjustable', 'UK6', 'UK8', 'UK10', 'UK12', 'UK14'
                ],
                eras: ['2020s', '2010s', '2000s / Y2K', '90s', '80s', '70s', '60s', '50s', 'Unspecified Vintage'],
                materials1: ['Cotton', 'Wool', 'Silk', 'Linen', 'Cashmere', 'Leather', 'Suede', 'Denim', 'Polyester', 'Viscose', 'Modal', 'Tencel'],
                materials2: ['Cotton', 'Polyester', 'Elastane', 'Spandex', 'Viscose', 'Nylon', 'Acrylic', 'Wool', 'Silk'],
                conditions: ['BNWT', 'NWOT', 'Very good', 'Good', 'Satisfactory'],
                patterns: ['Striped', 'Floral', 'Polka dot', 'Checked', 'Plaid', 'Animal print', 'Geometric', 'Abstract', 'Paisley'],
                aesthetics: [
                    'Minimalist', 'Y2K', 'Cottagecore', 'Dark Academia', 'Boho', 'Vintage', 'Grunge', 'Preppy',
                    'Romantic', 'Clean Girl', 'Old Money', 'Coquette', 'Streetwear', 'Indie', 'Alternative'
                ],
                seasons: ['Summer', 'Winter'],
                // Use exact color values that exist in the form
                availableColors: ['Black', 'Brown', 'Grey', 'Beige', 'Pink', 'Purple', 'Red', 'Yellow', 'Blue', 'Green', 'Orange', 'White', 'Silver', 'Gold', 'Multi', 'Khaki', 'Turquoise', 'Cream', 'Apricot', 'Coral', 'Burgundy', 'Rose', 'Lilac', 'Light blue', 'Navy', 'Dark green', 'Mustard', 'Mint', 'Clear'],
                measurements: [
                    'Chest 38cm, Length 60cm, Shoulder 36cm',
                    'Bust 40cm, Waist 32cm, Length 90cm',
                    'Waist 30cm, Inseam 76cm, Rise 28cm',
                    'Chest 42cm, Length 65cm, Sleeve 58cm',
                    'Hip 40cm, Length 50cm, Waist 28cm',
                    'Length 25cm, Width 9cm, Heel 8cm',
                    'Width 30cm, Height 25cm, Depth 12cm'
                ],
                flaws: [
                    'Minor wear on collar, small thread pull',
                    'Tiny stain on back, barely visible',
                    'One button slightly loose, easily fixed',
                    'Small scuff on heel, normal wear',
                    'Minimal pilling under arms',
                    'Slight fading on seams, vintage character',
                    'Minor stretch in fabric, maintains shape',
                    'Small snag near hem, can be trimmed'
                ],
                features: [
                    'Vintage buttons, lined interior',
                    'Side pockets, adjustable straps',
                    'Pearl details, silk lining',
                    'Gold hardware, magnetic closure',
                    'Contrast stitching, raw hem',
                    'Embroidered details, hand-finished',
                    'Quilted texture, chain strap',
                    'Fringe trim, beaded accents'
                ],
                fitNotes: [
                    'True to size, comfortable fit',
                    'Runs small, size up for relaxed fit',
                    'Oversized as intended, boxy style',
                    'Stretchy fabric, forgiving fit',
                    'Fitted through waist, flows at hem',
                    'High waisted, flattering silhouette',
                    'Cropped length, hits at hip',
                    'Wide leg, flowing movement'
                ]
            };

            // Helper function to get random item from array
            function getRandomItem(array) {
                return array[Math.floor(Math.random() * array.length)];
            }

            // Helper function to get multiple random items
            function getRandomItems(array, count) {
                const shuffled = [...array].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }

            // Helper function to wait for DOM updates
            function waitForUpdate(ms = 100) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            try {
                // STEP 1: Clear all existing data
                console.log('🧹 Step 1: Clearing existing data...');
                btn.textContent = '🧹 Clearing data...';
                
                document.querySelectorAll('input[type="text"], textarea').forEach(input => input.value = '');
                document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
                
                await waitForUpdate(200);

                // STEP 2: Fill core required fields (except materials - they need to be filled after options update)
                console.log('📝 Step 2: Filling core required fields...');
                btn.textContent = '📝 Filling core fields...';
                
                const randomItemType = getRandomItem(testData.itemTypes);
                document.getElementById('item-type').value = randomItemType;
                document.getElementById('brand').value = getRandomItem(testData.brands);
                document.getElementById('size').value = getRandomItem(testData.sizes);
                document.getElementById('condition').value = getRandomItem(testData.conditions);
                
                console.log(`✅ Selected item type: ${randomItemType}`);
                await waitForUpdate(200);

                // STEP 3: Trigger dependent field updates
                console.log('🔄 Step 3: Updating dependent fields...');
                btn.textContent = '🔄 Updating dependent fields...';
                
                updateFitOptions();
                updateLengthOptions();
                updateFeaturesPlaceholder();
                updatePatternOptions();
                updateMaterialOptions(); // This clears and repopulates material options
                updateSizeRequirement();
                updateEraOptions();
                updateStyleAestheticOptions();
                updateMeasurementsPlaceholder();
                updateFlawsPlaceholder();
                
                await waitForUpdate(500); // Wait longer for all updates to complete

                // STEP 3.5: Fill materials AFTER options have been updated
                console.log('🧵 Step 3.5: Filling material fields...');
                btn.textContent = '🧵 Filling materials...';
                
                document.getElementById('material1').value = getRandomItem(testData.materials1);
                console.log(`✅ Selected material1: ${document.getElementById('material1').value}`);
                
                await waitForUpdate(200);

                // STEP 4: Fill dependent dropdowns
                console.log('⚙️ Step 4: Filling dependent dropdowns...');
                btn.textContent = '⚙️ Filling dropdowns...';
                
                // Fill fit dropdown
                const fitSelect = document.getElementById('fit');
                if (fitSelect && fitSelect.options.length > 1) {
                    const randomFitIndex = Math.floor(Math.random() * (fitSelect.options.length - 1)) + 1;
                    fitSelect.selectedIndex = randomFitIndex;
                    console.log(`✅ Selected fit: ${fitSelect.value}`);
                }

                // Fill length dropdown  
                const lengthSelect = document.getElementById('length');
                if (lengthSelect && lengthSelect.options.length > 1) {
                    const randomLengthIndex = Math.floor(Math.random() * (lengthSelect.options.length - 1)) + 1;
                    lengthSelect.selectedIndex = randomLengthIndex;
                    console.log(`✅ Selected length: ${lengthSelect.value}`);
                }

                await waitForUpdate(200);

                // STEP 5: Fill optional dropdowns
                console.log('🎨 Step 5: Filling optional dropdowns...');
                btn.textContent = '🎨 Filling optional fields...';
                
                // 80% chance to fill these optional fields
                if (Math.random() > 0.2) document.getElementById('era').value = getRandomItem(testData.eras);
                if (Math.random() > 0.3) document.getElementById('material2').value = getRandomItem(testData.materials2);
                if (Math.random() > 0.3) document.getElementById('pattern').value = getRandomItem(testData.patterns);
                if (Math.random() > 0.2) document.getElementById('style-aesthetic').value = getRandomItem(testData.aesthetics);

                await waitForUpdate(200);

                // STEP 6: Fill text inputs
                console.log('✍️ Step 6: Filling text inputs...');
                btn.textContent = '✍️ Filling text fields...';
                
                document.getElementById('measurements').value = getRandomItem(testData.measurements);
                document.getElementById('flaws').value = getRandomItem(testData.flaws);
                document.getElementById('custom-features').value = getRandomItem(testData.features);
                document.getElementById('fit-notes').value = getRandomItem(testData.fitNotes);

                await waitForUpdate(200);

                // STEP 7: Select colors
                console.log('🌈 Step 7: Selecting colors...');
                btn.textContent = '🌈 Selecting colors...';
                
                const numColors = Math.floor(Math.random() * 2) + 1; // 1 or 2 colors
                const selectedColors = getRandomItems(testData.availableColors, numColors);
                let colorsSelected = 0;
                
                selectedColors.forEach(color => {
                    const checkbox = document.querySelector(`.color-checkbox[value="${color}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        colorsSelected++;
                        console.log(`✅ Selected color: ${color}`);
                    } else {
                        console.log(`❌ Color not found: ${color}`);
                    }
                });

                await waitForUpdate(200);

                // STEP 8: Select season (optional)
                console.log('🌍 Step 8: Selecting season...');
                btn.textContent = '🌍 Selecting season...';
                
                if (Math.random() > 0.5) {
                    const randomSeason = getRandomItem(testData.seasons);
                    const seasonRadio = document.querySelector(`input[name="season"][value="${randomSeason}"]`);
                    if (seasonRadio) {
                        seasonRadio.checked = true;
                        console.log(`✅ Selected season: ${randomSeason}`);
                    }
                }

                await waitForUpdate(300);

                // STEP 9: Select features (ensuring features grid is populated)
                console.log('⭐ Step 9: Selecting features...');
                btn.textContent = '⭐ Selecting features...';
                
                let featureCheckboxes = document.querySelectorAll('#features-grid input[type="checkbox"]');
                let attempts = 0;
                
                // Retry if features grid isn't populated yet
                while (featureCheckboxes.length === 0 && attempts < 5) {
                    console.log(`🔄 Features grid not ready, retrying... (attempt ${attempts + 1})`);
                    updateFeaturesPlaceholder(); // Force update again
                    await waitForUpdate(300);
                    featureCheckboxes = document.querySelectorAll('#features-grid input[type="checkbox"]');
                    attempts++;
                }
                
                console.log(`Found ${featureCheckboxes.length} feature checkboxes`);
                
                if (featureCheckboxes.length > 0) {
                    const numFeatures = Math.min(Math.floor(Math.random() * 4) + 2, featureCheckboxes.length); // 2-5 features
                    const checkboxArray = Array.from(featureCheckboxes);
                    const randomFeatures = getRandomItems(checkboxArray, numFeatures);
                    
                    randomFeatures.forEach(checkbox => {
                        checkbox.checked = true;
                        console.log(`✅ Selected feature: ${checkbox.value}`);
                    });
                } else {
                    console.log('⚠️ No feature checkboxes found, skipping feature selection');
                }

                await waitForUpdate(200);

                // STEP 10: Final verification and completion
                console.log('🎯 Step 10: Final verification...');
                btn.textContent = '🎯 Verifying data...';
                
                const verification = {
                    itemType: document.getElementById('item-type').value,
                    brand: document.getElementById('brand').value,
                    size: document.getElementById('size').value,
                    material1: document.getElementById('material1').value,
                    material2: document.getElementById('material2').value,
                    condition: document.getElementById('condition').value,
                    fit: document.getElementById('fit').value,
                    length: document.getElementById('length').value,
                    era: document.getElementById('era').value,
                    pattern: document.getElementById('pattern').value,
                    styleAesthetic: document.getElementById('style-aesthetic').value,
                    measurements: document.getElementById('measurements').value,
                    flaws: document.getElementById('flaws').value,
                    customFeatures: document.getElementById('custom-features').value,
                    fitNotes: document.getElementById('fit-notes').value,
                    colorsSelected: document.querySelectorAll('.color-checkbox:checked').length,
                    featuresSelected: document.querySelectorAll('#features-grid input[type="checkbox"]:checked').length,
                    seasonSelected: document.querySelector('input[name="season"]:checked') ? 'Yes' : 'No'
                };

                console.log('🎯 Final verification results:', verification);

                // Count filled fields
                let filledFields = 0;
                let totalFields = 0;
                Object.entries(verification).forEach(([key, value]) => {
                    totalFields++;
                    if (value && value !== '' && value !== 'No' && value !== 0) {
                        filledFields++;
                    }
                });

                console.log(`📊 Summary: ${filledFields}/${totalFields} fields filled`);

                // Success message
                btn.textContent = '✅ Complete!';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }, 2000);

                showAlert(`🎲 Test data filled successfully!\n\n📊 ${filledFields}/${totalFields} fields populated\n🌈 ${verification.colorsSelected} colors selected\n⭐ ${verification.featuresSelected} features selected\n\nCheck console for detailed breakdown.`);

            } catch (error) {
                console.error('❌ Error during test data filling:', error);
                btn.textContent = '❌ Error occurred';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }, 3000);
                showAlert('❌ Error occurred while filling test data. Check console for details.');
            }
        }


    </script>


</body></html>
